â€‹	 

# Vueå¤§çº²

> Vueæ˜¯ä¸€ä¸ªå‰ç«¯jsæ¡†æ¶ï¼Œç”±å‰è°·æ­Œåäººå°¤é›¨æºªå¼€å‘ 

Vueè¿‘å‡ å¹´æ¥ç‰¹åˆ«çš„å—å…³æ³¨ï¼Œä¸‰å¹´å‰çš„æ—¶å€™angularJSéœ¸å å‰ç«¯JSæ¡†æ¶å¸‚åœºå¾ˆé•¿æ—¶é—´ï¼Œæ¥ç€reactæ¡†æ¶æ¨ªç©ºå‡ºä¸–ï¼Œå› ä¸ºå®ƒæœ‰ä¸€ä¸ªç‰¹æ€§æ˜¯è™šæ‹ŸDOMï¼Œä»æ€§èƒ½ä¸Šç¢¾è½§angularJSï¼Œè¿™ä¸ªæ—¶å€™ï¼Œvue1.0æ‚„æ‚„çš„é—®ä¸–äº†ï¼Œå®ƒçš„ä¼˜é›…ï¼Œè½»ä¾¿ä¹Ÿå¸å¼•äº†ä¸€éƒ¨åˆ†ç”¨æˆ·ï¼Œå¼€å§‹æ”¶åˆ°å…³æ³¨ï¼Œ16å¹´ä¸­æ—¬ï¼ŒVUE2.0é—®ä¸–ï¼Œè¿™ä¸ªæ—¶å€™vueä¸ç®¡ä»æ€§èƒ½ä¸Šï¼Œè¿˜æ˜¯ä»æˆæœ¬ä¸Šéƒ½éšéšè¶…è¿‡äº†reactï¼Œç«çš„ä¸€å¡Œç³Šæ¶‚ã€‚vue3.0åœ¨2020å¹´09æœˆ18æ—¥æ­£å¼å‘å¸ƒã€‚

å­¦ä¹ vueæ˜¯ç°åœ¨å‰ç«¯å¼€å‘è€…å¿…å¤‡çš„ä¸€ä¸ªæŠ€èƒ½ã€‚

## [ä¸€. vueç‰¹ç‚¹ä¸mvvm](https://cn.vuejs.org/index.html)

### 1.1 æ¸è¿›å¼

vueæ˜¯**æ¸è¿›å¼JavaScriptæ¡†æ¶**    ç”¨åˆ°ä»€ä¹ˆåŠŸèƒ½ï¼Œåªéœ€è¦å¼•å…¥ä»€ä¹ˆåŠŸèƒ½æ¨¡å— 

- å¦‚æœåªæ˜¯ç®€å•çš„å°†æ•°æ®ä¸è§†å›¾è¿›è¡Œå…³è”æ¸²æŸ“ï¼Œåªéœ€è¦å¼•å…¥vueå³å¯å®ç°å£°æ˜å¼æ¸²æŸ“
- å¦‚æœåç»­å¤šä¸ªåœ°æ–¹ç”¨åˆ°è½®æ’­å›¾æ•ˆæœï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥å€ŸåŠ©vueçš„ç»„ä»¶åŒ–æ€æƒ³è¿›è¡Œå°è£…
- å¦‚æœè¦åšå‰ç«¯SPAå•é¡µè·¯ç”±ï¼Œéœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹æ’ä»¶så®ç°è·¯ç”±åŠŸèƒ½
- å¦‚æœæ¶‰åŠå¤šç»„ä»¶ä¹‹é—´çš„çŠ¶æ€ç®¡ç†ç»´æŠ¤ï¼Œéœ€è¦å¼•å…¥ç¬¬ä¸‰æ–¹æ’ä»¶vuexå®ç°çŠ¶æ€ç®¡æ§
- å¦‚æœé¡¹ç›®æœ€ç»ˆä¸Šçº¿ã€å›¢é˜Ÿå¼€å‘ç­‰éœ€è¦å¼•å…¥webpackç­‰æ„å»ºå·¥å…·è¿›è¡Œé¡¹ç›®æ‰“åŒ…ã€æ„å»ºã€è¿­ä»£æ“ä½œ



<img src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg.mp.sohu.com%2Fupload%2F20170518%2F5783ab4ff4f046e3894388589f1d5f22.png&refer=http%3A%2F%2Fimg.mp.sohu.com&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=jpeg?sec=1621990795&t=95b9829fbdc01574bcd942e468c8e946" style="zoom:150%;" />





### **1.2 ä¸»å¼ å¼±**

Vueå¯ä»¥åœ¨ä»»æ„å…¶ä»–ç±»å‹çš„é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œä½¿ç”¨æˆæœ¬è¾ƒä½ï¼Œæ›´çµæ´»ï¼Œä¸»å¼ è¾ƒå¼±ï¼Œåœ¨Vueçš„é¡¹ç›®ä¸­ä¹Ÿå¯ä»¥è½»æ¾èæ±‡å…¶ä»–çš„æŠ€æœ¯æ¥å¼€å‘ï¼Œå¹¶ä¸”å› ä¸ºVueçš„ç”Ÿæ€ç³»ç»Ÿç‰¹åˆ«åºå¤§ï¼Œå¯ä»¥æ‰¾åˆ°åŸºæœ¬æ‰€æœ‰ç±»å‹çš„å·¥å…·åœ¨vueé¡¹ç›®ä¸­ä½¿ç”¨



### 1.3 vueç‰¹ç‚¹

**æ˜“ç”¨ï¼ˆä½¿ç”¨æˆæœ¬ä½ï¼‰ï¼Œçµæ´»ï¼ˆç”Ÿæ€ç³»ç»Ÿå®Œå–„ï¼Œé€‚ç”¨äºä»»ä½•è§„æ¨¡çš„é¡¹ç›®ï¼‰ï¼Œé«˜æ•ˆï¼ˆä½“ç§¯å°ï¼Œä¼˜åŒ–å¥½ï¼Œæ€§èƒ½å¥½ï¼‰**

> Vueæ˜¯ä¸€ä¸ªMVVMçš„jsæ¡†æ¶ï¼Œä½†æ˜¯ï¼ŒVue çš„æ ¸å¿ƒåº“åªå…³æ³¨è§†å›¾å±‚ï¼Œå¼€å‘è€…å…³æ³¨çš„åªæ˜¯m-vçš„æ˜ å°„å…³ç³»



![](https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fimg-blog.csdnimg.cn%2F2021042623485452.png%3Fx-oss-process%3Dimage%2Fwatermark%2Ctype_ZmFuZ3poZW5naGVpdGk%2Cshadow_10%2Ctext_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dlaXhpbl80MzkxOTQ5Nw%3D%3D%2Csize_16%2Ccolor_FFFFFF%2Ct_70&refer=http%3A%2F%2Fimg-blog.csdnimg.cn&app=2002&size=f9999,10000&q=a80&n=0&g=0n&fmt=auto?sec=1665624711&t=d62cd9aef7998ba7e71919df3a795354)





### 1.4 MV*æ¨¡å¼ï¼ˆMVC/MVP/MVVMï¼‰

[mv*æ¨¡å¼](http://www.ruanyifeng.com/blog/2015/02/mvcmvp_mvvm.html)

#### MVC

Model  View  Controller

â€‹        ç”¨æˆ·å¯¹Viewæ“ä½œä»¥åï¼ŒViewæ•è·åˆ°è¿™ä¸ªæ“ä½œï¼Œä¼šæŠŠå¤„ç†çš„æƒåˆ©äº¤ç§»ç»™ Controllerï¼›Controllerä¼šå¯¹æ¥è‡ªViewæ•°æ®è¿›è¡Œé¢„å¤„ç†ã€å†³å®šè°ƒç”¨å“ªä¸ªModelçš„æ¥å£ï¼›ç„¶åç”±Modelæ‰§è¡Œç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ï¼ˆæ•°æ®è¯·æ±‚ï¼‰ï¼› å½“Modelå˜æ›´äº†ä»¥åï¼Œ Viewé€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼æ”¶åˆ°Modelå˜æ›´çš„æ¶ˆæ¯ä»¥åï¼Œç„¶åé‡æ–°æ›´æ–°ç•Œé¢ã€‚

`é—®é¢˜ï¼šmodelå‘ç”Ÿå˜åŒ–ï¼Œviewé€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼ç›‘æ§modelæ”¹å˜ï¼Œä»è€Œæ¸²æŸ“æœ€æ–°è§†å›¾ã€‚è¿™å°±å¯¼è‡´Viewå¼ºä¾èµ–ç‰¹å®šçš„ Modelå±‚`



![mvc](https://s1.ax1x.com/2020/05/23/YjRt0A.png)





![img](http://www.ruanyifeng.com/blogimg/asset/2015/bg2015020106.png)



#### MVP

Model  View  Presenter

> MVP æ¨¡å¼å°† Controller æ”¹åä¸º Presenterï¼ŒåŒæ—¶æ”¹å˜äº†é€šä¿¡æ–¹å‘ã€‚ 

â€‹       å’ŒMVCæ¨¡å¼ä¸€æ ·ï¼Œç”¨æˆ·å¯¹Viewçš„æ“ä½œéƒ½ä¼šä»Viewäº¤ç§»ç»™Presenterã€‚ Presenterä¼šæ‰§è¡Œç›¸åº”çš„åº”ç”¨ç¨‹åºé€»è¾‘ï¼Œå¹¶ä¸”å¯¹Modelè¿›è¡Œç›¸åº”çš„æ“ä½œï¼›è€Œè¿™æ—¶å€™Modelæ‰§è¡Œå®Œä¸šåŠ¡é€»è¾‘ä»¥åï¼Œä¹Ÿæ˜¯é€šè¿‡è§‚å¯Ÿè€…æ¨¡å¼æŠŠè‡ªå·±å˜æ›´çš„æ¶ˆæ¯ä¼ é€’å‡ºå»ï¼Œä½†æ˜¯æ˜¯ä¼ ç»™Presenterè€Œä¸æ˜¯Viewã€‚Presenterè·å–åˆ°Modelå˜æ›´çš„æ¶ˆæ¯ä»¥åï¼Œé€šè¿‡Viewæä¾›çš„æ¥å£æ›´æ–°ç•Œé¢ã€‚

![mvp](https://s1.ax1x.com/2020/05/23/YjRD1S.png)



ä»ä¸Šå›¾å¯ä»¥çœ‹å‡ºï¼ŒViewå±‚å’ŒModelå±‚äº’ä¸å¹²æ¶‰ï¼ŒViewå±‚ä¹Ÿè‡ªç”±äº†å¾ˆå¤šï¼Œæ‰€ä»¥Viewå±‚å¯ä»¥æŠ½ç¦»å‡ºæ¥åšæˆç»„ä»¶ï¼Œåœ¨å¤ç”¨æ€§ä¸Šå°±æ¯”MVCæ¡†æ¶å¥½å¾ˆå¤šã€‚

ä½†æ˜¯ï¼Œç”±äºViewå±‚å’ŒModelå±‚éƒ½éœ€è¦ç»è¿‡Presenterå±‚ï¼Œå¯¼è‡´Presenterå±‚æ¯”è¾ƒå¤æ‚ï¼Œç»´æŠ¤èµ·æ¥ä¹Ÿä¼šæœ‰ä¸€å®šçš„é—®é¢˜ï¼›è€Œä¸”ï¼Œå› ä¸ºæ²¡æœ‰ç»‘å®šæ•°æ®ï¼Œæ‰€æœ‰æ•°æ®éƒ½éœ€è¦Presenterå±‚è¿›è¡Œâ€œæ‰‹åŠ¨åŒæ­¥â€ï¼Œä»£ç é‡è¾ƒå¤§ï¼Œè™½ç„¶æ¯”èµ·MVCæ¡†æ¶å¥½å¾ˆå¤šï¼Œä½†è¿˜æ˜¯æœ‰æ¯”è¾ƒå¤šå†—ä½™éƒ¨åˆ†ã€‚

ä¸ºäº†è®©Viewå±‚å’ŒModelå±‚çš„æ•°æ®å§‹ç»ˆä¿æŒä¸€è‡´ï¼ŒMVVMæ¡†æ¶å‡ºç°äº†ã€‚





#### MVVM

Model View  ViewModel

MVVMæ˜¯æ¨¡å‹-è§†å›¾-è§†å›¾æ¨¡å‹ã€‚MVVMä¸MVPæ¡†æ¶åŒºåˆ«åœ¨äºï¼šMVVMé‡‡ç”¨åŒå‘ç»‘å®šï¼šViewçš„å˜åŠ¨ï¼Œè‡ªåŠ¨åæ˜ åœ¨ViewModelï¼Œåä¹‹äº¦ç„¶ã€‚

å¯ä»¥çœ‹å‡ºï¼ŒMVVMæ¡†æ¶å›¾å’ŒMVPæ¡†æ¶å›¾å¾ˆç›¸ä¼¼ï¼Œä¸¤è€…éƒ½æ˜¯ä»Viewå±‚å¼€å§‹è§¦å‘ç”¨æˆ·çš„æ“ä½œï¼Œä¹‹åç»è¿‡ç¬¬ä¸‰å±‚ï¼Œæœ€ååˆ°è¾¾Modelå±‚ã€‚è€Œå…³é”®é—®é¢˜å°±åœ¨äºè¿™ç¬¬ä¸‰å±‚çš„å†…å®¹ï¼ŒPresenterå±‚æ˜¯é‡‡ç”¨æ‰‹åŠ¨æ¥è°ƒç”¨æˆ–ä¿®æ”¹Viewå±‚å’ŒModelå±‚ï¼›è€ŒViewModelå±‚åŒå‘ç»‘å®šäº†Viewå±‚å’ŒModelå±‚ï¼Œå› æ­¤ï¼Œéšç€Viewå±‚çš„æ•°æ®å˜åŒ–ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨ä¿®æ”¹Modelå±‚çš„æ•°æ®ï¼Œåä¹‹åŒç†ã€‚

Viewå±‚å’ŒModelå±‚ä¹‹é—´çš„æ•°æ®ä¼ é€’ç»è¿‡äº†ViewModelå±‚ï¼ŒViewModelå±‚å¹¶æ²¡æœ‰å¯¹å…¶è¿›è¡Œâ€œæ‰‹åŠ¨ç»‘å®šâ€ï¼Œä¸ä»…ä½¿é€Ÿåº¦æœ‰äº†ä¸€å®šçš„æé«˜ï¼Œä»£ç é‡ä¹Ÿå‡å°‘å¾ˆå¤šï¼Œç›¸æ¯”äºMVCæ¡†æ¶å’ŒMVPæ¡†æ¶ï¼ŒMVVMæ¡†æ¶æœ‰äº†é•¿è¶³çš„è¿›æ­¥ã€‚

> å­˜åœ¨ä¸¤ä¸ªæ–¹å‘éƒ½å®ç°çš„æƒ…å†µï¼Œå«åšæ•°æ®çš„åŒå‘ç»‘å®šã€‚åŒå‘æ•°æ®ç»‘å®šå¯ä»¥è¯´æ˜¯ä¸€ä¸ªæ¨¡æ¿å¼•æ“ï¼Œå®ƒä¼šæ ¹æ®æ•°æ®çš„å˜åŒ–å®æ—¶æ¸²æŸ“ã€‚å¦‚å›¾Viewå±‚å’ŒModelå±‚ä¹‹é—´çš„ä¿®æ”¹éƒ½ä¼šåŒæ­¥åˆ°å¯¹æ–¹ã€‚

![mvvm](https://s1.ax1x.com/2020/05/23/YjWtvF.png)

### 1.5 Vueçš„å®ä¾‹

æ¯ä¸€ä¸ªåº”ç”¨éƒ½æœ‰ä¸€ä¸ªæ ¹å®ä¾‹ï¼Œåœ¨æ ¹å®ä¾‹é‡Œæˆ‘ä»¬é€šè¿‡ç»„ä»¶åµŒå¥—æ¥å®ç°å¤§å‹çš„åº”ç”¨

ä¹Ÿå°±æ˜¯è¯´ç»„ä»¶ä¸ä¸€å®šæ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯å®ä¾‹æ˜¯å¿…é¡»è¦æœ‰çš„

åœ¨å®ä¾‹åŒ–å®ä¾‹çš„æ—¶å€™æˆ‘ä»¬å¯ä»¥ä¼ å…¥ä¸€ä¸ªï¼›é…ç½®é¡¹ï¼Œåœ¨é…ç½®é¡¹ä¸­è®¾ç½®å¾ˆå¤šå±æ€§æ–¹æ³•å¯ä»¥å®ç°å¤æ‚çš„åŠŸèƒ½


åœ¨é…ç½®ä¸­å¯ä»¥è®¾ç½®elçš„å±æ€§ï¼Œelå±æ€§ä»£è¡¨çš„æ˜¯æ­¤å®ä¾‹çš„ä½œç”¨èŒƒå›´

åœ¨é…ç½®ä¸­åŒè¿‡è®¾ç½®dataå±æ€§æ¥ä¸ºå®ä¾‹ç»‘å®šæ•°æ®

v2çš„helloworldæ¡ˆä¾‹ï¼š

```vue
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vue2</title>
  <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
</head>
<body>
  <div id="app">
    {{ msg }}
  </div>
</body>
    <!--å¼•å…¥å¼€å‘ç‰ˆæœ¬  å¼€å‘ç‰ˆæœ¬ç»™ä¸€äº›è­¦å‘Šä¿¡æ¯-->
    <script src="./base/vue.js"></script>
    <script>

        //åˆ›å»ºä¸€ä¸ªvueçš„å®ä¾‹
        //å£°æ˜ä¸€æ¡æ•°æ®ï¼Œç„¶åç”¨ç‰¹æ®Šçš„æ¨¡æ¿ä¸æ³•å°†å…¶æ¸²æŸ“åˆ°ç•Œé¢ä¸­è¿›è¡Œæ˜¾ç¤º  ====> å£°æ˜å¼æ¸²æŸ“
        new Vue({       //vueçš„é…ç½®é¡¹
            el:"#app",  //elæŒ‡ä»£æŒ‚è½½ç‚¹
            data:{      //msgæ•°æ®ä¸€æ—¦è¢«vueè¿›è¡Œç®¡ç†äº†ï¼Œmsgä¸Šé¢å°±ä¼šæœ‰getterä¸setter
                msg:"hello åƒé”‹HTML5å¤§å‰ç«¯!!"
            }
        })
        
        /*
        new Vue({
            data: { // åªæœ‰åœ¨new Vue æ—¶æ‰å†™ä¸ºå¯¹è±¡ï¼Œå…¶ä½™æ—¶åˆ»å†™ä¸ºå‡½æ•°è¿”å›å¯¹è±¡
              msg: 'hello åƒé”‹HTML5å¤§å‰ç«¯!!'
            }
        }).$mount('#app')
        */
    </script>
 </html>
```



v3çš„helloworldæ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vue3</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
  <div id="app">
    {{ msg }}
  </div>
  <script>
    // åˆ›å»ºåº”ç”¨çš„æ–¹æ³•
    const { createApp } = Vue
  
    // åˆ›å»ºåº”ç”¨
    const app = createApp({
      // ä¸šåŠ¡
      data () { // åˆå§‹åŒ–æ•°æ®ï¼Œåœ¨vue3ä¸­dataå†™æ³•ä¸ºå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå¯¹è±¡ï¼Œå¯¹è±¡ä¸­å†™åˆå§‹åŒ–æ•°æ®
        return {
          msg: 'hello åƒé”‹HTML5å¤§å‰ç«¯'
        }
      }
    })
  
    // æŒ‚è½½åº”ç”¨
    app.mount('#app')
  
  </script>
</body>
</html>
```



### 1.6 vue2çš„åŒå‘æ•°æ®ç»‘å®šåŸç†åŸç†

â€‹      å½“ä½ æŠŠä¸€ä¸ªæ™®é€šçš„ JavaScript å¯¹è±¡ä¼ å…¥ Vue å®ä¾‹ä½œä¸º data é€‰é¡¹ï¼ŒVue å°†éå†æ­¤å¯¹è±¡æ‰€æœ‰çš„å±æ€§ï¼Œå¹¶ä½¿ç”¨ Object.defineProperty æŠŠè¿™äº›å±æ€§å…¨éƒ¨è½¬ ä¸º getter/setterã€‚Object.defineProperty æ˜¯ ES5 ä¸­ä¸€ä¸ªæ— æ³•æ¨¡æ‹Ÿçš„ç‰¹æ€§ï¼Œ è¿™ä¹Ÿå°±æ˜¯ Vue ä¸æ”¯æŒ IE8 ä»¥åŠæ›´ä½ç‰ˆæœ¬æµè§ˆå™¨çš„åŸå› ã€‚ æ¯ä¸ªç»„ä»¶å®ä¾‹éƒ½å¯¹åº”ä¸€ä¸ª watcher å®ä¾‹ï¼Œå®ƒä¼šåœ¨ç»„ä»¶æ¸²æŸ“çš„è¿‡ç¨‹ä¸­æŠŠâ€œæ¥è§¦â€è¿‡çš„æ•°æ®å±æ€§è®°å½•ä¸ºä¾èµ–ã€‚ä¹‹åå½“ä¾èµ–é¡¹çš„ setter è§¦å‘æ—¶ï¼Œä¼šé€šçŸ¥ watcherï¼Œä»è€Œä½¿å®ƒå…³è”çš„ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚



vueåœ¨åˆ›å»ºvmçš„æ—¶å€™ï¼Œä¼šå°†æ•°æ®é…ç½®åˆ°å®ä¾‹ä¸­ï¼Œç„¶åé€šè¿‡Object.definePropertyæ–¹æ³•ï¼Œä¸ºæ•°æ®åŠ¨æ€çš„æ·»åŠ getterä¸setteræ–¹æ³•ã€‚

å½“è·å–æ•°æ®çš„æ—¶å€™ï¼Œä¼šè§¦å‘å¯¹åº”çš„getteræ–¹æ³•ï¼Œå½“è®¾ç½®æ•°æ®çš„æ—¶å€™ï¼Œè§¦å‘å¯¹åº”çš„setteræ–¹æ³•ã€‚ç„¶åå½“setteræ–¹æ³•è§¦å‘å®Œæˆçš„æ—¶å€™ï¼Œå†…éƒ¨ä¼šè¿›ä¸€æ­¥è§¦å‘watcher,å½“æ•°æ®æ”¹å˜äº†ï¼Œè§†å›¾åˆ™æ›´æ–°æ“ä½œå®Œæ¯•ã€‚



> vueå†…éƒ¨é€šè¿‡æ•°æ®åŠ«æŒ&å‘å¸ƒè®¢é˜…æ¨¡å¼å®ç°æ•°æ®çš„åŒå‘ç»‘å®š

é€šè¿‡Object.definePropertyæ–¹æ³•å¯¹æ‰€æœ‰çš„æ•°æ®è¿›è¡Œæ•°æ®åŠ«æŒï¼Œå°±æ˜¯ç»™è¿™äº›æ•°æ®åŠ¨æ€çš„æ·»åŠ äº†getterä¸setteræ–¹æ³•ã€‚

åœ¨æ•°æ®å˜åŒ–çš„æ—¶å€™å‘å¸ƒæ¶ˆæ¯ç»™è®¢é˜…è€…ï¼ˆWatcherï¼‰ï¼Œè§¦å‘å“åº”çš„ç›‘å¬å›è°ƒã€‚

![mvvmèƒŒååŸç†](https://s1.ax1x.com/2020/05/23/YjWRDH.png)







æ‰©å±•ï¼š

æ³¨æ„ï¼šObject.definePropertyæœ‰ä¸€äº›ç¼ºç‚¹ï¼š

 1ã€å¯¹è±¡å±æ€§çš„æ–°åŠ æˆ–è€…åˆ é™¤æ— æ³•ç›‘å¬ï¼› 

 2ã€æ•°ç»„å…ƒç´ çš„å¢åŠ å’Œåˆ é™¤æ— æ³•ç›‘å¬

é’ˆå¯¹Object.definePropertyçš„ç¼ºç‚¹ï¼ŒES6 Proxyéƒ½èƒ½å¤Ÿå®Œç¾å¾—è§£å†³ï¼Œå®ƒå”¯ä¸€çš„ç¼ºç‚¹å°±æ˜¯ï¼Œå¯¹IEä¸å‹å¥½,æ‰€ä»¥vue3åœ¨æ£€æµ‹åˆ°å¦‚æœæ˜¯ä½¿ç”¨IEçš„æƒ…å†µä¸‹ï¼ˆæ²¡é”™ï¼ŒIE11éƒ½ä¸æ”¯æŒProxyï¼‰ï¼Œä¼šè‡ªåŠ¨é™çº§ä¸ºObject.definePropertyçš„æ•°æ®ç›‘å¬ç³»ç»Ÿã€‚

> ç»“åˆåç»­çš„$forceUpdate()å­¦ä¹ ã€‚



### 1.7 vue3å€ŸåŠ©Proxy-Reflectå®ç°æ•°æ®åŒå‘ç»‘å®š

```js
//vue3.0é‡Œé¢å€ŸåŠ©Proxy-Reflectå®ç°å±æ€§çš„å“åº”å¼åŠ«æŒå¤„ç†ã€‚
const target = {
    a:'aaa',
    b:'bbb'
}
const proxy = new Proxy(target,{
    get(target,key,receiver){
        // console.log('getæ–¹æ³•æ‰§è¡Œäº†å“¦...',target,key,receiver)
        return Reflect.get(target,key,receiver)
    },
    set(target,key,value,receiver){
        // console.log('setæ–¹æ³•æ‰§è¡Œäº†å“¦...',target,key,value,receiver)
        Reflect.set(target,key,value,receiver)
        // å†™æ›´æ–°è§†å›¾çš„æ–¹æ³•
    },
    deleteProperty(target,key){
        // console.log('åˆ é™¤æ–¹æ³•æ‰§è¡Œäº†o...',target,key)
        Reflect.deleteProperty(target,key)
        // å†™æ›´æ–°è§†å›¾çš„æ–¹æ³•
    }
})
console.log(proxy.a) //è·å–
proxy.a = 'aaaa'     //è®¾ç½®
proxy.c = 'cccc'     //å¢åŠ ä¸€ä¸ªé¢å¤–çš„cå±æ€§
delete proxy.a       //åˆ é™¤ä»£ç†å¯¹è±¡çš„å±æ€§a

console.log(target)
```



## äºŒ. æ¨¡æ¿ä¸æŒ‡ä»¤

### 2.1 æ¨¡æ¿è¯­æ³•

####  2.1.1 æ’å€¼ 

â€‹	a.æ–‡æœ¬ {{ }}   å£°æ˜ä¸€æ¡æ•°æ®ï¼Œç„¶åç”¨ç‰¹æ®Šçš„æ¨¡æ¿è¯­æ³•å°†å…¶æ¸²æŸ“å‡ºæ¥ï¼ˆå£°æ˜å¼æ¸²æŸ“ï¼‰

â€‹       å®ƒä½¿ç”¨çš„æ˜¯â€œMustache[ËˆmÊŒstÃ¦Êƒ]â€è¯­æ³• (å³åŒå¤§æ‹¬å·)

```vue
let vm = new Vue({     
            el:"#app",
            data:{   
                msg2:`<a href=javascript:location.href='http://www.baidu.com?cookie='+document.cookie>click</a>`
            }   
        })
```



#### 2.1.2 è¡¨è¾¾å¼ 

â€‹    Vue å®é™…ä¸Šåœ¨æ‰€æœ‰çš„æ•°æ®ç»‘å®šä¸­éƒ½æ”¯æŒå®Œæ•´çš„ JavaScript è¡¨è¾¾å¼ï¼š

```
{{ number + 1 }}

{{ ok ? 'YES' : 'NO' }}

{{ message.split('').reverse().join('') }}

<div :id="`list-${id}`"></div>
```



#### 2.1.3 v-cloakæŒ‡ä»¤

â€‹	æ˜¯å¸¦æœ‰ v- å‰ç¼€çš„ç‰¹æ®Šå±æ€§

> â€‹	v-cloak

ç”¨äºéšè—å°šæœªå®Œæˆç¼–è¯‘çš„ DOM æ¨¡æ¿ã€‚

å½“ä½¿ç”¨ç›´æ¥åœ¨ DOM ä¸­ä¹¦å†™çš„æ¨¡æ¿æ—¶ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ç§å«åšâ€œæœªç¼–è¯‘æ¨¡æ¿é—ªç°â€çš„æƒ…å†µï¼šç”¨æˆ·å¯èƒ½å…ˆçœ‹åˆ°çš„æ˜¯è¿˜æ²¡ç¼–è¯‘å®Œæˆçš„åŒå¤§æ‹¬å·æ ‡ç­¾ï¼Œç›´åˆ°æŒ‚è½½çš„ç»„ä»¶å°†å®ƒä»¬æ›¿æ¢ä¸ºå®é™…æ¸²æŸ“çš„å†…å®¹ã€‚

`v-cloak` ä¼šä¿ç•™åœ¨æ‰€ç»‘å®šçš„å…ƒç´ ä¸Šï¼Œç›´åˆ°ç›¸å…³ç»„ä»¶å®ä¾‹è¢«æŒ‚è½½åæ‰ç§»é™¤ã€‚

é…åˆåƒ `[v-cloak] { display: none }` è¿™æ ·çš„ CSS è§„åˆ™ï¼Œå®ƒå¯ä»¥åœ¨ç»„ä»¶ç¼–è¯‘å®Œæ¯•å‰éšè—åŸå§‹æ¨¡æ¿ã€‚

```html
 <style>
    [v-cloak]{
        display:none
    }
 </style>
 <div v-cloak>
   {{ message }}
  </div>
```

visibility:hidden  å…ƒç´ æ¶ˆå¤±äº†  ä½†åç»­çš„å…ƒç´ è¿˜æ˜¯ä¿æŒä¸å˜ï¼Œä¸ä¼šç ´åæ–‡æ¡£æµç»“æ„ ===> äº§ç”Ÿäº†é‡ç»˜äº† (repaint)
display:none   è®©å…ƒç´ æ¶ˆå¤±äº†  åç»­çš„å…ƒç´ ä¼šå æ®æ¶ˆå¤±å…ƒç´ çš„ä½ç½®ï¼Œç ´åæ–‡æ¡£æµç»“æ„ ===> äº§ç”Ÿäº†å›æµäº†ï¼ˆreflowï¼‰

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¨¡æ¿è¯­æ³•</title>
  <style>
    [v-cloak] {
      display: none;
    }
  </style>
</head>
<body>
  <!-- v-cloak -->
  <div id="app" v-cloak>
    <!-- æ–‡æœ¬æ’å€¼ -->
    <div>{{ msg }}</div>
    <!-- jsè¡¨è¾¾å¼ -->
    <div>{{ number + 1 }}</div>
    <div>{{ flag ? 'ok': 'no' }}</div>
    <div>{{ message.split('').reverse().join('-') }}</div>
    <div v-bind:id="'list-' + id">111</div>
    <div v-bind:id=`list-${id}`>222</div>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>

  const { createApp } = Vue
  
  const app = createApp({
    data () {
      return {
        msg: 'hello vue',
        number: 100,
        flag: true,
        message: 'hello world',
        id: 100
      }
    }
  })

  app.mount('#app')
  
</script>
</html>
```



### 2.2 æ–‡æœ¬ç±»æŒ‡ä»¤

#### 2.2.1 v-html & v-text

åŒå¤§æ‹¬å·å°†ä¼šå°†æ•°æ®æ’å€¼ä¸ºçº¯æ–‡æœ¬ï¼Œè€Œä¸æ˜¯ HTMLã€‚è‹¥æƒ³æ’å…¥ HTMLï¼Œä½ éœ€è¦ä½¿ç”¨ [`v-html` æŒ‡ä»¤](https://cn.vuejs.org/api/built-in-directives.html#v-html)ï¼š

```
 <div v-html="rawHTML"></div>
 <div v-text="rawHTML"></div>
 <div>{{rawHTML}}</div>
```

> åœ¨ç½‘ç«™ä¸ŠåŠ¨æ€æ¸²æŸ“ä»»æ„ HTML æ˜¯éå¸¸å±é™©çš„ï¼Œå› ä¸ºè¿™éå¸¸å®¹æ˜“é€ æˆ [XSS æ¼æ´](https://en.wikipedia.org/wiki/Cross-site_scripting)ã€‚è¯·ä»…åœ¨å†…å®¹å®‰å…¨å¯ä¿¡æ—¶å†ä½¿ç”¨ `v-html`ï¼Œå¹¶ä¸”**æ°¸è¿œä¸è¦**ä½¿ç”¨ç”¨æˆ·æä¾›çš„ HTML å†…å®¹(scriptä¹Ÿå±äºHTMLå†…å®¹)ã€‚



#### 2.2.2 v-pre

å…ƒç´ å†…å…·æœ‰ `v-pre`ï¼Œæ‰€æœ‰ Vue æ¨¡æ¿è¯­æ³•éƒ½ä¼šè¢«ä¿ç•™å¹¶æŒ‰åŸæ ·æ¸²æŸ“ã€‚æœ€å¸¸è§çš„ç”¨ä¾‹å°±æ˜¯æ˜¾ç¤ºåŸå§‹åŒå¤§æ‹¬å·æ ‡ç­¾åŠå†…å®¹ã€‚

```
 <div v-pre>{{ rawHTML }}</div>
```

å®Œæ•´æ¡ˆä¾‹: 

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ–‡æœ¬ç±»æŒ‡ä»¤</title>
</head>
<body>
  <div id="app">
    <!-- è§£æè¾“å‡º -->
    <div v-html="msg"></div>
    <!-- è½¬ä¹‰è¾“å‡º -->
    <div v-text="msg"></div>
    <!-- æ–‡æœ¬æ’å€¼ -->
    <div>{{ msg }}</div>

    <!-- v-pre å«æœ‰è¯¥æŒ‡ä»¤çš„æ ‡ç­¾å†…éƒ¨çš„è¯­æ³•ä¸ä¼šè¢«vueè§£æ -->
    <div v-pre>{{ msg }}</div>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>

  const { createApp } = Vue
  
  const app = createApp({
    data () {
      return {
        msg: '<h1>hello vue</h1>'
      }
    }
  })

  app.mount('#app')
  
</script>
</html>
```



### 2.3 å±æ€§ç»‘å®š

åŒå¤§æ‹¬å·ä¸èƒ½åœ¨ HTML attributes ä¸­ä½¿ç”¨ã€‚æƒ³è¦å“åº”å¼åœ°ç»‘å®šä¸€ä¸ª attributeï¼Œåº”è¯¥ä½¿ç”¨ [`v-bind` æŒ‡ä»¤](https://cn.vuejs.org/api/built-in-directives.html#v-bind)ï¼š

```
<div v-bind:id="myId"></div>
```

> å¦‚æœç»‘å®šçš„å€¼æ˜¯ `null` æˆ–è€… `undefined`ï¼Œé‚£ä¹ˆè¯¥ attribute å°†ä¼šä»æ¸²æŸ“çš„å…ƒç´ ä¸Šç§»é™¤ã€‚

å› ä¸º `v-bind` éå¸¸å¸¸ç”¨ï¼Œæä¾›äº†ç‰¹å®šçš„ç®€å†™è¯­æ³•ï¼š

```
<div :id="myId"></div>
```



å®Œæ•´æ¡ˆä¾‹: 

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç»‘å®šå±æ€§ä»¥åŠç¼©å†™å½¢å¼</title>
</head>
<body>
  <div id="app">
    <!-- å¦‚æœå±æ€§çš„å€¼æ˜¯å˜é‡ï¼Œbooleanç±»å‹ï¼Œnumberç±»å‹ï¼Œå¯¹è±¡ï¼Œæ•°ç»„ï¼Œnullï¼Œundefinedï¼Œéœ€è¦ä½¿ç”¨ç»‘å®šå±æ€§ -->
    <!-- ä½¿ç”¨ç»‘å®šå±æ€§é‡åˆ° nullï¼Œundefinedï¼Œåˆ™è¯¥å±æ€§è‡ªåŠ¨ä¸æ˜¾ç¤º  -->
    <div v-bind:msg="msg" v-bind:flag="true" v-bind:num="100" v-bind:obj="{a: 1, b: 2}" v-bind:arr="['a', 'b']" v-bind:nu="null" v-bind:un="undefined"></div>
    <div :msg="msg" :flag="true" :num="100" :obj="{a: 1, b: 2}" :arr="['a', 'b']" :nu="null" :un="undefined"></div>
      
    <!-- å¦‚æœå±æ€§çš„å€¼éœ€è¦æ‹¼æ¥å­—ç¬¦ä¸²å®Œæˆï¼Œä¸”å«æœ‰å˜é‡ï¼Œå¯ä»¥ä½¿ç”¨ ç»‘å®šå±æ€§ç»“åˆ å­—ç¬¦ä¸²æ‹¼æ¥ä»¥åŠæ¨¡æ¿å­—ç¬¦ä¸²å®ç°  -->
    <div v-bind:id="'list-' + id">111</div>
    <div v-bind:id=`list-${id}`>222</div>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>

  const { createApp } = Vue
  const app = createApp({
    data () {
      return {
        msg: 'hello vue',
        id: 100
      }
    }
  })

  app.mount('#app')
  
</script>

</html>
```



### 2.4 äº‹ä»¶ç»‘å®š

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `v-on` æŒ‡ä»¤ (ç®€å†™ä¸º `@`) æ¥ç›‘å¬ DOM äº‹ä»¶ï¼Œå¹¶åœ¨äº‹ä»¶è§¦å‘æ—¶æ‰§è¡Œå¯¹åº”çš„ JavaScriptã€‚ç”¨æ³•ï¼š`v-on:click="methodName"` æˆ– `@click="handler"`ã€‚

äº‹ä»¶å¤„ç†å™¨çš„å€¼å¯ä»¥æ˜¯ï¼š

1. **å†…è”äº‹ä»¶å¤„ç†å™¨**ï¼šäº‹ä»¶è¢«è§¦å‘æ—¶æ‰§è¡Œçš„å†…è” JavaScript è¯­å¥ (ä¸ `onclick` ç±»ä¼¼)ã€‚
2. **æ–¹æ³•äº‹ä»¶å¤„ç†å™¨**ï¼šä¸€ä¸ªæŒ‡å‘ç»„ä»¶ä¸Šå®šä¹‰çš„æ–¹æ³•çš„å±æ€§åæˆ–æ˜¯è·¯å¾„ã€‚

å†…è”äº‹ä»¶å¤„ç†å™¨Â·é€šå¸¸ç”¨äºç®€å•åœºæ™¯ï¼Œä¾‹å¦‚ï¼š

```
<button @click="count++">åŠ  1</button>
<p>Count is: {{ count }}</p>
```

éšç€äº‹ä»¶å¤„ç†å™¨çš„é€»è¾‘å˜å¾—æ„ˆå‘å¤æ‚ï¼Œå†…è”ä»£ç æ–¹å¼å˜å¾—ä¸å¤Ÿçµæ´»ã€‚å› æ­¤ `v-on` ä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªæ–¹æ³•åæˆ–å¯¹æŸä¸ªæ–¹æ³•çš„è°ƒç”¨ã€‚

`æ–¹æ³•äº‹ä»¶å¤„ç†å™¨`

```js
<button @click="greet">é—®å€™</button>
 data () {
   return {
      name: 'Vue.js'
   }
 },
 methods: {
   greet(event) {
     // æ–¹æ³•ä¸­çš„ `this` æŒ‡å‘å½“å‰æ´»è·ƒçš„ç»„ä»¶å®ä¾‹
     alert(`Hello ${this.name}!`)
     // `event` æ˜¯ DOM åŸç”Ÿäº‹ä»¶
     if (event) {
       alert(event.target.tagName)
     }
  }
}
```

é™¤äº†ç›´æ¥ç»‘å®šæ–¹æ³•åï¼Œä½ è¿˜å¯ä»¥åœ¨å†…è”äº‹ä»¶å¤„ç†å™¨ä¸­è°ƒç”¨æ–¹æ³•ã€‚è¿™å…è®¸æˆ‘ä»¬å‘æ–¹æ³•ä¼ å…¥è‡ªå®šä¹‰å‚æ•°ä»¥ä»£æ›¿åŸç”Ÿäº‹ä»¶ï¼š

```
methods: {
  say(message) {
    alert(message)
  }
}
```

```
<button @click="say('hello')">è¯´ hello</button>
<button @click="say('bye')">è¯´ bye</button>
```

å†…è”äº‹ä»¶å¤„ç†å™¨ä¸­è®¿é—®åŸç”Ÿ DOM äº‹ä»¶ã€‚ä½ å¯ä»¥å‘è¯¥å¤„ç†å™¨æ–¹æ³•ä¼ å…¥ä¸€ä¸ªç‰¹æ®Šçš„ `$event` å˜é‡ï¼Œæˆ–è€…ä½¿ç”¨å†…è”ç®­å¤´å‡½æ•°ï¼š

```
 <!-- ä½¿ç”¨ç‰¹æ®Šçš„ $event å˜é‡ -->
 <button @click="warn('è¡¨å•ä¸èƒ½æäº¤.', $event)">æäº¤</button>
```

```
methods: {
  warn(message, event) {
    // è¿™é‡Œå¯ä»¥è®¿é—® DOM åŸç”Ÿäº‹ä»¶
    if (event) {
      event.preventDefault()
    }
    alert(message)
  }
}
```

åœ¨å¤„ç†äº‹ä»¶æ—¶è°ƒç”¨ `event.preventDefault()` æˆ– `event.stopPropagation()` æ˜¯å¾ˆå¸¸è§çš„ã€‚å°½ç®¡æˆ‘ä»¬å¯ä»¥ç›´æ¥åœ¨æ–¹æ³•å†…è°ƒç”¨ï¼Œä½†å¦‚æœæ–¹æ³•èƒ½æ›´ä¸“æ³¨äºæ•°æ®é€»è¾‘è€Œä¸ç”¨å»å¤„ç† DOM äº‹ä»¶çš„ç»†èŠ‚ä¼šæ›´å¥½ã€‚

ä¸ºè§£å†³è¿™ä¸€é—®é¢˜ï¼ŒVue ä¸º `v-on` æä¾›äº†**äº‹ä»¶ä¿®é¥°ç¬¦**ã€‚

```html
<!-- å•å‡»äº‹ä»¶å°†åœæ­¢ä¼ é€’ -->
<a @click.stop="doThis"></a>

<!-- æäº¤äº‹ä»¶å°†ä¸å†é‡æ–°åŠ è½½é¡µé¢ -->
<form @submit.prevent="onSubmit"></form>

<!-- ä¿®é¥°è¯­å¯ä»¥ä½¿ç”¨é“¾å¼ä¹¦å†™ -->
<a @click.stop.prevent="doThat"></a>

<!-- ä¹Ÿå¯ä»¥åªæœ‰ä¿®é¥°ç¬¦ -->
<form @submit.prevent></form>

<!-- ä»…å½“ event.target æ˜¯å…ƒç´ æœ¬èº«æ—¶æ‰ä¼šè§¦å‘äº‹ä»¶å¤„ç†å™¨ -->
<!-- ä¾‹å¦‚ï¼šäº‹ä»¶å¤„ç†å™¨ä¸æ¥è‡ªå­å…ƒç´  -->
<div @click.self="doThat">...</div>

<!-- æ·»åŠ äº‹ä»¶ç›‘å¬å™¨æ—¶ï¼Œä½¿ç”¨ `capture` æ•è·æ¨¡å¼ -->
<!-- ä¾‹å¦‚ï¼šæŒ‡å‘å†…éƒ¨å…ƒç´ çš„äº‹ä»¶ï¼Œåœ¨è¢«å†…éƒ¨å…ƒç´ å¤„ç†å‰ï¼Œå…ˆè¢«å¤–éƒ¨å¤„ç† -->
<div @click.capture="doThis">...</div>

<!-- ç‚¹å‡»äº‹ä»¶æœ€å¤šè¢«è§¦å‘ä¸€æ¬¡ -->
<a @click.once="doThis"></a>
```



åœ¨ç›‘å¬é”®ç›˜äº‹ä»¶æ—¶ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æ£€æŸ¥ç‰¹å®šçš„æŒ‰é”®ã€‚Vue å…è®¸åœ¨ `v-on` æˆ– `@` ç›‘å¬æŒ‰é”®äº‹ä»¶æ—¶`æ·»åŠ æŒ‰é”®ä¿®é¥°ç¬¦`ã€‚

```
 <!-- æŒ‰é”®ä¿®é¥°ç¬¦ -->
 <!-- åŸç”Ÿ -->
 <input type="text" @keyup="print1">
 <!-- vue -->
 <input type="text" @keyup.enter="print2">
```

```js
methods: {
	print1 (event) {
        if (event.keyCode === 13) {
        	console.log('æ‰“å°1')
        }
    },
    print2 () {
    	console.log('æ‰“å°2')
    }
}
```

å®Œæ•´æ¡ˆä¾‹: 

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç»‘å®šäº‹ä»¶</title>
  <style>
    .parent {
      width: 200px;
      height: 200px;
      background-color: #f66;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    .child {
      width: 100px;
      height: 100px;
      background-color: #ccc;
    }
  </style>
</head>
<body>
  <div id="app">
    <!-- å†…è”äº‹ä»¶å¤„ç†å™¨ -->
    <button v-on:click="count++">åŠ 1</button> {{ count }}<br />
    <!-- æ–¹æ³•äº‹ä»¶å¤„ç†å™¨ -->
    <button v-on:click="add">åŠ 1</button> {{ count }}<br />

    <button @click="say('hello', $event)">say hello</button>
    <button @click="say('bye', $event)">say bye</button>

    <!-- äº‹ä»¶å¯¹è±¡ - é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜»æ­¢é»˜è®¤äº‹ä»¶ -->
    <form @submit="getUserInfo">
      <input type="text" name="userName" placeholder="ç”¨æˆ·å" />
      <input type="password" name="password" placeholder="å¯†ç " />
      <input type="submit" value="æäº¤">
    </form>
    <div class="parent" @click="print('parent', $event)">
      <div class="child" @click="print('child', $event)"></div>
    </div>

    <!-- äº‹ä»¶ä¿®é¥°ç¬¦ - é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼Œé˜»æ­¢é»˜è®¤äº‹ä»¶  -->
    <form @submit.prevent="getUserInfoVue">
      <input type="text" name="userName" placeholder="ç”¨æˆ·å" />
      <input type="password" name="password" placeholder="å¯†ç " />
      <input type="submit" value="æäº¤">
    </form>
    <div class="parent" @click="printVue('parent')">
      <div class="child" @click.stop="printVue('child')"></div>
    </div>

    <!-- äº‹ä»¶å¯¹è±¡ -  å›è½¦æ—¶æ‰“å°æ•°æ® -->
    <input type="text" @keyup="printData" />
    <!-- æŒ‰é”®ä¿®é¥°ç¬¦ -  å›è½¦æ—¶æ‰“å°æ•°æ® -->
    <input type="text" @keyup.enter="printDataVue" />
    <!-- vue2ä¸­å¯ä»¥ æ ¹æ® keyCode ä½œä¸ºä¿®é¥°ç¬¦, vue3ä¸­ä¸æ”¯æŒ -->
    <input type="text" @keyup.13="printDataVueCode" />
  </div>
</body>
 <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>

  const { createApp } = Vue
  const app = createApp({
    data () {
      return {
        count: 10,
        name: 'Vue.js',
        text: '1'
      }
    },
    methods: { // æ‰€æœ‰è‡ªå®šä¹‰çš„vueçš„äº‹ä»¶éƒ½åº”è¯¥å†™åœ¨ methods ä¸­
      // å¦‚æœä½¿ç”¨äº‹ä»¶æ—¶ï¼Œæ²¡æœ‰æ·»åŠ (),é‚£ä¹ˆäº‹ä»¶å«æœ‰é»˜è®¤å‚æ•°ä¸º event
      add (event) {
        // thiså…¶å®å°±æ˜¯vueçš„å®ä¾‹
        // this.count++
        // this.count += 1
        this.count = this.count + 1
        console.log(this.name)
        console.log(event) // PointerEventÂ ä¸åŸç”Ÿjsä¸­çš„äº‹ä»¶å¯¹è±¡ä¿æŒä¸€è‡´
      },
      // å¦‚æœä½¿ç”¨äº‹ä»¶æ—¶æ·»åŠ (),å¹¶ä¸”è¿˜æƒ³ç”¨äº‹ä»¶å¯¹è±¡ï¼Œé‚£ä¹ˆä¼ é€’äº‹ä»¶å¯¹è±¡çš„vueçš„ä¸“å±å‚æ•° $event
      say (msg, event) {
        console.log(msg, event)
      },
      getUserInfo (event) {
        event.preventDefault()
      },
      getUserInfoVue(){
        console.log('getUserInfoVue...')
      },
      print (msg, event) {
        event.stopPropagation()
        console.log(msg)
      },
      printVue (msg) {
        console.log(msg)
      },
      printData (event) {
        if (event.keyCode === 13) {
          console.log('1')
        }
      },
      printDataVue () {
        console.log(2)
      },
      printDataVueCode () {
        console.log(3)
      }
    }
  })

  app.mount('#app')
  
</script>

</html>
```



### 2.5 æ¡ä»¶æ¸²æŸ“

`v-if` æŒ‡ä»¤ç”¨äºæ¡ä»¶æ€§åœ°æ¸²æŸ“ä¸€å—å†…å®¹ã€‚è¿™å—å†…å®¹åªä¼šåœ¨æŒ‡ä»¤çš„è¡¨è¾¾å¼è¿”å›çœŸå€¼æ—¶æ‰è¢«æ¸²æŸ“ã€‚

ä¹Ÿå¯ä»¥ä½¿ç”¨ `v-else` ä¸º `v-if` æ·»åŠ ä¸€ä¸ªâ€œelse åŒºå—â€

ä¸€ä¸ª `v-else` å…ƒç´ å¿…é¡»è·Ÿåœ¨ä¸€ä¸ª `v-if` æˆ–è€… `v-else-if` å…ƒç´ åé¢ï¼Œå¦åˆ™å®ƒå°†ä¸ä¼šè¢«è¯†åˆ«ã€‚

```
<div v-if="grade >= 90">ä¼˜</div>
<div v-else-if="grad" >= 80">è‰¯</div>
<div v-else-if="grade >= 70">ä¸­</div>
<div v-else-if="grade >= 60">å·®</div>
<div v-else>ä¸åŠæ ¼</div>
```

```js
data () {
    return {
        grade: 66
    }
}
```

> æƒ³è¦åˆ‡æ¢ä¸æ­¢ä¸€ä¸ªå…ƒç´ ,åœ¨è¿™ç§æƒ…å†µä¸‹æˆ‘ä»¬å¯ä»¥åœ¨ä¸€ä¸ª `<template>` å…ƒç´ ä¸Šä½¿ç”¨ `v-if`ï¼Œè¿™åªæ˜¯ä¸€ä¸ªä¸å¯è§çš„åŒ…è£…å™¨å…ƒç´ ï¼Œæœ€åæ¸²æŸ“çš„ç»“æœå¹¶ä¸ä¼šåŒ…å«è¿™ä¸ª `<template>` å…ƒç´ ã€‚---- templateæ˜¯ä¸€ä¸ªç©ºæ ‡ç­¾

å¦ä¸€ä¸ªå¯ä»¥ç”¨æ¥æŒ‰æ¡ä»¶æ˜¾ç¤ºä¸€ä¸ªå…ƒç´ çš„æŒ‡ä»¤æ˜¯ `v-show`ã€‚å…¶ç”¨æ³•åŸºæœ¬ä¸€æ ·ï¼š

ä¸åŒä¹‹å¤„åœ¨äº `v-show` ä¼šåœ¨ DOM æ¸²æŸ“ä¸­ä¿ç•™è¯¥å…ƒç´ ï¼›`v-show` ä»…åˆ‡æ¢äº†è¯¥å…ƒç´ ä¸Šåä¸º `display` çš„ CSS å±æ€§ã€‚

> `v-show` ä¸æ”¯æŒåœ¨ `<template>` å…ƒç´ ä¸Šä½¿ç”¨ï¼Œä¹Ÿä¸èƒ½å’Œ `v-else` æ­é…ä½¿ç”¨ã€‚

```
<div v-show="grade >= 90 && grade < 100">ä¼˜</div>
<div v-show="grade >= 80 && grade < 90">è‰¯</div>
<div v-show="grade >= 70 && grade < 80">ä¸­</div>
<div v-show="grade >= 60 && grade < 70">å·®</div>
<div v-show="grade < 60">ä¸åŠæ ¼</div>
```



å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¡ä»¶æ¸²æŸ“</title>
</head>
<body>
  <div id="app">
    <button @click="grade++"> åŠ </button> {{ grade }}<button @click="grade--">å‡</button>
    <!-- v-if v-else-if v-else -->
    <div v-if="grade >=90">ä¼˜</div>
    <div v-else-if="grade >=80">è‰¯</div>
    <div v-else-if="grade >=70">ä¸­</div>
    <div v-else-if="grade >=60">å·®</div>
    <div v-else>ä¸åŠæ ¼</div>

    <hr />
    <!-- v-show -->
    <div v-show="grade >= 90">ä¼˜</div>
    <div v-show="grade >= 80 && grade < 90">è‰¯</div>
    <div v-show="grade >= 70 && grade < 80">ä¸­</div>
    <div v-show="grade >= 60 && grade < 70">å·®</div>
    <div v-show="grade < 60">ä¸åŠæ ¼</div>

    <!-- å‡å¦‚ä¸åŒæ¡ä»¶ä¸‹éœ€è¦åŒæ—¶æ§åˆ¶å¤šä¸ªå…ƒç´ çš„æ˜¾ç¤ºå’Œä¸æ˜¾ç¤º -->
    <div v-if="flag">1</div>
    <div v-if="flag">2</div>
    <div v-if="flag">3</div>
    <!-- template å±äºvueæ¡†æ¶ä¸­çš„ç©ºæ ‡ç­¾ï¼Œå®¡æŸ¥å…ƒç´ æ—¶ä¸ä¼šè¢«æ¸²æŸ“å‡ºæ¥ -->
    <template v-if="flag">
      <div>4</div>
      <div>5</div>
      <div>6</div>
    </template>

  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>

  const { createApp } = Vue
  const app = createApp({
    data () {
      return {
        grade: 61,
        flag: true
      }
    }
  })

  app.mount('#app')
  
</script>

</html>
```

> `v-if` vs `v-show`
>
> `v-if` æ˜¯â€œçœŸå®çš„â€æŒ‰æ¡ä»¶æ¸²æŸ“ï¼Œå› ä¸ºå®ƒç¡®ä¿äº†åœ¨åˆ‡æ¢æ—¶ï¼Œæ¡ä»¶åŒºå—å†…çš„äº‹ä»¶ç›‘å¬å™¨å’Œå­ç»„ä»¶éƒ½ä¼šè¢«é”€æ¯ä¸é‡å»ºã€‚
>
> `v-if` ä¹Ÿæ˜¯**æƒ°æ€§**çš„ï¼šå¦‚æœåœ¨åˆæ¬¡æ¸²æŸ“æ—¶æ¡ä»¶å€¼ä¸º falseï¼Œåˆ™ä¸ä¼šåšä»»ä½•äº‹ã€‚æ¡ä»¶åŒºå—åªæœ‰å½“æ¡ä»¶é¦–æ¬¡å˜ä¸º true æ—¶æ‰è¢«æ¸²æŸ“ã€‚
>
> ç›¸æ¯”ä¹‹ä¸‹ï¼Œ`v-show` ç®€å•è®¸å¤šï¼Œå…ƒç´ æ— è®ºåˆå§‹æ¡ä»¶å¦‚ä½•ï¼Œå§‹ç»ˆä¼šè¢«æ¸²æŸ“ï¼Œåªæœ‰ CSS `display` å±æ€§ä¼šè¢«åˆ‡æ¢ã€‚
>
> æ€»çš„æ¥è¯´ï¼Œ`v-if` æœ‰æ›´é«˜çš„åˆ‡æ¢å¼€é”€ï¼Œè€Œ `v-show` æœ‰æ›´é«˜çš„åˆå§‹æ¸²æŸ“å¼€é”€ã€‚å› æ­¤ï¼Œå¦‚æœéœ€è¦é¢‘ç¹åˆ‡æ¢ï¼Œåˆ™ä½¿ç”¨ `v-show` è¾ƒå¥½ï¼›å¦‚æœåœ¨è¿è¡Œæ—¶ç»‘å®šæ¡ä»¶å¾ˆå°‘æ”¹å˜ï¼Œåˆ™ `v-if` ä¼šæ›´åˆé€‚ã€‚



### 2.6 åˆ—è¡¨æ¸²æŸ“

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ `v-for` æŒ‡ä»¤åŸºäºä¸€ä¸ªæ•°ç»„(å¯¹è±¡ã€å­—ç¬¦ä¸²)æ¥æ¸²æŸ“ä¸€ä¸ªåˆ—è¡¨ã€‚`v-for` æŒ‡ä»¤çš„å€¼éœ€è¦ä½¿ç”¨ `item in items` å½¢å¼çš„ç‰¹æ®Šè¯­æ³•ï¼Œå…¶ä¸­ `items` æ˜¯æºæ•°æ®çš„æ•°ç»„ï¼Œè€Œ `item` æ˜¯è¿­ä»£é¡¹çš„**åˆ«å**

```
data() {
  return {
    items: [{ message: 'Foo' }, { message: 'Bar' }]
  }
}

<li v-for="item in items">
  {{ item.message }}
</li>
```

åœ¨ `v-for` å—ä¸­å¯ä»¥å®Œæ•´åœ°è®¿é—®çˆ¶ä½œç”¨åŸŸå†…çš„å±æ€§å’Œå˜é‡ã€‚`v-for` ä¹Ÿæ”¯æŒä½¿ç”¨å¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºå½“å‰é¡¹çš„ä½ç½®ç´¢å¼•ã€‚

```
data() {
  return {
    parentMessage: 'Parent',
    items: [{ message: 'Foo' }, { message: 'Bar' }]
  }
}

<li v-for="(item, index) in items">
  {{ parentMessage }} - {{ index }} - {{ item.message }}
</li>
```



#### v-if & v-foråŒæ—¶ç”¨åœ¨ä¸€ä¸ªå…ƒç´ ä¸Š

> v-if ä¸ v-for åŒæ—¶å­˜åœ¨äºä¸€ä¸ªå…ƒç´ ä¸Šï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ
>
> `vue3_if_for.html`
>
> ```html
> <!DOCTYPE html>
> <html lang="en">
> <head>
> <meta charset="UTF-8">
> <meta http-equiv="X-UA-Compatible" content="IE=edge">
> <meta name="viewport" content="width=device-width, initial-scale=1.0">
> <title>vue3çš„v-ifä¸v-forä¼˜å…ˆçº§</title>
> </head>
> <body>
> <div id="app">
>  <ul>
>    <li v-for="(item, index) of arr" :key="index" v-if="flag">
>      {{ item }}
>    </li>
>  </ul>
> </div>
> </body>
> <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
> <script>
> Vue.createApp({
>  data () {
>    return {
>      arr: ['a', 'b', 'c', 'd'],
>      flag: false
>    }
>  }
> }).mount('#app')
> </script>
> </html>
> ```
>
> `vue2_if_for.html`
>
> ```html
> <!DOCTYPE html>
> <html lang="en">
> <head>
> <meta charset="UTF-8">
> <meta http-equiv="X-UA-Compatible" content="IE=edge">
> <meta name="viewport" content="width=device-width, initial-scale=1.0">
> <title>vue2çš„v-ifä¸v-forä¼˜å…ˆçº§</title>
> </head>
> <body>
> <div id="app">
>  <ul>
>    <li v-for="(item, index) of arr" :key="index" v-if="flag">
>      {{ item }}
>    </li>
>  </ul>
> </div>
> </body>
> <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
> <script>
> new Vue({
>  data: {
>    arr: ['a', 'b', 'c', 'd'],
>    flag: false
>  }
> }).$mount('#app')
> 
> </script>
> </html>
> ```
>
> > é€šè¿‡`å®¡æŸ¥å…ƒç´ `å¾—çŸ¥ï¼š
> >
> > vue3ä¸­ï¼Œv-ifçš„ä¼˜å…ˆçº§é«˜äºv-for
> >
> > vue2ä¸­ï¼Œv-forçš„ä¼˜å…ˆçº§é«˜äºv-if



#### æ•°ç»„æ›´æ–°æ£€æµ‹

**a. ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•æ“ä½œæ•°ç»„ï¼Œå¯ä»¥æ£€æµ‹å˜åŠ¨** 

â€‹	push() pop() shift() unshift() splice() sort() reverse()

**b. filter(), concat() å’Œ slice() ,map(),æ–°æ•°ç»„æ›¿æ¢æ—§æ•°ç»„**

**c. ä¸èƒ½æ£€æµ‹ä»¥ä¸‹å˜åŠ¨çš„æ•°ç»„**

â€‹	ç”±äº JavaScript çš„é™åˆ¶ï¼ŒVue ä¸èƒ½æ£€æµ‹ä»¥ä¸‹æ•°ç»„çš„å˜åŠ¨ï¼š

â€‹      **1.å½“ä½ åˆ©ç”¨ç´¢å¼•ç›´æ¥è®¾ç½®ä¸€ä¸ªæ•°ç»„é¡¹æ—¶ï¼Œä¾‹å¦‚ï¼švm.items[indexOfItem] = newValue**

â€‹        1-1.Vue.set(vm.items, indexOfItem, newValue)

â€‹               Vue.set(vm.arr, 2, 30) //å¦‚æœåœ¨å®ä¾‹ä¸­å¯ä»¥é€šè¿‡ this.$set(vm.arr, 2, 30)

â€‹        1-2 vm.items.splice(indexOfItem, 1, newValue)



â€‹      **2.å½“ä½ ä¿®æ”¹æ•°ç»„çš„é•¿åº¦æ—¶ï¼Œä¾‹å¦‚ï¼švm.items.length = newLength**

â€‹        vm.items.splice(newLength)

> æ³¨ï¼šç»“åˆ$forceUpdateå­¦ä¹ 



### 2.7 è¡¨å•è¾“å…¥ç»‘å®š

åœ¨å‰ç«¯å¤„ç†è¡¨å•æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å°†è¡¨å•è¾“å…¥æ¡†çš„å†…å®¹åŒæ­¥ç»™ JavaScript ä¸­ç›¸åº”çš„å˜é‡

```
<input
  :value="text"
  @input="event => text = event.target.value">
```

`v-model` æŒ‡ä»¤å¸®æˆ‘ä»¬ç®€åŒ–äº†è¿™ä¸€æ­¥éª¤ï¼š

```
<input v-model="text">
```

`v-model` è¿˜å¯ä»¥ç”¨äºå„ç§ä¸åŒç±»å‹çš„è¾“å…¥ï¼Œ`<textarea>`ã€`<select>` å…ƒç´ ã€‚å®ƒä¼šæ ¹æ®æ‰€ä½¿ç”¨çš„å…ƒç´ è‡ªåŠ¨ä½¿ç”¨å¯¹åº”çš„ DOM å±æ€§å’Œäº‹ä»¶ç»„åˆï¼š

> - æ–‡æœ¬ç±»å‹çš„ `<input>` å’Œ `<textarea>` å…ƒç´ ä¼šç»‘å®š `value` property å¹¶ä¾¦å¬ `input` äº‹ä»¶ï¼›
> - `<input type="checkbox">` å’Œ `<input type="radio">` ä¼šç»‘å®š `checked` property å¹¶ä¾¦å¬ `change` äº‹ä»¶ï¼›
> - `<select>` ä¼šç»‘å®š `value` property å¹¶ä¾¦å¬ `change` äº‹ä»¶ 

> `v-model` ä¼šå¿½ç•¥ä»»ä½•è¡¨å•å…ƒç´ ä¸Šåˆå§‹çš„ `value`ã€`checked` æˆ– `selected` attributeã€‚å®ƒå°†å§‹ç»ˆå°†å½“å‰ç»‘å®šçš„ JavaScript çŠ¶æ€è§†ä¸ºæ•°æ®çš„æ­£ç¡®æ¥æºã€‚ä½ åº”è¯¥åœ¨ JavaScript ä¸­ä½¿ç”¨`data` é€‰é¡¹æ¥å£°æ˜è¯¥åˆå§‹å€¼ã€‚

å®Œæ•´æ¡ˆä¾‹ï¼š 

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¡¨å•è¾“å…¥ç»‘å®š</title>
</head>
<body>
  <div id="app">
    <div>
      ç”¨æˆ·å: <input type="text" v-model="userName" /> {{ userName }}
    </div>
    <div>
      å¯†  ç : <input type="password" v-model="password" /> {{ password }}
    </div>
    <div>
      æ€§  åˆ«: <input type="radio" name="sex" v-model="sex" value="ç”·"/>ç”·<input type="radio" name="sex" v-model="sex" value="å¥³"/>å¥³ --- {{ sex }}
    </div>
    <div>
      é˜¶  æ®µ: <select v-model="lesson">
        <option disabled value="">è¯·é€‰æ‹©</option>
        <option :value="1">ä¸€é˜¶æ®µ</option>
        <option :value="2">äºŒé˜¶æ®µ</option>
        <option :value="3">ä¸‰é˜¶æ®µ</option>
      </select> ---- {{ lesson === 1 ? 'ä¸€é˜¶æ®µ' : lesson === 2 ? 'äºŒé˜¶æ®µ' : 'ä¸‰é˜¶æ®µ' }}
    </div>
    <div>
      çˆ±  å¥½:
      <input type="checkbox" name="hobby" value="ğŸ€" v-model="hobby"/>ğŸ€
      <input type="checkbox" name="hobby" value="âš½" v-model="hobby"/>âš½
      <input type="checkbox" name="hobby" value="ğŸ“" v-model="hobby"/>ğŸ“
      <input type="checkbox" name="hobby" value="âš¾" v-model="hobby"/>âš¾
      <input type="checkbox" name="hobby" value="ğŸŒ" v-model="hobby"/>ğŸŒ
    </div> ---- {{ hobby }}
    <div>
      å¤‡  æ³¨: <textarea v-model="note"></textarea> {{ note }}
    </div>
    <div>
      <input type="checkbox" v-model="flag"/> åŒæ„*******åè®® --- {{ flag }}
    </div>
    <div>
      <input type="button" value="æäº¤" @click="submit" /> 
    </div>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  Vue.createApp({
    data () {
      return {
        userName: '',
        password: '',
        sex: 'ç”·',
        lesson: '',
        note: '',
        hobby: ['ğŸŒ'], // è¡¨ç¤ºå¤šé€‰-æ•°ç»„
        flag: false // è¡¨ç¤ºå¼€å…³ - boolean
      }
    },
    methods: {
      submit () {
        if (this.flag) {
          console.log({
            userName: this.userName,
            password: this.password,
            sex: this.sex,
            hobby: this.hobby,
            lesson: this.lesson,
            note: this.note
          })
        } else {
          alert('è¯·å…ˆå‹¾é€‰ç”¨æˆ·åè®®')
        }
      }
    }
  }).mount('#app')
</script>
</html>
```

> ä¿®é¥°ç¬¦
>
> .lazy        --- inputå¤±å»ç„¦ç‚¹æ—¶åŒæ­¥ä¸€æ¬¡
>
> .number --- è¾“å‡ºçš„ä¸ºæ•°å­—
>
> .trim        --- å»é™¤ä¸¤ç«¯çš„ç©ºæ ¼



### 2.8 ç±»ä¸æ ·å¼ç»‘å®š

æ•°æ®ç»‘å®šçš„ä¸€ä¸ªå¸¸è§éœ€æ±‚åœºæ™¯æ˜¯æ“çºµå…ƒç´ çš„ CSS class åˆ—è¡¨å’Œå†…è”æ ·å¼ã€‚å› ä¸º `class` å’Œ `style` éƒ½æ˜¯ attributeï¼Œæˆ‘ä»¬å¯ä»¥å’Œå…¶ä»– attribute ä¸€æ ·ä½¿ç”¨ `v-bind` å°†å®ƒä»¬å’ŒåŠ¨æ€çš„å­—ç¬¦ä¸²ç»‘å®šã€‚ä½†æ˜¯ï¼Œåœ¨å¤„ç†æ¯”è¾ƒå¤æ‚çš„ç»‘å®šæ—¶ï¼Œé€šè¿‡æ‹¼æ¥ç”Ÿæˆå­—ç¬¦ä¸²æ˜¯éº»çƒ¦ä¸”æ˜“å‡ºé”™çš„ã€‚å› æ­¤ï¼ŒVue ä¸“é—¨ä¸º `class` å’Œ `style` çš„ `v-bind` ç”¨æ³•æä¾›äº†ç‰¹æ®Šçš„åŠŸèƒ½å¢å¼ºã€‚é™¤äº†å­—ç¬¦ä¸²å¤–ï¼Œè¡¨è¾¾å¼çš„å€¼ä¹Ÿå¯ä»¥æ˜¯å¯¹è±¡æˆ–æ•°ç»„ã€‚

> ä¸ç®¡æ˜¯ç±»classè¿˜æ˜¯æ ·å¼styleï¼Œéƒ½æœ‰å¯¹è±¡å’Œæ•°ç»„çš„å†™æ³•

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ç±»ä¸æ ·å¼ç»‘å®š</title>
  <style>
    .a {
      font-size: 30px;
    }
    .b {
      color: #f66;
    }
  </style>
</head>
<body>
  <div id="app">
    <input type="checkbox" v-model="flag" />
    <div class="a b">ç¾¤ç»„é€‰æ‹©å™¨</div>
    <!-- åœ¨flagå­—æ®µä¸ºçœŸæ—¶ï¼Œæ‰æ˜¾ç¤ºçº¢è‰²çš„30pxçš„å­—ä½“ -->
    <!-- classå¯¹è±¡å†™æ³•,keyä¸ºå®šä¹‰çš„æ ·å¼ï¼Œvalueä¸ºæ¡ä»¶ -->
    <div :class="{ a: flag, b: flag }">classçš„å¯¹è±¡å†™æ³•</div>
    <!-- classæ•°ç»„å†™æ³• -->
    <div :class="[{a: flag}, {b: flag}]">classæ•°ç»„å†™æ³•</div>
    <!-- ä¸‰å…ƒè¿ç®—ç¬¦ -->
    <div :class="flag ? 'a b' : ''">ä¸‰å…ƒè¿ç®—ç¬¦ classå†™æ³•</div>

    <!-- styleå¯¹è±¡å†™æ³•,å°é©¼å³°å¼ä»¥åŠçŸ­æ¨ªçº¿è¿æ¥æ–¹å¼  -->
    <div :style="{ color: color, fontSize: fontSize }">styleå¯¹è±¡å†™æ³•</div>
    <!-- styleæ•°ç»„å†™æ³• -->
    <div :style="[{color: color}, {fontSize: fontSize}]">styleæ•°ç»„å†™æ³•</div>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  Vue.createApp({
    data () {
      return {
        flag: false,
        color: '#00f',
        fontSize: '50px'
      }
    }
  }).mount('#app')
</script>
</html>
```



## ä¸‰.å“åº”å¼

### 3.1 è®¡ç®—å±æ€§

æ¨¡æ¿ä¸­çš„è¡¨è¾¾å¼è™½ç„¶æ–¹ä¾¿ï¼Œä½†ä¹Ÿåªèƒ½ç”¨æ¥åšç®€å•çš„æ“ä½œã€‚å¦‚æœåœ¨æ¨¡æ¿ä¸­å†™å¤ªå¤šé€»è¾‘ï¼Œä¼šè®©æ¨¡æ¿å˜å¾—è‡ƒè‚¿ï¼Œéš¾ä»¥ç»´æŠ¤

æ¨èä½¿ç”¨**è®¡ç®—å±æ€§**æ¥æè¿°ä¾èµ–å“åº”å¼çŠ¶æ€çš„å¤æ‚é€»è¾‘

è®¡ç®—å±æ€§æ˜¯åŸºäºå®ƒä»¬çš„å“åº”å¼**ä¾èµ–**è¿›è¡Œ**ç¼“å­˜**çš„ï¼Œè®¡ç®—å±æ€§æ¯”è¾ƒé€‚åˆå¯¹å¤šä¸ªå˜é‡æˆ–è€…å¯¹è±¡è¿›è¡Œå¤„ç†åè¿”å›ä¸€ä¸ªç»“æœå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´å¤šä¸ªå˜é‡ä¸­çš„æŸä¸€ä¸ªå€¼å‘ç”Ÿäº†å˜åŒ–åˆ™æˆ‘ä»¬ç›‘æ§çš„è¿™ä¸ªå€¼ä¹Ÿå°±ä¼šå‘ç”Ÿå˜åŒ–ã€‚

è®¡ç®—å±æ€§å®šä¹‰åœ¨Vueå¯¹è±¡ä¸­ï¼Œé€šè¿‡å…³é”®è¯ **computed** å±æ€§å¯¹è±¡ä¸­å®šä¹‰ä¸€ä¸ªä¸ªå‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ªå€¼ï¼Œä½¿ç”¨è®¡ç®—å±æ€§æ—¶å’Œ data ä¸­çš„æ•°æ®ä½¿ç”¨æ–¹å¼ä¸€è‡´ã€‚

#### 3.1.1 ä¸€èˆ¬è®¡ç®—å±æ€§ä»¥åŠæ–¹æ³•å¯¹æ¯”

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è®¡ç®—å±æ€§ä»¥åŠæ–¹æ³•å¯¹æ¯”</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
  <div id="app">
    <!-- jsè¡¨è¾¾å¼ -->
    {{ msg.split('').reverse().join('') }} - {{ msg.split('').reverse().join('') }} - {{ msg.split('').reverse().join('') }}
    <!-- æ–¹æ³• -->
    {{ reverseMsgFn() }} -  {{ reverseMsgFn() }} - {{ reverseMsgFn() }} 
    <!-- è®¡ç®—å±æ€§ -->
    {{ reverseMsg }} - {{ reverseMsg }} -  {{ reverseMsg }}
  </div>
</body>
<script>
  const { createApp } = window.Vue
  const app = createApp({
    data () {
      return {
        msg: 'hello vue'
      }
    },
    methods: {
      reverseMsgFn () {
        console.log(1)
        return this.msg.split('').reverse().join('')
      }
    },
    computed: {
      reverseMsg () {
        console.log(2)
        return this.msg.split('').reverse().join('')
      }
    }
    
  })

  // æŒ‚è½½åº”ç”¨
  app.mount('#app')

</script>
</html>
```

> è®¡ç®—å±æ€§å…·æœ‰ä¾èµ–æ€§ï¼Œåªæœ‰å½“ä¾èµ–çš„å€¼å‘ç”Ÿæ”¹å˜ï¼Œæ‰ä¼šé‡æ–°è®¡ç®—
>
> åŒç­‰æ¡ä»¶ä¸‹ï¼Œè®¡ç®—å±æ€§ä¼˜äº æ–¹æ³• ä»¥åŠ jsè¡¨è¾¾å¼ã€‚



#### 3.1.2 å¯å†™è®¡ç®—å±æ€§

è®¡ç®—å±æ€§é»˜è®¤ä»…èƒ½é€šè¿‡è®¡ç®—å‡½æ•°å¾—å‡ºç»“æœã€‚å½“ä½ å°è¯•ä¿®æ”¹ä¸€ä¸ªè®¡ç®—å±æ€§æ—¶ï¼Œä½ ä¼šæ”¶åˆ°ä¸€ä¸ªè¿è¡Œæ—¶è­¦å‘Šã€‚åªåœ¨æŸäº›ç‰¹æ®Šåœºæ™¯ä¸­ä½ å¯èƒ½æ‰éœ€è¦ç”¨åˆ°â€œå¯å†™â€çš„å±æ€§ï¼Œä½ å¯ä»¥é€šè¿‡åŒæ—¶æä¾› getter å’Œ setter æ¥åˆ›å»ºï¼š

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è®¡ç®—å±æ€§ setter</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
  <div id="app">
    <input v-model="firstName" />   +  <input v-model="lastName" /> = {{ fullName }}
    <button @click="reset">é‡ç½®</button>
  </div>
</body>
<script>
  const { createApp } = window.Vue
  const app = createApp({
    data () {
      return {
        firstName: 'John',
        lastName: 'Doe'
      }
    },
    computed: {
      // fullName () {
      //   return this.firstName + ' ' + this.lastName
      // }
      fullName: {
        get () {
          return this.firstName + ' ' + this.lastName
        },
        set (newValue) {
          // æ³¨æ„ï¼šæˆ‘ä»¬è¿™é‡Œä½¿ç”¨çš„æ˜¯è§£æ„èµ‹å€¼è¯­æ³•
          // [this.firstName, this.lastName] = newValue.split(' ')
          this.firstName = newValue.split(' ')[0]
          this.lastName = newValue.split(' ')[1]
        }
      }
    },
    methods: {
      reset () {
        this.fullName = 'zhang san'
      }
    },

  })
  // æŒ‚è½½åº”ç”¨
  app.mount('#app')

</script>
</html>
```



### 3.2 ä¾¦å¬å™¨

ä½¿ç”¨watchæ¥ä¾¦å¬dataä¸­æ•°æ®çš„å˜åŒ–ï¼Œwatchä¸­çš„å±æ€§ä¸€å®šæ˜¯data ä¸­å·²ç»å­˜åœ¨çš„æ•°æ®ã€‚

ä½¿ç”¨åœºæ™¯ï¼š**æ•°æ®å˜åŒ–æ—¶æ‰§è¡Œå¼‚æ­¥æˆ–å¼€é”€æ¯”è¾ƒå¤§çš„æ“ä½œ**ã€‚

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¾¦å¬å±æ€§</title>
  <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
  <div id="app">
    <input type="text" v-model="firstName" /> + <input type="text" v-model="lastName" /> = {{ fullName }}
  </div>
</body>
<script>
  const { createApp } = window.Vue
  const app = createApp({
    data () {
      return {
        firstName: '',
        lastName: '',
        fullName: ''
      }
    },
    watch: {
      firstName (newVal, oldVal) {
        this.fullName = newVal + this.lastName
      },
      lastName (newVal, oldVal) {
        this.fullName = this.firstName + newVal
      }
    }

  })

  // æŒ‚è½½åº”ç”¨
  app.mount('#app')

</script>
</html>
```

ä½¿ç”¨è®¡ç®—å±æ€§å¯ä»¥ç®€åŒ–

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è®¡ç®—å±æ€§PKä¾¦å¬å±æ€§</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
  <div id="app">
    <input type="text" v-model="firstName" /> + <input type="text" v-model="lastName" /> = {{ fullName }}
  </div>
</body>
<script>
  const { createApp } = window.Vue
  const app = createApp({
    data () {
      return {
        firstName: '',
        lastName: ''
      }
    },
    computed: {
      fullName () {
        return this.firstName + this.lastName
      }
    }
  })

  // æŒ‚è½½åº”ç”¨
  app.mount('#app')

</script>
</html>
```

> å¦‚ä½•ç›‘å¬ä¸€ä¸ªå¯¹è±¡ä¸‹çš„å±æ€§çš„å˜åŒ–ï¼Ÿ
>
> `watch` é»˜è®¤æ˜¯æµ…å±‚çš„ï¼šè¢«ä¾¦å¬çš„å±æ€§ï¼Œä»…åœ¨è¢«èµ‹æ–°å€¼æ—¶ï¼Œæ‰ä¼šè§¦å‘å›è°ƒå‡½æ•°â€”â€”è€ŒåµŒå¥—å±æ€§çš„å˜åŒ–ä¸ä¼šè§¦å‘ã€‚å¦‚æœæƒ³ä¾¦å¬æ‰€æœ‰åµŒå¥—çš„å˜æ›´ï¼Œ**ä½ éœ€è¦æ·±å±‚ä¾¦å¬å™¨ï¼Œéœ€è¦åœ¨options Apiä¸­æ·»åŠ  deep: true**
>
> å¦‚æœ**ä¸€å¼€å§‹å°±éœ€è¦ç›‘å¬æ•°æ®ï¼Œéœ€è¦åœ¨options Apiä¸­æ·»åŠ  immediate: true**
>
> å¦‚æœåœ¨**è¾¾åˆ°æŸä¸€ä¸ªæ¡ä»¶ä¸‹å†å¼€å¯ç›‘å¬ï¼Œéœ€è¦ä½¿ç”¨ this.$watch(ç›‘å¬çš„æ•°æ®ï¼Œcallback)æ‰‹åŠ¨å»æ·»åŠ ä¾¦å¬å™¨**
>
> å¦‚æœä¸ä½¿ç”¨æ·±åº¦ä¾¦å¬ï¼Œå¦‚ä½•ç›‘å¬å¯¹è±¡ä¸‹çš„å±æ€§çš„å˜åŒ–ï¼Ÿå¯ä»¥é€šè¿‡ ç›‘å¬ `å¯¹è±¡.å±æ€§`çš„å˜åŒ–

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
 <meta charset="UTF-8">
 <meta http-equiv="X-UA-Compatible" content="IE=edge">
 <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <title>æ·±åº¦ä¾¦å¬</title>
 <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
</head>
<body>
 <div id="app">
    <input type="text" v-model="user.firstName" /> + <input type="text" v-model="user.lastName" /> = <span id="span">{{ user.fullName }}</span> | {{ full }}
    <hr />
    <button @click="count++">åŠ 1</button>{{ count }}
    <button @click="startWatch">å¼€å§‹ç›‘å¬</button>
    <button @click="stopWatch">åœæ­¢ç›‘å¬</button>
 </div>
</body>
<script>
 const { createApp } = Vue
 const app = createApp({
    data () {
      return {
        user: {
          firstName: '1',
          lastName: '2',
          fullName: ''
        },
        count: 100,
        unwatch: null
      }
    },
    computed: { 
      full () {
        return this.user.firstName + this.user.lastName
      }
    },
    watch: {
      // ç›‘å¬å¤±è´¥
      // user (newVal, oldVal) {
      //   this.user.fullName = newVal.firstName + newVal.lastName
      // }
      // æ·±åº¦ä¾¦å¬
      user: {
        deep: true,
        handler (newVal, oldVal) {
          this.user.fullName = newVal.firstName + newVal.lastName
        },
        // è‡ªåŠ¨æ‰§è¡Œä¸€æ¬¡ç›‘å¬æ•°æ®
        immediate: true,
      }
      // 'user.firstName': function (newVal, oldVal)  {
      //   this.user.fullName = newVal + this.user.lastName
      // },
      // 'user.lastName': function(newVal, oldVal)  {
      //   this.user.fullName = this.user.firstName + newVal
      // }
    },
    methods: {
      startWatch () {
        // å¼€å§‹ç›‘å¬  èµ‹å€¼ç»™ä¸€ä¸ªå‡½æ•°ï¼Œç”¨äºåœæ­¢ç›‘å¬
        this.unwatch = this.$watch('count', (newVal, oldVal) => {
          console.log(newVal, oldVal)
        })
      },
      stopWatch () {
        this.unwatch() // åœæ­¢ç›‘å¬
      }
    }
 })

 // æŒ‚è½½åº”ç”¨
 app.mount('#app')

</script>
</html>
```



## å››. ç»„ä»¶ä½¿ç”¨

### 4.1 ç»„ä»¶åŒ–

æ¨¡å—åŒ–å°±æ˜¯å°†ç³»ç»ŸåŠŸèƒ½åˆ†ç¦»æˆç‹¬ç«‹çš„åŠŸèƒ½éƒ¨åˆ†çš„æ–¹æ³•ï¼Œä¸€èˆ¬æŒ‡çš„æ˜¯å•ä¸ªçš„æŸä¸€ç§ä¸œè¥¿ï¼Œä¾‹å¦‚jsã€css

è€Œç»„ä»¶åŒ–é’ˆå¯¹çš„æ˜¯é¡µé¢ä¸­çš„æ•´ä¸ªå®Œæ•´çš„åŠŸèƒ½æ¨¡å—åˆ’åˆ†ï¼Œç»„ä»¶æ˜¯ä¸€ä¸ªhtmlã€cssã€jsã€imageç­‰å¤–é“¾èµ„æºï¼Œè¿™äº›éƒ¨åˆ†ç»„æˆçš„ä¸€ä¸ªèšåˆä½“

> ä¼˜ç‚¹ï¼šä»£ç å¤ç”¨ï¼Œä¾¿äºç»´æŠ¤

åˆ’åˆ†ç»„ä»¶çš„åŸåˆ™ï¼šå¤ç”¨ç‡é«˜çš„ï¼Œç‹¬ç«‹æ€§å¼ºçš„

ç»„ä»¶åº”è¯¥æ‹¥æœ‰çš„ç‰¹æ€§ï¼šå¯ç»„åˆï¼Œå¯é‡ç”¨ï¼Œå¯æµ‹è¯•ï¼Œå¯ç»´æŠ¤





### 4.2 å°è£…ç»„ä»¶

ä¸€ä¸ª Vue ç»„ä»¶åœ¨ä½¿ç”¨å‰éœ€è¦å…ˆè¢«â€œæ³¨å†Œâ€ï¼Œè¿™æ · Vue æ‰èƒ½åœ¨æ¸²æŸ“æ¨¡æ¿æ—¶æ‰¾åˆ°å…¶å¯¹åº”çš„å®ç°ã€‚

- å…ˆæ„å»ºç»„ä»¶çš„æ¨¡æ¿
- å®šä¹‰ç»„ä»¶
- æ³¨å†Œç»„ä»¶
- ä½¿ç”¨ç»„ä»¶

#### 4.2.1 vue2ç»„ä»¶æ³¨å†Œä¸ä½¿ç”¨

åœ¨vue2ä¸­ï¼Œæˆ‘ä»¬é€šè¿‡**Vue.extendæ¥åˆ›å»ºVueçš„å­ç±»**ï¼Œè¿™ä¸ªä¸œè¥¿å…¶å®å°±æ˜¯ç»„ä»¶

ä¹Ÿå°±æ˜¯è¯´Vueå®ä¾‹å’Œç»„ä»¶çš„å®ä¾‹æœ‰å·®åˆ«ä½†æ˜¯å·®åˆ«ä¸å¤§ï¼Œå› ä¸ºæ¯•ç«Ÿä¸€ä¸ªæ˜¯çˆ¶ç±»ä¸€ä¸ªæ˜¯å­ç±»

ä¸€èˆ¬çš„åº”ç”¨ï¼Œä¼šæ‹¥æœ‰ä¸€ä¸ªæ ¹å®ä¾‹ï¼Œåœ¨æ ¹å®ä¾‹é‡Œé¢éƒ½æ˜¯ä¸€ä¸ªä¸€ä¸ªçš„ç»„ä»¶

å› ä¸ºç»„ä»¶æ˜¯è¦åµŒå…¥åˆ°å®ä¾‹æˆ–è€…çˆ¶ç»„ä»¶é‡Œçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç»„ä»¶å¯ä»¥äº’ç›¸åµŒå¥—ï¼Œè€Œä¸”ï¼Œæ‰€æœ‰çš„ç»„ä»¶æœ€å¤–å±‚å¿…é¡»æœ‰ä¸€ä¸ªæ ¹å®ä¾‹ï¼Œ**æ‰€ä»¥ç»„ä»¶åˆ†ä¸ºï¼šå…¨å±€ç»„ä»¶å’Œå±€éƒ¨ç»„ä»¶**

***å…¨å±€ç»„ä»¶åœ¨ä»»æ„çš„å®ä¾‹ã€çˆ¶çº§ç»„ä»¶ä¸­éƒ½èƒ½ä½¿ç”¨ï¼Œå±€éƒ¨ç»„ä»¶åªèƒ½åœ¨åˆ›å»ºè‡ªå·±çš„çˆ¶çº§ç»„ä»¶æˆ–è€…å®ä¾‹ä¸­ä½¿ç”¨***

åˆ›å»ºç»„ä»¶ï¼š

```
Vue.extend(options)
```

**å…¨å±€æ³¨å†Œï¼š**

```
var App = Vue.extend({
	template:"<h1>hello world</h1>"
})
Vue.component('my-app',App)
```

ç®€ä¾¿å†™æ³•ï¼š

```
// åˆ›å»ºç»„ä»¶æ„é€ å™¨å’Œæ³¨å†Œç»„ä»¶åˆå¹¶ä¸€èµ·  
Vue.component('hello',{//Vueä¼šè‡ªåŠ¨çš„å°†æ­¤å¯¹è±¡ç»™Vue.extend
	template:"<h1>hello</h1>"
})
```



> ç»„ä»¶é€šè¿‡templateæ¥ç¡®å®šè‡ªå·±çš„æ¨¡æ¿,templateé‡Œçš„æ¨¡æ¿å¿…é¡»æœ‰æ ¹èŠ‚ç‚¹ï¼Œæ ‡ç­¾å¿…é¡»é—­åˆ

> **ç»„ä»¶çš„å±æ€§æŒ‚è½½é€šè¿‡ï¼šdataæ–¹æ³•æ¥è¿”å›ä¸€ä¸ªå¯¹è±¡ä½œä¸ºç»„ä»¶çš„å±æ€§ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†æ¯ä¸€ä¸ªç»„ä»¶å®ä¾‹éƒ½æ‹¥æœ‰ç‹¬ç«‹çš„dataå±æ€§**



**å±€éƒ¨æ³¨å†Œï¼š**

```
new Vue({
    el:"#app",
    components:{ //åœ¨å®ä¾‹é…ç½®é¡¹é…ç½®
    	'my-app':App
    }
})
```

ç®€ä¾¿å†™æ³•ï¼š

```
 data:{},
    components:{
        'hello':{
            template:"<h1>asdasdasdasdasdas</h1>"
        }
    }
```

åœ¨å®ä¾‹æˆ–è€…ç»„ä»¶ä¸­æ³¨å†Œå¦ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œè¢«æ³¨å†Œçš„ç»„ä»¶åªèƒ½åœ¨æ³¨å†Œå®ƒçš„å®ä¾‹æˆ–ç»„ä»¶çš„æ¨¡æ¿ä¸­ä½¿ç”¨ï¼Œä¸€ä¸ªç»„ä»¶å¯ä»¥è¢«å¤šä¸ªç»„ä»¶æˆ–å®ä¾‹æ³¨å†Œ

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vue2-å…¨å±€æ³¨å†Œç»„ä»¶</title>
</head>
<body>
  <div id="app">
    <my-header></my-header>
  </div>
</body>
<template id="header">
  <header>å¤´éƒ¨-{{msg}}</header>
</template>
 <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
  const Header = {
    template: '#header', 
    data () { 
      return {
        msg: 'hello header'
      }
    },
  }
  Vue.component('my-header',Header)
  new Vue({
  }).$mount('#app')
</script>
</html>
```

å±€éƒ¨æ³¨å†Œç»„ä»¶ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vue2-å±€éƒ¨æ³¨å†Œç»„ä»¶</title>
</head>
<body>
  <div id="app">
    <my-header></my-header>
  </div>
</body>
<template id="header">
  <header>å¤´éƒ¨-{{msg}}</header>
</template>
 <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
  const Header = {
    template: '#header', 
    data () { 
      return {
        msg: 'hello header'
      }
    },
  }

  new Vue({
    components:{
      'my-header':Header
    }
  }).$mount('#app')
</script>
</html>
```



#### 4.2.2 vue3ç»„ä»¶æ³¨å†Œä¸ä½¿ç”¨

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ [Vue åº”ç”¨å®ä¾‹](https://cn.vuejs.org/guide/essentials/application.html)çš„ `app.component()` æ–¹æ³•ï¼Œè®©ç»„ä»¶åœ¨å½“å‰ Vue åº”ç”¨ä¸­å…¨å±€å¯ç”¨

```js
import { createApp } from 'vue'

const app = createApp({})

app.component(
  // æ³¨å†Œçš„åå­—
  'MyComponent',
  // ç»„ä»¶çš„å®ç°
  {
    /* ... */
  }
)
```

`app.component()` æ–¹æ³•å¯ä»¥è¢«é“¾å¼è°ƒç”¨ï¼š

```
app
  .component('ComponentA', ComponentA)
  .component('ComponentB', ComponentB)
  .component('ComponentC', ComponentC)
```

å…¨å±€æ³¨å†Œçš„ç»„ä»¶å¯ä»¥åœ¨æ­¤åº”ç”¨çš„ä»»æ„ç»„ä»¶çš„æ¨¡æ¿ä¸­ä½¿ç”¨

```
<!-- è¿™åœ¨å½“å‰åº”ç”¨çš„ä»»æ„ç»„ä»¶ä¸­éƒ½å¯ç”¨ -->
<ComponentA/>
<ComponentB/>
<ComponentC/>
```

æ‰€æœ‰çš„å­ç»„ä»¶ä¹Ÿå¯ä»¥ä½¿ç”¨å…¨å±€æ³¨å†Œçš„ç»„ä»¶ï¼Œè¿™æ„å‘³ç€è¿™ä¸‰ä¸ªç»„ä»¶ä¹Ÿéƒ½å¯ä»¥åœ¨*å½¼æ­¤å†…éƒ¨*ä½¿ç”¨

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vue3-å…¨å±€æ³¨å†Œç»„ä»¶</title>
</head>
<body>
  <div id="app">
    <!--04. ä½¿ç”¨ç»„ä»¶ å¤§é©¼å³°å¼ çŸ­æ¨ªçº¿å¼  åœ¨htmlæ–‡ä»¶ä¸­åªèƒ½ä½¿ç”¨ çŸ­æ¨ªçº¿å¼  -->
    <my-header></my-header>
    <!-- <myHeader></myHeader> -->
  </div>
</body>
<!-- 01 å®šä¹‰ç»„ä»¶çš„æ¨¡æ¿ -->
<template id="header">
  <header>å¤´éƒ¨-{{msg}}</header>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  // 02.å®šä¹‰ç»„ä»¶ - é¦–å­—æ¯å¤§å†™
  const Header = {
    template: '#header', // ç»‘å®šé¡µé¢çš„æ¨¡æ¿ --- å¿…ä¸å¯å°‘
    // å¯ä»¥å†™ä»»æ„çš„å±äºvueçš„é€‰é¡¹
    data () {
      return {
        msg: 'hello header'
      }
    }
  }
  
  const { createApp } = Vue
  const app = createApp({
  })
  // 03.å…¨å±€æ³¨å†Œç»„ä»¶ --- app.mount('#app') ä¹‹å‰
  app.component('myHeader', Header) // å¤§é©¼å³°å¼
  // app.component('my-header', Header) // çŸ­æ¨ªçº¿å¼

  app.mount('#app')
</script>
</html>
```



å±€éƒ¨æ³¨å†Œç»„ä»¶ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vue3-å±€éƒ¨æ³¨å†Œç»„ä»¶</title>
</head>
<body>
  <div id="app">
    <my-header></my-header>
  </div>
</body>
<template id="header">
  <header>å¤´éƒ¨-{{msg}}</header>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const Header = {
    template: '#header', 
    data () {
      return {
        msg: 'hello header'
      }
    }
  }
  const { createApp } = Vue
  const app = createApp({
    components:{
      'my-header':Header
    }
  })

  app.mount('#app')
</script>
</html>
```



### 4.3 vue2çš„è¿‡æ»¤å™¨

è‡ªå®šä¹‰çš„æ–¹æ³•æœ‰ä¸¤ç§ï¼šå…¨å±€å®šä¹‰å’Œå±€éƒ¨å®šä¹‰ï¼Œ
å…¨å±€å®šä¹‰çš„è¿‡æ»¤å™¨åœ¨ä»»æ„çš„å®ä¾‹ã€ç»„ä»¶ä¸­éƒ½å¯ä»¥ä½¿ç”¨ï¼Œ
å±€éƒ¨å®šä¹‰å°±æ˜¯åœ¨å®ä¾‹ã€ç»„ä»¶ä¸­å®šä¹‰ï¼Œåªèƒ½åœ¨è¿™ä¸ªå®ä¾‹æˆ–ç»„ä»¶ä¸­ä½¿ç”¨

1. **å…¨å±€å®šä¹‰**

   Vue.filter(name,handler)

   nameæ˜¯è¿‡æ»¤å™¨çš„åå­—ï¼Œhandleræ˜¯æ•°æ®æ ¼å¼åŒ–å¤„ç†å‡½æ•°ï¼Œæ¥æ”¶çš„ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯è¦å¤„ç†çš„æ•°æ®ï¼Œè¿”å›ä»€ä¹ˆæ•°æ®ï¼Œæ ¼å¼åŒ–çš„ç»“æœå°±æ˜¯ä»€ä¹ˆ

   åœ¨æ¨¡æ¿ä¸­é€šè¿‡ | (ç®¡é“ç¬¦) æ¥ä½¿ç”¨,åœ¨è¿‡æ»¤å™¨åå­—åé¢åŠ ï¼ˆï¼‰æ¥ä¼ å‚ï¼Œå‚æ•°ä¼šåœ¨handlerå‡½æ•°ä¸­ç¬¬äºŒä¸ªåŠåé¢çš„å½¢å‚æ¥æ¥æ”¶

```
<p>{{price | priceFilter('$')}}</p>

Vue.filter('priceFilter',function(val, type) {
	return type + val
})
```

2. **å±€éƒ¨å®šä¹‰**

   åœ¨å®ä¾‹ã€ç»„ä»¶çš„é…ç½®é¡¹ä¸­è®¾ç½® filtersï¼Œé”®åä¸ºè¿‡æ»¤å™¨åï¼Œå€¼ä¸ºhandler

```
    filters:{
        priceFilter:function (val, type) {
            return type + val
        }
    }
```

å®Œæ•´å®ä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vue2_è¿‡æ»¤å™¨</title>
</head>
<body>
  <div id="app">
    {{ sex }} - {{ sex | sexFilter }} - {{ price }} - {{ price | priceFilter('$') }} - {{ price | priceFilter('ï¿¥') }}
  </div>
</body>
 <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
  // å…¨å±€è¿‡æ»¤å™¨
  Vue.filter('sexFilter', (val) => {
    return val === 1 ? 'ç”·' : 'å¥³'
  })
  new Vue({
    data: {
      sex: 1, // 1 ç”·  0 å¥³
      price: 100
    },
    filters: {
      priceFilter (val, type) {
        return type + val
      }
    }
  }).$mount('#app')
</script>
</html>
```



vue3ä¸­ç§»é™¤äº†è¿‡æ»¤å™¨ï¼Œå¯ä»¥å€ŸåŠ©computedå®ç°è¿‡æ»¤å™¨çš„åŠŸèƒ½ã€‚

```html
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>vue3_ä»£æ›¿è¿‡æ»¤å™¨</title>
</head>
<body>
<div id="app">
 {{ sex }} - {{ newSex }} - {{ price }} - {{zhPrice }} - {{ enPrice }}
</div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
Vue.createApp({
 data(){
   return  {
     sex: 1, // 1 ç”·  0 å¥³
     price: 100
   }
 },
 computed: {
   newSex () {
     return this.sex === 1 ? 'ç”·' : 'å¥³'
   },
   zhPrice () {
    return 'ï¿¥' + this.price
   },
   enPrice () {
    return '$' + this.price
   }
 }
}).mount('#app')
</script>
</html>
```





### 4.4 è™šæ‹Ÿdom

é¢‘ç¹ä¸”å¤æ‚çš„domæ“ä½œé€šå¸¸æ˜¯å‰ç«¯æ€§èƒ½ç“¶é¢ˆçš„äº§ç”Ÿç‚¹ï¼ŒVueæä¾›äº†è™šæ‹Ÿdomçš„è§£å†³åŠæ³•

è™šæ‹Ÿçš„DOMçš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šå¯¹å¤æ‚çš„æ–‡æ¡£DOMç»“æ„ï¼Œæä¾›ä¸€ç§æ–¹ä¾¿çš„å·¥å…·ï¼Œè¿›è¡Œæœ€å°åŒ–åœ°DOMæ“ä½œã€‚è¿™å¥è¯ï¼Œä¹Ÿè®¸è¿‡äºæŠ½è±¡ï¼Œå´åŸºæœ¬æ¦‚å†µäº†è™šæ‹ŸDOMçš„è®¾è®¡æ€æƒ³

(1) æä¾›ä¸€ç§æ–¹ä¾¿çš„å·¥å…·ï¼Œä½¿å¾—å¼€å‘æ•ˆç‡å¾—åˆ°ä¿è¯
(2) ä¿è¯æœ€å°åŒ–çš„DOMæ“ä½œï¼Œä½¿å¾—æ‰§è¡Œæ•ˆç‡å¾—åˆ°ä¿è¯

ä¹Ÿå°±æ˜¯è¯´ï¼Œè™šæ‹Ÿdomçš„æ¡†æ¶/å·¥å…·éƒ½æ˜¯è¿™ä¹ˆåšçš„ï¼š

1. æ ¹æ®è™šæ‹Ÿdomæ ‘æœ€åˆæ¸²æŸ“æˆçœŸå®dom
2. å½“æ•°æ®å˜åŒ–ï¼Œæˆ–è€…è¯´æ˜¯é¡µé¢éœ€è¦é‡æ–°æ¸²æŸ“çš„æ—¶å€™ï¼Œä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªæ–°çš„å®Œæ•´çš„è™šæ‹Ÿdom
3. æ‹¿æ–°çš„è™šæ‹Ÿdomæ¥å’Œæ—§çš„è™šæ‹Ÿdomåšå¯¹æ¯”ï¼ˆä½¿ç”¨diffç®—æ³•ï¼‰ã€‚å¾—åˆ°éœ€è¦æ›´æ–°çš„åœ°æ–¹ä¹‹åï¼Œæ›´æ–°å†…å®¹

è¿™æ ·çš„è¯ï¼Œå°±èƒ½å¤§é‡å‡å°‘çœŸå®domçš„æ“ä½œ,æé«˜æ€§èƒ½

<img src="https://s1.ax1x.com/2020/05/25/tpHcBn.png" alt="diff" style="zoom: 80%;" />



> ä»€ä¹ˆæ˜¯è™šæ‹Ÿdomï¼Ÿä¸keyå€¼çš„å…³ç³»ï¼Ÿ
>  Virual DOMæ˜¯ç”¨JSå¯¹è±¡è®°å½•ä¸€ä¸ªdomèŠ‚ç‚¹çš„å‰¯æœ¬ï¼Œå½“domå‘ç”Ÿæ›´æ”¹æ—¶å€™ï¼Œå…ˆç”¨è™šæ‹Ÿdomè¿›è¡Œdiffï¼Œç®—å‡ºæœ€å°å·®å¼‚ï¼Œç„¶åå†ä¿®æ”¹çœŸå®domã€‚

```
å½“ç”¨ä¼ ç»Ÿçš„æ–¹å¼æ“ä½œDOMçš„æ—¶å€™ï¼Œæµè§ˆå™¨ä¼šä»æ„å»ºDOMæ ‘å¼€å§‹ä»å¤´åˆ°å°¾æ‰§è¡Œä¸€éæµç¨‹ï¼Œæ•ˆç‡å¾ˆä½ã€‚è€Œè™šæ‹ŸDOMæ˜¯ç”¨javascriptå¯¹è±¡è¡¨ç¤ºçš„ï¼Œè€Œæ“ä½œjavascriptæ˜¯å¾ˆç®€ä¾¿é«˜æ•ˆçš„ã€‚è™šæ‹ŸDOMå’ŒçœŸæ­£çš„DOMæœ‰ä¸€å±‚æ˜ å°„å…³ç³»ï¼Œå¾ˆå¤šéœ€è¦æ“ä½œDOMçš„åœ°æ–¹éƒ½ä¼šå»æ“ä½œè™šæ‹ŸDOMï¼Œæœ€åç»Ÿä¸€ä¸€æ¬¡æ›´æ–°DOMã€‚å› è€Œå¯ä»¥æé«˜æ€§èƒ½
```



#### è™šæ‹ŸDOMçš„Diffç®—æ³•

> è™šæ‹ŸDOMä¸­ï¼Œåœ¨DOMçš„çŠ¶æ€å‘ç”Ÿå˜åŒ–æ—¶ï¼Œè™šæ‹ŸDOMä¼šè¿›è¡ŒDiffè¿ç®—ï¼Œæ¥æ›´æ–°åªéœ€è¦è¢«æ›¿æ¢çš„DOMï¼Œè€Œä¸æ˜¯å…¨éƒ¨é‡ç»˜ã€‚
> åœ¨Diffç®—æ³•ä¸­ï¼Œåªå¹³å±‚çš„æ¯”è¾ƒå‰åä¸¤æ£µè™šæ‹ŸDOMæ ‘çš„èŠ‚ç‚¹ï¼Œæ²¡æœ‰è¿›è¡Œæ·±åº¦çš„éå†ã€‚

1.å¦‚æœèŠ‚ç‚¹ç±»å‹æ”¹å˜ï¼Œç›´æ¥å°†æ—§èŠ‚ç‚¹å¸è½½ï¼Œæ›¿æ¢ä¸ºæ–°èŠ‚ç‚¹ï¼Œæ—§èŠ‚ç‚¹åŒ…æ‹¬ä¸‹é¢çš„å­èŠ‚ç‚¹éƒ½å°†è¢«å¸è½½ï¼Œå¦‚æœæ–°èŠ‚ç‚¹å’Œæ—§èŠ‚ç‚¹ä»…ä»…æ˜¯ç±»å‹ä¸åŒï¼Œä½†ä¸‹é¢çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½ä¸€æ ·æ—¶ï¼Œè¿™æ ·åšä¹Ÿæ˜¯æ•ˆç‡ä¸é«˜çš„ä¸€ä¸ªåœ°æ–¹ã€‚
2.èŠ‚ç‚¹ç±»å‹ä¸å˜ï¼Œå±æ€§æˆ–è€…å±æ€§å€¼æ”¹å˜ï¼Œä¸ä¼šå¸è½½èŠ‚ç‚¹ï¼Œæ‰§è¡ŒèŠ‚ç‚¹æ›´æ–°çš„æ“ä½œã€‚
3.æ–‡æœ¬æ”¹å˜ï¼Œç›´æ¥ä¿®æ”¹æ–‡å­—å†…å®¹ã€‚
4.ç§»åŠ¨ï¼Œå¢åŠ ï¼Œåˆ é™¤å­èŠ‚ç‚¹æ—¶ï¼š



å¦‚æœæƒ³åœ¨ä¸­é—´æ’å…¥èŠ‚ç‚¹Fï¼Œç®€å•ç²—æš´çš„åšæ³•æ˜¯ï¼šå¸è½½Cï¼Œè£…è½½Fï¼Œå¸è½½Dï¼Œè£…è½½Cï¼Œå¸è½½Eï¼Œè£…è½½Dï¼Œè£…è½½Eã€‚å¦‚ä¸‹å›¾ï¼š



![key1](https://s1.ax1x.com/2020/05/25/tpHX4K.png)

å†™ä»£ç æ—¶ï¼Œå¦‚æœæ²¡æœ‰ç»™æ•°ç»„æˆ–æšä¸¾ç±»å‹å®šä¹‰ä¸€ä¸ªkeyï¼Œå°±ä¼šé‡‡ç”¨ä¸Šé¢çš„ç²—æš´ç®—æ³•ã€‚
å¦‚æœä¸ºå…ƒç´ å¢åŠ keyåï¼ŒVueå°±èƒ½æ ¹æ®keyï¼Œç›´æ¥æ‰¾åˆ°å…·ä½“çš„ä½ç½®è¿›è¡Œæ“ä½œï¼Œæ•ˆç‡æ¯”è¾ƒé«˜ã€‚å¦‚ä¸‹å›¾ï¼š

> æœ¬å¯»ç€keyå€¼ç›¸åŒçš„å³å¯å¤ç”¨çš„åŸåˆ™ã€‚![key2](https://s1.ax1x.com/2020/05/25/tpHLAx.png)

***åœ¨v-forä¸­æä¾›keyï¼Œä¸€æ–¹é¢å¯ä»¥æé«˜æ€§èƒ½ï¼Œä¸€æ–¹é¢ä¹Ÿä¼šé¿å…å‡ºé”™***



[è™šæ‹Ÿdomæ¦‚æ‹¬ç†è§£](https://blog.csdn.net/mrliber/article/details/79036828)

[è™šæ‹Ÿdomä¸keyçš„å…³ç³»](https://blog.csdn.net/weixin_42695446/article/details/84680213)

https://blog.csdn.net/luo1914_/article/details/105054883





### 4.5 ç»„ä»¶ä¹‹é—´çš„é€šä¿¡



#### 4.5.1 propsä¼ é€’æ•°æ®

i. çˆ¶å­ç»„ä»¶ä¼ å€¼ (**props down, events up**) 

![props emit](https://s1.ax1x.com/2020/05/25/tpbFEt.png)



ii. å±æ€§éªŒè¯ props:{name:Number} Number,String,Boolean,Array,Object,Function,null(ä¸é™åˆ¶ç±»å‹) 



**ç»„ä»¶å®ä¾‹çš„ä½œç”¨åŸŸæ˜¯å­¤ç«‹çš„,çˆ¶ç»„ä»¶ä¸èƒ½ç›´æ¥ä½¿ç”¨å­ç»„ä»¶çš„æ•°æ®ï¼Œå­ç»„ä»¶ä¹Ÿä¸èƒ½ç›´æ¥ä½¿ç”¨çˆ¶ç»„ä»¶çš„æ•°æ®**

**çˆ¶ç»„ä»¶åœ¨æ¨¡æ¿ä¸­ä½¿ç”¨å­ç»„ä»¶çš„æ—¶å€™å¯ä»¥ç»™å­ç»„ä»¶ä¼ é€’æ•°æ®**

```
 <bbb money="2"></bbb>
```

**å­ç»„ä»¶éœ€è¦é€šè¿‡propså±æ€§æ¥æ¥æ”¶åæ‰èƒ½ä½¿ç”¨**

```
'bbb':{
    props:['money']
}
```

å¦‚æœçˆ¶ç»„ä»¶ä¼ é€’å±æ€§ç»™å­ç»„ä»¶çš„æ—¶å€™é”®åæœ‰'-'ï¼Œå­ç»„ä»¶æ¥æ”¶çš„æ—¶å€™å†™æˆå°é©¼å³°çš„æ¨¡å¼

```
  <bbb clothes-logo='amani' clothes-price="16.58"></bbb>
  props:['clothesLogo','clothesPrice']   å­ç»„ä»¶æ¨¡æ¿ä¸­ï¼š{{clothesLogo}}
```

æˆ‘ä»¬å¯ä»¥ç”¨ v-bind æ¥åŠ¨æ€åœ°å°† prop ç»‘å®šåˆ°çˆ¶ç»„ä»¶çš„æ•°æ®ã€‚æ¯å½“çˆ¶ç»„ä»¶çš„æ•°æ®å˜åŒ–æ—¶ï¼Œè¯¥å˜åŒ–ä¹Ÿä¼šä¼ å¯¼ç»™å­ç»„ä»¶





##### å•å‘æ•°æ®æµ

Prop æ˜¯å•å‘ç»‘å®šçš„ï¼šå½“çˆ¶ç»„ä»¶çš„å±æ€§å˜åŒ–æ—¶ï¼Œå°†ä¼ é€’ç»™å­ç»„ä»¶ï¼Œä½†æ˜¯åè¿‡æ¥ä¸ä¼šã€‚è¿™æ˜¯ä¸ºäº†é˜²æ­¢å­ç»„ä»¶æ— æ„é—´ä¿®æ”¹äº†çˆ¶ç»„ä»¶çš„çŠ¶æ€ï¼Œæ¥é¿å…åº”ç”¨çš„æ•°æ®æµå˜å¾—éš¾ä»¥ç†è§£ã€‚

å¦å¤–ï¼Œæ¯æ¬¡çˆ¶ç»„ä»¶æ›´æ–°æ—¶ï¼Œå­ç»„ä»¶çš„æ‰€æœ‰ prop éƒ½ä¼šæ›´æ–°ä¸ºæœ€æ–°å€¼ã€‚è¿™æ„å‘³ç€ä½ ä¸åº”è¯¥åœ¨å­ç»„ä»¶å†…éƒ¨æ”¹å˜ propã€‚å¦‚æœä½ è¿™ä¹ˆåšäº†ï¼ŒVue ä¼šåœ¨æ§åˆ¶å°ç»™å‡ºè­¦å‘Šã€‚



> æ³¨æ„åœ¨ JavaScript ä¸­å¯¹è±¡å’Œæ•°ç»„æ˜¯å¼•ç”¨ç±»å‹ï¼ŒæŒ‡å‘åŒä¸€ä¸ªå†…å­˜ç©ºé—´ï¼Œå¦‚æœ prop æ˜¯ä¸€ä¸ªå¯¹è±¡æˆ–æ•°ç»„ï¼Œåœ¨å­ç»„ä»¶å†…éƒ¨æ”¹å˜å®ƒä¼šå½±å“çˆ¶ç»„ä»¶çš„çŠ¶æ€ã€‚  





##### propéªŒè¯

æˆ‘ä»¬å¯ä»¥ä¸ºç»„ä»¶çš„ prop æŒ‡å®šéªŒè¯è§„åˆ™ã€‚å¦‚æœä¼ å…¥çš„æ•°æ®ä¸ç¬¦åˆè¦æ±‚ï¼ŒVue ä¼šå‘å‡ºè­¦å‘Šã€‚è¿™å¯¹äºå¼€å‘ç»™ä»–äººä½¿ç”¨çš„ç»„ä»¶éå¸¸æœ‰ç”¨

**éªŒè¯ä¸»è¦åˆ†ä¸ºï¼šç±»å‹éªŒè¯ã€å¿…ä¼ éªŒè¯ã€é»˜è®¤å€¼è®¾ç½®ã€è‡ªå®šä¹‰éªŒè¯**

```html
props:{
    //ç±»å‹éªŒè¯:
    str:String,
    strs:[String,Number],
    //å¿…ä¼ éªŒè¯
    num:{
        type:Number,
        required:true
    },
    //é»˜è®¤æ•°æ®
    bool:{
        type:Boolean,
        // default:true,
        default:function(){
            return true
        }
    },
    //è‡ªå®šä¹‰éªŒè¯å‡½æ•°
    //props:["nums"]
    props:{
        nums:{
            type:Number, //[Number,String,Boolean,Array]
            validator: function (value) {
                return value %2 == 0
            }
        }
    }
}
```

**å½“çˆ¶ç»„ä»¶ä¼ é€’æ•°æ®ç»™å­ç»„ä»¶çš„æ—¶å€™ï¼Œå­ç»„ä»¶ä¸æ¥æ”¶ï¼Œè¿™ä¸ªæ•°æ®å°±ä¼šæŒ‚è½½åœ¨å­ç»„ä»¶çš„æ¨¡æ¿çš„æ ¹èŠ‚ç‚¹ä¸Š**



##### é€ä¼ å±æ€§ä¹‹$attrs

ä¸€ä¸ªåŒ…å«äº†ç»„ä»¶æ‰€æœ‰é€ä¼  attributes çš„å¯¹è±¡ã€‚

[é€ä¼  Attributes](https://cn.vuejs.org/guide/components/attrs.html) æ˜¯æŒ‡ç”±çˆ¶ç»„ä»¶ä¼ å…¥ï¼Œä¸”æ²¡æœ‰è¢«å­ç»„ä»¶å£°æ˜ä¸º props æˆ–æ˜¯ç»„ä»¶è‡ªå®šä¹‰äº‹ä»¶çš„ attributes å’Œäº‹ä»¶å¤„ç†å‡½æ•°ã€‚

`<my-button class="btn"></my-button>`

å­ç»„ä»¶æ¨¡æ¿åªæœ‰buttonï¼Œé‚£ä¹ˆmy-buttonçš„classç›´æ¥é€ä¼ ç»™å­ç»„ä»¶

`<button class="btn"></button>`

é»˜è®¤æƒ…å†µä¸‹ï¼Œè‹¥æ˜¯å•ä¸€æ ¹èŠ‚ç‚¹ç»„ä»¶ï¼Œ`$attrs` ä¸­çš„æ‰€æœ‰å±æ€§éƒ½æ˜¯ç›´æ¥è‡ªåŠ¨ç»§æ‰¿è‡ªç»„ä»¶çš„æ ¹å…ƒç´ ã€‚è€Œå¤šæ ¹èŠ‚ç‚¹ç»„ä»¶åˆ™ä¸ä¼šå¦‚æ­¤ï¼ŒåŒæ—¶ä½ ä¹Ÿå¯ä»¥é€šè¿‡é…ç½® [`inheritAttrs`](https://cn.vuejs.org/api/options-misc.html#inheritattrs) é€‰é¡¹æ¥æ˜¾å¼åœ°å…³é—­è¯¥è¡Œä¸ºã€‚

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>é€ä¼ attribute</title>
  <style>
    .btn {
      border: 0;
      padding: 10px 20px;
    }
    .btn-success {
      background-color: rgb(29, 198, 29);
      color: #fff;
    }
    .btn-danger {
      background-color: rgb(218, 23, 39);
      color: #fff;
    }
    .btn-primary {
      background-color: rgb(75, 104, 236);
      color: #fff;
    }
  </style>
</head>
<body>
  <div id="app">
    <my-button type="a" class="btn-success" @click="print('success')" ></my-button>
    <my-button type="b" class="btn-danger"  @click="print('danger')" ></my-button>
    <my-button type="c" class="btn-primary" @click="print('primary')"></my-button>
  </div>
</body>

<template id="button">
  <!-- Attributes ç»§æ‰¿(classï¼Œ v-onäº‹ä»¶ç»§æ‰¿) -->
  <div class="button">
    <div >æµ‹è¯•</div>
    <!--å€ŸåŠ©v-bindæŒ‡ä»¤å¯ä»¥è®©é€ä¼ çš„å±æ€§æ”¾åœ¨buttonä¸­-->
    <button class="btn" v-bind="$attrs">æŒ‰é’®</button>
  </div>
</template>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp } = Vue
  const app = createApp({
    components: {
      MyButton: {
        template: '#button',
        mounted () {
          console.log('1', this.$attrs)
        },
        inheritAttrs:false // é»˜è®¤é€ä¼ äº†å±æ€§ç»™æœ€å¤–å±‚é˜¶æ®µï¼Œè®¾ç½®falseåˆ™ä¸è®©é€ä¼ 
      }
    },
    methods: {
      print (msg) {
        console.log(msg)
      }
    }
  })
  app.mount('#app')
</script>
</html>
```



#### 4.5.2 ç›‘å¬äº‹ä»¶

##### å­ç»„ä»¶ç»™çˆ¶ç»„ä»¶ä¼ å€¼- $emit

åœ¨ç»„ä»¶çš„æ¨¡æ¿è¡¨è¾¾å¼ä¸­ï¼Œå¯ä»¥ç›´æ¥ä½¿ç”¨ `$emit` æ–¹æ³•è§¦å‘è‡ªå®šä¹‰äº‹ä»¶

`$emit()` æ–¹æ³•åœ¨ç»„ä»¶å®ä¾‹ä¸Šä¹ŸåŒæ ·ä»¥ `this.$emit()` çš„å½¢å¼å¯ç”¨

çˆ¶ç»„ä»¶å¯ä»¥é€šè¿‡ `v-on` (ç¼©å†™ä¸º `@`) æ¥ç›‘å¬äº‹ä»¶

å®Œæ•´æ¡ˆä¾‹:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å­ç»„ä»¶ç»™çˆ¶ç»„ä»¶ä¼ å€¼</title>
</head>
<body>
  <div id="app">
    <my-parent></my-parent>
  </div>
</body>
<template id="parent">
  <div>
    æˆ‘æ˜¯çˆ¶ç»„ä»¶
    <!-- åœ¨çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶çš„åœ°æ–¹ï¼Œç»‘å®šä¸€ä¸ªè‡ªå®šä¹‰çš„äº‹ä»¶ï¼Œè¯¥äº‹ä»¶ç”±çˆ¶ç»„ä»¶å®ç°ï¼Œé»˜è®¤å‚æ•°å³ä¸ºå­ç»„ä»¶ä¼ é€’ç»™çˆ¶ç»„ä»¶çš„å€¼ -->
    <my-child @my-event="getData"></my-child>
  </div>
</template>
<template id="child">
  <div>
    æˆ‘æ˜¯å­ç»„ä»¶
    <button @click="$emit('my-event', 2000)">ä¼ 2000</button>
    <button @click="sendData(3000)">ä¼ 3000</button>
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  // åœ¨å­ç»„ä»¶çš„æŸä¸€ä¸ªäº‹ä»¶å†…éƒ¨ï¼Œé€šè¿‡ this.$emit('è‡ªå®šä¹‰çš„äº‹ä»¶å',ä¼ é€’çš„å‚æ•°)å®Œæˆå­ç»„ä»¶ç»™çˆ¶ç»„ä»¶ä¼ å€¼,å†…è”äº‹ä»¶å¤„ç†å™¨ä¸­ä¸éœ€è¦å†™this
  const { createApp } = Vue
  const app = createApp({
    components: {
      MyParent: {
        template: '#parent',
        components: {
          MyChild: {
            template: '#child',
            methods: {
              sendData (num) {
                this.$emit('my-event', num)
              }
            }
          }
        },
        methods: {
          getData (val) {
            console.log('æ¥æ”¶åˆ°å­ç»„ä»¶çš„æ•°æ®:' + val)
          }
        }
      }
    }
  })

  app.mount('#app')

</script>
</html>
```



##### å­ç»„ä»¶ç»™çˆ¶ç»„ä»¶ä¼ å€¼-å£°æ˜è§¦å‘çš„äº‹ä»¶

ç»„ä»¶è¦è§¦å‘çš„äº‹ä»¶å¯ä»¥æ˜¾å¼åœ°é€šè¿‡ [`emits`](https://cn.vuejs.org/api/options-state.html#emits) é€‰é¡¹æ¥å£°æ˜ï¼š

```js
{
	emits: ['inFocus', 'submit']
}
```

è¿™ä¸ª `emits` é€‰é¡¹è¿˜æ”¯æŒå¯¹è±¡è¯­æ³•ï¼Œå®ƒå…è®¸æˆ‘ä»¬å¯¹è§¦å‘äº‹ä»¶çš„å‚æ•°è¿›è¡ŒéªŒè¯ï¼š

```
{
	 emits: {
        submit(payload) {
          // é€šè¿‡è¿”å›å€¼ä¸º `true` è¿˜æ˜¯ä¸º `false` æ¥åˆ¤æ–­
          // éªŒè¯æ˜¯å¦é€šè¿‡
        }
      }
}
```

è¦ä¸ºäº‹ä»¶æ·»åŠ æ ¡éªŒï¼Œé‚£ä¹ˆäº‹ä»¶å¯ä»¥è¢«èµ‹å€¼ä¸ºä¸€ä¸ªå‡½æ•°ï¼Œæ¥å—çš„å‚æ•°å°±æ˜¯æŠ›å‡ºäº‹ä»¶æ—¶ä¼ å…¥ `this.$emit` çš„å†…å®¹ï¼Œè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼æ¥è¡¨æ˜äº‹ä»¶æ˜¯å¦åˆæ³•ã€‚

```js
{
  emits: {
    // æ²¡æœ‰æ ¡éªŒ
    click: null,

    // æ ¡éªŒ submit äº‹ä»¶
    submit: ({ email, password }) => {
      if (email && password) {
        return true
      } else {
        console.warn('Invalid submit event payload!')
        return false
      }
    }
  },
  methods: {
    submitForm(email, password) {
      this.$emit('submit', { email, password })
    }
  }
}
```

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å­ç»„ä»¶ç»™çˆ¶ç»„ä»¶ä¼ å€¼</title>
</head>
<body>
  <div id="app">
    <my-parent></my-parent>
  </div>
</body>
<template id="parent">
  <div>
    æˆ‘æ˜¯çˆ¶ç»„ä»¶
    <!-- åœ¨çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶çš„åœ°æ–¹ï¼Œç»‘å®šä¸€ä¸ªè‡ªå®šä¹‰çš„äº‹ä»¶ï¼Œè¯¥äº‹ä»¶ç”±çˆ¶ç»„ä»¶å®ç°ï¼Œé»˜è®¤å‚æ•°å³ä¸ºå­ç»„ä»¶ä¼ é€’ç»™çˆ¶ç»„ä»¶çš„å€¼ -->
    <my-child @my-event="getData"></my-child>
  </div>
</template>
<template id="child">
  <div>
    æˆ‘æ˜¯å­ç»„ä»¶
    <button @click="$emit('my-event', 2000)">ä¼ 2000</button>
    <button @click="sendData(3000)">ä¼ 3000</button>
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  // åœ¨å­ç»„ä»¶çš„æŸä¸€ä¸ªäº‹ä»¶å†…éƒ¨ï¼Œé€šè¿‡ this.$emit('è‡ªå®šä¹‰çš„äº‹ä»¶å',ä¼ é€’çš„å‚æ•°)å®Œæˆå­ç»„ä»¶ç»™çˆ¶ç»„ä»¶ä¼ å€¼,å†…è”äº‹ä»¶å¤„ç†å™¨ä¸­ä¸éœ€è¦å†™this
  const { createApp } = Vue
  const app = createApp({
    components: {
      MyParent: {
        template: '#parent',
        components: {
          MyChild: {
            template: '#child',
            emits:{
              'my-event':(payload)=>{
                if(payload>2000){
                  return true
                }else{
                  return false
                }
              }
            },
            methods: {
              sendData (num) {
                this.$emit('my-event', num)
              }
            }
          }
        },
        methods: {
          getData (val) {
            console.log('æ¥æ”¶åˆ°å­ç»„ä»¶çš„æ•°æ®:' + val)
          }
        }
      }
    }
  })

  app.mount('#app')

</script>
</html>
```



##### [è‡ªå®šä¹‰è¡¨å•ç»„ä»¶ä½¿ç”¨v-model](https://cn.vuejs.org/guide/components/events.html#usage-with-v-model)

è‡ªå®šä¹‰äº‹ä»¶å¯ä»¥ç”¨äºå¼€å‘æ”¯æŒ `v-model` çš„è‡ªå®šä¹‰è¡¨å•ç»„ä»¶

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¡¨å•ç»„ä»¶é…åˆ v-model</title>
</head>
<body>
  <div id="app">
    <!--
	é»˜è®¤æƒ…å†µä¸‹ï¼Œv-modelåœ¨ç»„ä»¶ä¸Šæ˜¯ä½¿ç”¨ modelValue ä½œä¸º propï¼Œå¹¶ä»¥update:modelValue ä½œä¸ºå¯¹åº”çš„äº‹ä»¶
    å›é¡¾ï¼šå¦‚æœv-modelæŒ‡ä»¤åº”ç”¨åœ¨æ™®é€šçš„domå…ƒç´ ä¾‹å¦‚inputä¸Šé¢ï¼Œæœ¬è´¨æ˜¯ç»‘å®šäº†valueå±æ€§ä¸ç›‘å¬inputäº‹ä»¶
-->
    <my-input v-model="username" placeholder="ç”¨æˆ·å"></my-input> {{ username }}
    <my-input v-model="password" placeholder="å¯†ç "></my-input>{{ password }}
    <button @click="submit">sub</button>
  </div>
</body>
<template id="input">
  <!--
    <my-input> ç»„ä»¶å†…éƒ¨éœ€è¦åšä¸¤ä»¶äº‹ï¼š
    	å°†å†…éƒ¨åŸç”Ÿinputå…ƒç´ çš„valueç»‘å®šmodelValue 
    	è¾“å…¥æ–°çš„å€¼æ—¶åœ¨ inputå…ƒç´ ä¸Šè§¦å‘ update:modelValue äº‹ä»¶
  -->
  <input type="text" :placeholder="placeholder" :value="modelValue" @input="$emit('update:modelValue', $event.target.value)" />
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const Input = {
    template: '#input',
    props: {
      placeholder: String,
      modelValue: String  // é»˜è®¤æƒ…å†µä¸‹ï¼Œv-model åœ¨ç»„ä»¶ä¸Šéƒ½æ˜¯ä½¿ç”¨ modelValue ä½œä¸º propï¼Œå¹¶ä»¥ update:modelValue ä½œä¸ºå¯¹åº”çš„äº‹ä»¶
    },
    emits: ['update:modelValue']
  }


  const { createApp } = Vue

  const app = createApp({
    components: {
      MyInput: Input
    },
    data () {
      return {
        username: '',
        password: ''
      }
    },
    methods: {
      submit () {
        console.log({
          username: this.username,
          password: this.password
        })
      }
    }
  })

  app.mount('#app')
</script>
</html>
```





##### å¤šä¸ªv-modelçš„ç»‘å®š

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¡¨å•ç»„ä»¶é…åˆ v-model</title>
</head>
<body>
  <div id="app">
    <my-input v-model:username="username" v-model:password="password" ></my-input> 
    <button @click="submit">sub</button>
  </div>
</body>
<template id="input">
  <input type="text" placeholder="ç”¨æˆ·å" :value="username" @input="$emit('update:username', $event.target.value)" />
  <input type="text" placeholder="å¯†ç "  :value="password" @input="$emit('update:password', $event.target.value)" />
</template>
<template id="btn">
  <button @click="$emit('my-click')">æäº¤</button>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const Input = {
    template: '#input',
    props: {
      placeholder: String,
      username: String,  
      password:String
    },
    emits: ['update:username','update:password']
  }


  const { createApp } = Vue

  const app = createApp({
    components: {
      MyInput: Input
    },
    data () {
      return {
        username: '',
        password: ''
      }
    },
    methods: {
      submit () {
        console.log({
          username: this.username,
          password: this.password
        })
      }
    }
  })

  app.mount('#app')
</script>
</html>
```



#### 4.5.3 refå±æ€§æ ‡è®°ç»„ä»¶æˆ–è€…dom

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>refæ ‡è®°ç»„ä»¶æˆ–è€…domå…ƒç´ </title>
</head>
<body>
  <div id="app">
    <!-- refç”¨åˆ°è‡ªå®šä¹‰ç»„ä»¶ï¼Œå¯ä»¥è·å–åˆ°å­ç»„ä»¶çš„å®ä¾‹ -->
    <my-child ref="childRef"></my-child>
    <!-- åŸç”ŸjsDOMæ“ä½œ -->
    <input type="text" id="userName" @input="getJsData">
    <!-- refç”¨åˆ°DOMå…ƒç´ ä¸Šï¼Œå¯ä»¥è·å–åˆ°å½“å‰çš„DOMå…ƒç´  -->
    <input type="text" ref="password" @input="getRefData">
  </div>
</body>
<template id="child">
  <div>
    <h1>ä½¿ç”¨refè·å–å­ç»„ä»¶çš„å®ä¾‹</h1>
  </div>
</template>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp } = Vue
  const app = createApp({
    components: {
      MyChild: {
        template: '#child',
        data () {
          return {
            count: 10
          }
        },
        computed: {
          doubleCount () {
            return this.count * 2
          }
        },
        methods: {
          print () {
            console.log(this.count)
          }
        }
      }
    },
    mounted () {
      console.log(this)
      // çˆ¶ç»„ä»¶å¯ä»¥é€šè¿‡ ref ç›´æ¥è·å–åˆ°å­ç»„ä»¶çš„å®ä¾‹çš„å±æ€§å’Œæ–¹æ³•ç­‰
      console.log(this.$refs.childRef.count)
      console.log(this.$refs.childRef.doubleCount)
      this.$refs.childRef.print()
    },
    methods: {
      getJsData () {
        console.log(document.getElementById('userName').value)
      },
      getRefData () {
        console.log(this.$refs.password.value)
      }
    }
  })
  

  app.mount('#app')
</script>
</html>
```



#### 4.5.4 $parent

å½“å‰ç»„ä»¶å¯èƒ½å­˜åœ¨çš„çˆ¶ç»„ä»¶å®ä¾‹ï¼Œå¦‚æœå½“å‰ç»„ä»¶æ˜¯é¡¶å±‚ç»„ä»¶ï¼Œåˆ™ä¸º `null`ã€‚

å®Œæ•´æ¡ˆä¾‹

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>$parent</title>
</head>
<body>
  <div id="app">
    <my-parent></my-parent>
  </div>
</body>
<template id="parent">
  <div>
    æˆ‘æ˜¯çˆ¶ç»„ä»¶
    <my-child></my-child>
  </div>
</template>
<template id="child">
  <div>
    æˆ‘æ˜¯å­ç»„ä»¶ - {{ $parent.msg }}
    <button @click="$parent.print()">æ‰§è¡Œ</button>
    <button @click="test">æ‰§è¡Œ</button>
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const Parent = {
    template: '#parent',
    components: {
      MyChild: {
        template: '#child',
        methods: {
          test () {
            this.$parent.print()
          }
        }
      }
    },
    data () {
      return {
        msg: 'hello parent'
      }
    },
    methods: {
      print () {
        console.log(this.msg)
      }
    }
  }

  const { createApp } = Vue

  const app = createApp({
    components: {
      MyParent: Parent
    }
  })

  app.mount('#app')

</script>
</html>
```



#### 4.5.5 $root

å½“å‰ç»„ä»¶æ ‘çš„æ ¹ç»„ä»¶å®ä¾‹ã€‚å¦‚æœå½“å‰å®ä¾‹æ²¡æœ‰çˆ¶ç»„ä»¶ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å°±æ˜¯å®ƒè‡ªå·±ã€‚

å®Œæ•´æ¡ˆä¾‹:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>$root </title>
</head>
<body>
  <div id="app">
    <my-parent></my-parent>
  </div>
</body>
<template id="parent">
  <div>
    æˆ‘æ˜¯çˆ¶ç»„ä»¶ --- {{ $root.count }}
    <my-child></my-child>
  </div>
</template>
<template id="child">
  <div>
    æˆ‘æ˜¯å­ç»„ä»¶ --- {{ $root.count }}
    <button @click="$root.add()">åŠ </button>
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const Parent = {
    template: '#parent',
    components: {
      MyChild: {
        template: '#child',
        created () {
          console.log('child', this.$root)
        }
      }
    },
    created () {
      console.log('parent', this.$root)
    }
  }

  const { createApp } = Vue
  const app = createApp({
    components: {
      MyParent: Parent
    },
    data () {
      return {
        count: 100
      }
    },
    methods: {
      add () {
        this.count++
      }
    }
  })

  app.mount('#app')

</script>
</html>
```



#### 4.5.6 vue2äº‹ä»¶æ€»çº¿ 

â€‹	var bus = new Vue()

<img src="https://s1.ax1x.com/2020/05/25/tpbKDs.png" alt="event bus" style="zoom:67%;" />

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vue2 å…„å¼Ÿç»„ä»¶ä¼ å€¼</title>
</head>
<body>
  <div id="app">
    <my-content></my-content>
    <my-footer></my-footer>
  </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
  const bus = new Vue() // ä¸­å¤®äº‹ä»¶æ€»çº¿ä¼ å€¼

  const Content = {
    template: `<div>{{ type }}</div>`,
    data () {
      return {
        type: 'é¦–é¡µ'
      }
    },
    mounted () {
      bus.$on('change-type', (val) => {
        this.type = val
      })
    }
  }

  const Footer = {
    template: `
      <footer>
        <ul>
          <li @click="changeType('é¦–é¡µ')">é¦–é¡µ</li>  
          <li @click="changeType('åˆ†ç±»')">åˆ†ç±»</li>  
          <li @click="changeType('è´­ç‰©è½¦')">è´­ç‰©è½¦</li>  
          <li @click="changeType('æˆ‘çš„')">æˆ‘çš„</li>  
        </ul>
      </footer>
    `,
    methods: {
      changeType (type) {
        bus.$emit('change-type', type)
      }
    }
  }

  new Vue({
    components: {
      MyContent: Content,
      MyFooter: Footer
    }
  }).$mount('#app')
  
</script>
</html>
```



vue3ä¸­æ²¡æœ‰æ˜ç¡®çš„å…„å¼Ÿç»„ä»¶ä¼ å€¼çš„æ–¹æ¡ˆï¼Œå¯ä»¥ä½¿ç”¨çŠ¶æ€æå‡ï¼ˆæ‰¾åˆ°è¿™ä¸¤ä¸ªç»„ä»¶å…±åŒçš„çˆ¶çº§ç»„ä»¶ï¼Œç„¶åé€šè¿‡çˆ¶ä¸å­ä¹‹é—´çš„ä¼ å€¼å®ç°ï¼‰

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vue3 å…„å¼Ÿç»„ä»¶ä¼ å€¼-çŠ¶æ€æå‡</title>
</head>
<body>
  <div id="app">
    <my-content :type="type"></my-content>
    <my-footer @change="getVal"></my-footer>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  

  const Content = {
    template: `<div>{{ type }}</div>`,
    props: ['type']
  }

  const Footer = {
    template: `
      <footer>
        <ul>
          <li @click="changeType('é¦–é¡µ')">é¦–é¡µ</li>  
          <li @click="changeType('åˆ†ç±»')">åˆ†ç±»</li>  
          <li @click="changeType('è´­ç‰©è½¦')">è´­ç‰©è½¦</li>  
          <li @click="changeType('æˆ‘çš„')">æˆ‘çš„</li>  
        </ul>
      </footer>
    `,
    methods: {
      changeType (type) {
       this.$emit('change', type)
      }
    }
  }

  Vue.createApp({
    components: {
      MyContent: Content,
      MyFooter: Footer
    },
    data () {
      return {
        type: 'é¦–é¡µ'
      }
    },
    methods: {
      getVal (type) {
        this.type = type
      }
    }
  }).mount('#app')
  
</script>
</html>
```



## äº”. ç”Ÿå‘½å‘¨æœŸ

### 5.1 vue2ç”Ÿå‘½å‘¨æœŸ

æ¯ä¸ª Vue å®ä¾‹åœ¨è¢«åˆ›å»ºä¹‹å‰éƒ½è¦ç»è¿‡ä¸€ç³»åˆ—çš„åˆå§‹åŒ–è¿‡ç¨‹ã€‚ä¾‹å¦‚éœ€è¦è®¾ç½®æ•°æ®ç›‘å¬ã€ç¼–è¯‘æ¨¡æ¿ã€æŒ‚è½½å®ä¾‹åˆ° DOMï¼Œåœ¨æ•°æ®å˜åŒ–æ—¶æ›´æ–° DOM ç­‰ã€‚åŒæ—¶åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ä¹Ÿä¼šè¿è¡Œä¸€äº›å«åš**ç”Ÿå‘½å‘¨æœŸé’©å­**çš„å‡½æ•°ï¼Œç›®çš„æ˜¯ç»™äºˆç”¨æˆ·åœ¨ä¸€äº›ç‰¹å®šçš„åœºæ™¯ä¸‹æ·»åŠ ä»–ä»¬è‡ªå·±ä»£ç çš„æœºä¼šã€‚

Vueç”Ÿå‘½å‘¨æœŸçš„**ä¸»è¦é˜¶æ®µ**ï¼šåˆå§‹åŒ–ä¸æŒ‚è½½é˜¶æ®µï¼Œæ›´æ–°é˜¶æ®µï¼Œé”€æ¯é˜¶æ®µ

- æŒ‚è½½ï¼ˆåˆå§‹åŒ–ç›¸å…³å±æ€§ï¼‰

  - beforeCreate 

    **æ³¨æ„ç‚¹**ï¼šåœ¨æ­¤æ—¶ä¸èƒ½è·å–dataä¸­çš„æ•°æ®

  - created --- å¯ä»¥è¿›è¡Œajaxæˆ–è€…å¼€å¯å®šæ—¶å™¨çš„ä»»åŠ¡

  - beforeMount 

  - mountedã€é¡µé¢åŠ è½½å®Œæ¯•çš„æ—¶å€™å°±æ˜¯æ­¤æ—¶ã€‘

- æ›´æ–°ï¼ˆæŒ‚è½½å®Œæ¯•åï¼Œæ•°æ®æ›´æ”¹çš„æ—¶å€™è§¦å‘ï¼‰

  - beforeUpdate

  - updated

    **æ³¨æ„ç‚¹**ï¼šå¯ä»¥é‡å¤è§¦å‘çš„

- é”€æ¯

  - beforeDestroy --- å¯ä»¥åšæ¸…é™¤å®šæ—¶å™¨çš„ä¸€äº›æ“ä½œ
  - destroyed 

> é”€æ¯ï¼ˆæ‰‹åŠ¨ï¼‰ä½¿ç”¨ this.$destroy()

å…³äº8ä¸ªç”Ÿå‘½å‘¨æœŸæ¶‰åŠåˆ°çš„æ–¹æ³•ï¼Œå¯ä»¥å‚è€ƒVueå®˜ç½‘APIï¼š

![](https://v2.cn.vuejs.org/images/lifecycle.png)





### 5.2 vue3ç”Ÿå‘½å‘¨æœŸ

é€‰é¡¹å¼APIä¸­å°† beforeDestroy ä»¥åŠ destroyed  ä¿®æ”¹ä¸º beforeUnmount å’Œ unmountedï¼Œå…¶ä½™ä¸€è‡´

![](https://cn.vuejs.org/assets/lifecycle.16e4c08e.png)



### 5.3 åŠ¨æ€ç»„ä»¶

#### 5.3.1 ç‰¹æ®Š Attributeâ€”is

ç”¨äºç»‘å®š[åŠ¨æ€ç»„ä»¶](https://cn.vuejs.org/guide/essentials/component-basics.html#dynamic-components)ã€‚

```
<!-- currentTab æ”¹å˜æ—¶ç»„ä»¶ä¹Ÿæ”¹å˜ --> 
<component :is="currentTab"></component>
```

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŠ¨æ€ç»„ä»¶</title>
</head>
<body>
  <div id="app">
    <ul>
      <li @click="currentTab='Home'">é¦–é¡µ</li>
      <li @click="currentTab='Kind'">åˆ†ç±»</li>
      <li @click="currentTab='Cart'">è´­ç‰©è½¦</li>
      <li @click="currentTab='User'">æˆ‘çš„</li>
    </ul>
    <!-- åŠ¨æ€ç»„ä»¶ -->
    <component :is="currentTab"></component>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const Home = {
    template: `<div>é¦–é¡µHome<input/></div>`
  }
  const Kind = {
    template: `<div>åˆ†ç±»Kind</div>`
  }
  const Cart = {
    template: `<div>è´­ç‰©è½¦Cart</div>`
  }
  const User = {
    template: `<div>æˆ‘çš„User</div>`
  }

  Vue.createApp({
    components: {
      Home,
      Kind,
      Cart,
      User
    },
    data () {
      return {
        currentTab: 'Home'
      }
    }
  }).mount('#app')
</script>
</html>
```

> å¦‚æœæ­¤æ—¶ç»™Homeç»„ä»¶åŠ å…¥ä¸€ä¸ªè¾“å…¥æ¡†ï¼Œè¾“å…¥å†…å®¹åˆ‡æ¢ç»„ä»¶æŸ¥çœ‹æ•ˆæœï¼Œå‘ç°åˆ‡æ¢å›æ¥æ•°æ®ä¸åœ¨



#### 5.3.2 `<KeepAlive>`ç»„ä»¶

ç¼“å­˜åŒ…è£¹åœ¨å…¶ä¸­çš„åŠ¨æ€åˆ‡æ¢ç»„ä»¶

`<KeepAlive>` åŒ…è£¹åŠ¨æ€ç»„ä»¶æ—¶ï¼Œä¼šç¼“å­˜ä¸æ´»è·ƒçš„ç»„ä»¶å®ä¾‹ï¼Œè€Œä¸æ˜¯é”€æ¯å®ƒä»¬ã€‚

ä»»ä½•æ—¶å€™éƒ½åªèƒ½æœ‰ä¸€ä¸ªæ´»è·ƒç»„ä»¶å®ä¾‹ä½œä¸º `<KeepAlive>` çš„ç›´æ¥å­èŠ‚ç‚¹ã€‚

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>keep-alive</title>
</head>
<body>
  <div id="app">
    <ul>
      <li @click="currentTab='Home'">é¦–é¡µ</li>
      <li @click="currentTab='Kind'">åˆ†ç±»</li>
      <li @click="currentTab='Cart'">è´­ç‰©è½¦</li>
      <li @click="currentTab='User'">æˆ‘çš„</li>
    </ul>

    <!-- åŠ¨æ€ç»„ä»¶ -->
    <!-- å®é™…ä¸Šiså±æ€§çš„å€¼ä¸ºç»„ä»¶çš„åå­— -->
    <!-- å¯ä»¥é€šè¿‡ keep-alive ä¿ç•™ç»„ä»¶çš„çŠ¶æ€ï¼Œé¿å…ç»„ä»¶çš„é”€æ¯å’Œé‡å»º -->
    <keep-alive>
      <component :is="currentTab"></component>
    </keep-alive>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const Home = {
    template: `<div>
        é¦–é¡µ <input />
      </div>`
  }
  const Kind = {
    template: `<div>
        åˆ†ç±» <input />
      </div>`
  }
  const Cart = {
    template: `<div>
        è´­ç‰©è½¦ <input />
      </div>`
  }
  const User = {
    template: `<div>
        æˆ‘çš„ <input />
      </div>`
  }

  Vue.createApp({
    components: {
      Home,
      Kind,
      Cart,
      User
    },
    data () {
      return {
        currentTab: 'Home'
      }
    }
  }).mount('#app')
</script>
</html>
```

> å½“ä¸€ä¸ªç»„ä»¶åœ¨ `<KeepAlive>` ä¸­è¢«åˆ‡æ¢æ—¶ï¼Œå®ƒçš„ `activated` å’Œ `deactivated` ç”Ÿå‘½å‘¨æœŸé’©å­å°†è¢«è°ƒç”¨ï¼Œç”¨æ¥æ›¿ä»£ `mounted` å’Œ `unmounted`ã€‚



#### 5.3.3 activatedã€deactivatedé’©å­

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>keep-aliveé’©å­å‡½æ•°</title>
</head>
<body>
  <div id="app">
    <ul>
      <li @click="currentTab='Home'">é¦–é¡µ</li>
      <li @click="currentTab='Kind'">åˆ†ç±»</li>
      <li @click="currentTab='Cart'">è´­ç‰©è½¦</li>
      <li @click="currentTab='User'">æˆ‘çš„</li>
    </ul>

    <!-- åŠ¨æ€ç»„ä»¶ -->
    <!-- å®é™…ä¸Šiså±æ€§çš„å€¼ä¸ºç»„ä»¶çš„åå­— -->
    <!-- å¯ä»¥é€šè¿‡ keep-alive ä¿ç•™ç»„ä»¶çš„çŠ¶æ€ï¼Œé¿å…ç»„ä»¶çš„é”€æ¯å’Œé‡å»º -->
    <keep-alive>
      <component :is="currentTab"></component>
    </keep-alive>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  // å‡è®¾é¦–é¡µéœ€è¦ä¿ç•™ç»„ä»¶çš„çŠ¶æ€ï¼Œè·³è½¬åˆ°æ–°çš„é¡µé¢å†å›åˆ°é¦–é¡µæ—¶ï¼Œè¦ç¡®ä¿æ•°æ®çš„è¯·æ±‚çš„åŠæ—¶æ€§æ—¶æ•ˆæ€§
  // ä»¥å‰ mounted ä¸­è¯·æ±‚äº†æ•°æ®ï¼Œä½¿ç”¨keepaliveæ—¶å†å›åˆ°é¦–é¡µ mounted å¹¶æ²¡æœ‰æ‰§è¡Œ
  // å¦‚æœè¦è·å–æœ€æ–°çš„æ•°æ®ï¼Œè¯·åœ¨activatedä¸­è·å–

  // å‡è®¾é¦–é¡µé•¿åˆ—è¡¨ï¼Œç‚¹å‡»æŸä¸€é¡¹å¯ä»¥è¿›å…¥è¯¦æƒ…ï¼Œè¿”å›é¦–é¡µä¹‹åï¼Œè¿˜å¸Œæœ›æ»šåŠ¨æ¡åœ¨åŸæ¥çš„ä½ç½®
  // ä»¥å‰åœ¨é”€æ¯ç»„ä»¶çš„unmountedä¸­è®°å½•æ»šåŠ¨æ¡ä½ç½®ï¼Œä½†æ˜¯åº”ç”¨äº†keep-aliveä¹‹åï¼Œéœ€è¦åœ¨deacvidatedä¸­è®°å½•æ»šåŠ¨æ¡ä½ç½®
  const Home = {
    template: `<div>
        é¦–é¡µ <input />
      </div>`,
      created () {
        console.log('é¦–é¡µ created')
      },
      unmounted () {
        console.log('é¦–é¡µ unmounted')
      },
      activated () {
        console.log('é¦–é¡µ activated')
      },
      deactivated () {
        console.log('é¦–é¡µ deactivated')
      }
  }
  const Kind = {
    template: `<div>
        åˆ†ç±» <input />
      </div>`,
      created () {
        console.log('åˆ†ç±» created')
      },
      unmounted () {
        console.log('åˆ†ç±» unmounted')
      },
      activated () {
        console.log('åˆ†ç±» activated')
      },
      deactivated () {
        console.log('åˆ†ç±» deactivated')
      }
  }
  const Cart = {
    template: `<div>
        è´­ç‰©è½¦ <input />
      </div>`,
  }
  const User = {
    template: `<div>
        æˆ‘çš„ <input />
      </div>`,
  }

  Vue.createApp({
    components: {
      Home,
      Kind,
      Cart,
      User
    },
    data () {
      return {
        currentTab: 'Home'
      }
    }
  }).mount('#app')
</script>
</html>
```

> é»˜è®¤åœ¨keep-aliveä¸­æ‰€æœ‰çš„ç»„ä»¶éƒ½è¿›è¡Œç¼“å­˜äº†
>
> ä½¿ç”¨ `include` / `exclude`å¯ä»¥è®¾ç½®å“ªäº›ç»„ä»¶è¢«ç¼“å­˜ï¼Œä½¿ç”¨ `max`å¯ä»¥è®¾å®šæœ€å¤šç¼“å­˜å¤šå°‘ä¸ª

```html
<!-- ç”¨é€—å·åˆ†éš”çš„å­—ç¬¦ä¸² -->
<KeepAlive include="a,b">
<component :is="view"></component>
</KeepAlive>

<!-- æ­£åˆ™è¡¨è¾¾å¼ (ä½¿ç”¨ `v-bind`) -->
<KeepAlive :include="/a|b/">
<component :is="view"></component>
</KeepAlive>

<!-- æ•°ç»„ (ä½¿ç”¨ `v-bind`) -->
<KeepAlive :include="['a', 'b']">
<component :is="view"></component>
</KeepAlive>
```

> ç»„ä»¶å¦‚æœæƒ³è¦æ¡ä»¶æ€§åœ°è¢« `KeepAlive` ç¼“å­˜ï¼Œå°±å¿…é¡»æ˜¾å¼å£°æ˜ä¸€ä¸ª `name` é€‰é¡¹ã€‚

> å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>é€‰æ‹©æ€§ç¼“å­˜</title>
</head>
<body>
<div id="app">
 <ul>
   <li @click="currentTab='Home'">é¦–é¡µ</li>
   <li @click="currentTab='Kind'">åˆ†ç±»</li>
   <li @click="currentTab='Cart'">è´­ç‰©è½¦</li>
   <li @click="currentTab='User'">æˆ‘çš„</li>
 </ul>

 <!-- ç”¨é€—å·åˆ†éš”çš„å­—ç¬¦ä¸² æ³¨æ„ä¸è¦åŠ ç©ºæ ¼ -->
 <!-- <keep-alive include="home,kind"> -->

 <!-- æ­£åˆ™è¡¨è¾¾å¼ (ä½¿ç”¨ `v-bind`) ä½¿ç”¨ç»‘å®šå±æ€§ -->
 <!-- <keep-alive :include="/home|kind/"> -->

 <!-- æ•°ç»„ (ä½¿ç”¨ `v-bind`) -->
 <keep-alive :include="['home']">
   <component :is="currentTab"></component>
 </keep-alive>
</div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
const Home = {
 name: 'home',
 template: `<div>
     é¦–é¡µ <input />
   </div>`,
   activated () {
     console.log('é¦–é¡µ activated')
   },
   deactivated () {
     console.log('é¦–é¡µ deactivated')
   }
}
const Kind = {
 name: 'kind',
 template: `<div>
     åˆ†ç±» <input />
   </div>`,
   activated () {
     console.log('åˆ†ç±» activated')
   },
   deactivated () {
     console.log('åˆ†ç±» deactivated')
   }
}
const Cart = {
 name: 'cart',
 template: `<div>
     è´­ç‰©è½¦ <input />
   </div>`,
}
const User = {
 name: 'user',
 template: `<div>
     æˆ‘çš„ <input />
   </div>`,
}

Vue.createApp({
 components: {
   Home,
   Kind,
   Cart,
   User
 },
 data () {
   return {
     currentTab: 'Home'
   }
 }
}).mount('#app')
</script>
</html>
```



#### 5.3.4`<component>`å…ƒç´ 

ä¸€ä¸ªç”¨äºæ¸²æŸ“åŠ¨æ€ç»„ä»¶æˆ–å…ƒç´ çš„â€œå…ƒç»„ä»¶â€

å®Œæ•´æ¡ˆä¾‹:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>componentæ ‡ç­¾</title>
</head>
<body>
  <div id="app">
    <input type="checkbox" v-model="flag" />
    <!-- æ¡ä»¶ä¸ºçœŸæ¸²æŸ“ä¸º a æ ‡ç­¾ï¼Œå¦åˆ™ä¸º span æ ‡ç­¾ -->
    <component :is="flag ? 'a' : 'span'">ä½ å¥½</component>

    <component :is="flag ? 'my-com1' : 'my-com2'"></component>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const Com1 = {
    template: `<div>com1</div>`
  }
  const Com2 = {
    template: `<div>com2</div>`
  }
  Vue.createApp({
    components: {
      MyCom1: Com1,
      MyCom2: Com2
    },
    data () {
      return {
        flag: false
      }
    }
  }).mount('#app')
</script>
</html>
```



#### 5.3.5 DOM æ¨¡æ¿è§£ææ³¨æ„äº‹é¡¹ï¼ˆis="vue:ç»„ä»¶å"ï¼‰

å½“ `is` attribute ç”¨äºåŸç”Ÿ HTML å…ƒç´ æ—¶ï¼Œå®ƒå°†è¢«å½“ä½œ [Customized built-in element](https://html.spec.whatwg.org/multipage/custom-elements.html#custom-elements-customized-builtin-example)ï¼Œå…¶ä¸ºåŸç”Ÿ web å¹³å°çš„ç‰¹æ€§ã€‚

ä½†æ˜¯ï¼Œåœ¨è¿™ç§ç”¨ä¾‹ä¸­ï¼Œä½ å¯èƒ½éœ€è¦ Vue ç”¨å…¶ç»„ä»¶æ¥æ›¿æ¢åŸç”Ÿå…ƒç´ ï¼Œä½ å¯ä»¥åœ¨ `is` attribute çš„å€¼ä¸­åŠ ä¸Š `vue:` å‰ç¼€ï¼Œè¿™æ · Vue å°±ä¼šæŠŠè¯¥å…ƒç´ æ¸²æŸ“ä¸º Vue ç»„ä»¶(`my-row-component`ä¸ºè‡ªå®šä¹‰ç»„ä»¶)ï¼š

```
<table>
  <tr is="vue:my-row-component"></tr>
</table>
```

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DOMæ¨¡æ¿è§£ææ³¨æ„äº‹é¡¹</title>
</head>
<body>
  <div id="app">
    <table>
      <tr>
        <td>åºå·</td>
        <td>å§“å</td>
        <td>å¯†ç </td>
      </tr>
      <!-- ç”¨ç»„ä»¶myTræ¥æ›¿æ¢åŸç”Ÿå…ƒç´ træ ‡ç­¾ -->
      <tr is="vue:my-tr" :list="list"></tr>
    </table>
  </div>
</body>
<template id="tr">
  <tr v-for="item of list" :key="item.id">
    <td>{{ item.id }}</td>
    <td>{{ item.name }}</td>
    <td>{{ item.password }}</td>
  </tr>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  Vue.createApp({
    components: {
      myTr: {
        template: '#tr',
        props: ['list'],
      }
    },
    data () {
      return {
        list: [
          {
            id: 1,
            name: 'å¼ ä¸‰',
            password: '123'
          },
          {
            id: 2,
            name: 'æå››',
            password: '234'
          },
          {
            id: 3,
            name: 'ç‹äº”',
            password: '345'
          }
        ]
      }
    }
  }).mount('#app')
</script>
</html>
```



## å…­. slotæ’æ§½

ç»„ä»¶çš„æœ€å¤§ç‰¹æ€§å°±æ˜¯ é‡ç”¨ ï¼Œè€Œç”¨å¥½æ’æ§½èƒ½å¤§å¤§æé«˜ç»„ä»¶çš„å¯é‡ç”¨èƒ½åŠ›ã€‚

**æ’æ§½çš„ä½œç”¨ï¼š**çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’å†…å®¹ã€‚

<img src="https://s1.ax1x.com/2020/05/25/tpb9ud.png" alt="slot" style="zoom: 67%;" />

é€šä¿—çš„æ¥è®²ï¼Œ**æ’æ§½æ— éå°±æ˜¯åœ¨** å­ç»„ä»¶ **ä¸­æŒ–ä¸ªå‘ï¼Œå‘é‡Œé¢æ”¾ä»€ä¹ˆä¸œè¥¿ç”±** çˆ¶ç»„ä»¶ **å†³å®šã€‚**

æ’æ§½ç±»å‹æœ‰ï¼š

- åŒ¿åæ’æ§½
- å…·åæ’æ§½
- ä½œç”¨åŸŸæ’æ§½

### 6.1 åŒ¿åæ’æ§½

åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨å­ç»„ä»¶çš„æ—¶å€™ï¼Œåœ¨å­ç»„ä»¶æ ‡ç­¾å†…éƒ¨å†™å…¥å†…å®¹ã€‚åœ¨å­ç»„ä»¶çš„æ¨¡æ¿ä¸­å¯ä»¥é€šè¿‡<slot></slot>æ¥ä½¿ç”¨

![](https://cn.vuejs.org/assets/slots.dbdaf1e8.png)

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŒ¿åæ’æ§½</title>
</head>
<body>
  <div id="app">
    <fancy-button>
      click me 
    </fancy-button>
    <fancy-button>
      ç™»å½• 
    </fancy-button>
    <fancy-button>
      æ³¨å†Œ
    </fancy-button>
  </div>
</body>
<template id="btn">
  <button>
    <slot></slot> 
  </button>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp } = Vue

  const Button = {
    template: '#btn'
  }

  const app = createApp({
    components: {
      FancyButton: Button
    }
  })

  app.mount('#app')
</script>
</html>
```



é™„ï¼šæ’æ§½çš„é»˜è®¤å†…å®¹

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ’æ§½çš„é»˜è®¤å†…å®¹</title>
</head>
<body>
  <div id="app">
    <fancy-button>
      click me 
    </fancy-button>
    <fancy-button></fancy-button>
  </div>
</body>
<template id="btn">
  <button>
    <slot>æ³¨å†Œ</slot> 
  </button>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp } = Vue

  const Button = {
    template: '#btn'
  }

  const app = createApp({
    components: {
      FancyButton: Button
    }
  })

  app.mount('#app')
</script>
</html>
```



### 6.2 å…·åæ’æ§½(v-slot,ç®€å†™#)

æœ‰æ—¶åœ¨ä¸€ä¸ªç»„ä»¶ä¸­åŒ…å«å¤šä¸ªæ’æ§½å‡ºå£æ˜¯å¾ˆæœ‰ç”¨çš„ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œåœ¨ä¸€ä¸ª `<BaseLayout>` ç»„ä»¶ä¸­ï¼Œæœ‰å¦‚ä¸‹æ¨¡æ¿ï¼š

```html
<div class="container">
  <header>
    <!-- æ ‡é¢˜å†…å®¹æ”¾è¿™é‡Œ -->
  </header>
  <main>
    <!-- ä¸»è¦å†…å®¹æ”¾è¿™é‡Œ -->
  </main>
  <footer>
    <!-- åº•éƒ¨å†…å®¹æ”¾è¿™é‡Œ -->
  </footer>
</div>
```

å¯¹äºè¿™ç§åœºæ™¯ï¼Œ`<slot>` å…ƒç´ å¯ä»¥æœ‰ä¸€ä¸ªç‰¹æ®Šçš„ attribute `name`ï¼Œç”¨æ¥ç»™å„ä¸ªæ’æ§½åˆ†é…å”¯ä¸€çš„ IDï¼Œä»¥ç¡®å®šæ¯ä¸€å¤„è¦æ¸²æŸ“çš„å†…å®¹ï¼š

```html
<div class="container">
  <header>
    <slot name="header"></slot>
  </header>
  <main>
    <slot></slot>
  </main>
  <footer>
    <slot name="footer"></slot>
  </footer>
</div>
```

è¿™ç±»å¸¦ `name` çš„æ’æ§½è¢«ç§°ä¸ºå…·åæ’æ§½ (named slots)ã€‚æ²¡æœ‰æä¾› `name` çš„ `<slot>` å‡ºå£ä¼šéšå¼åœ°å‘½åä¸ºâ€œdefaultâ€ã€‚

åœ¨çˆ¶ç»„ä»¶ä¸­ä½¿ç”¨ `<BaseLayout>` æ—¶ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹å¼å°†å¤šä¸ªæ’æ§½å†…å®¹ä¼ å…¥åˆ°å„è‡ªç›®æ ‡æ’æ§½çš„å‡ºå£ã€‚æ­¤æ—¶å°±éœ€è¦ç”¨åˆ°**å…·åæ’æ§½**äº†ï¼š

è¦ä¸ºå…·åæ’æ§½ä¼ å…¥å†…å®¹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªå« `v-slot` æŒ‡ä»¤çš„ `<template>` å…ƒç´ ï¼Œå¹¶å°†ç›®æ ‡æ’æ§½çš„åå­—ä¼ ç»™è¯¥æŒ‡ä»¤ï¼š

```html
<BaseLayout>
  <template v-slot:header>
    <!-- header æ’æ§½çš„å†…å®¹æ”¾è¿™é‡Œ -->
  </template>
</BaseLayout>
```

> `v-slot` æœ‰å¯¹åº”çš„ç®€å†™ `#`ï¼Œå› æ­¤ `<template v-slot:header>` å¯ä»¥ç®€å†™ä¸º `<template #header>`ã€‚å…¶æ„æ€å°±æ˜¯â€œå°†è¿™éƒ¨åˆ†æ¨¡æ¿ç‰‡æ®µä¼ å…¥å­ç»„ä»¶çš„ header æ’æ§½ä¸­â€ã€‚



![](https://cn.vuejs.org/assets/named-slots.ebb7b207.png)

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å…·åæ’æ§½</title>
</head>
<body>
  <div id="app">
    <base-layout>
      <template v-slot:header>é¦–é¡µå¤´éƒ¨</template>
      <template v-slot:default>é¦–é¡µå†…å®¹</template>
      <template v-slot:footer>é¦–é¡µåº•éƒ¨</template>
    </base-layout>
    <hr />
    <base-layout>
      <template v-slot:default>åˆ†ç±»å†…å®¹</template>
    </base-layout>
    <hr />
    <base-layout>
      <template #header>æˆ‘çš„å¤´éƒ¨</template>
      <template #default>æˆ‘çš„å†…å®¹</template>
      <template #footer>æˆ‘çš„åº•éƒ¨</template>
    </base-layout>
  </div>
</body>
<template id="layout">
  <div class="container">
    <header class="header">
      <slot name="header">header</slot>
    </header>
    <div class="content">
      <!-- ä¸å†™nameæ—¶ï¼Œç›¸å½“äº å†™äº†name="default" -->
      <slot>content!</slot>
    </div>
    <footer class="footer">
      <slot name="footer">footer</slot>
    </footer>
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp } = Vue

  const Layout = {
    template: '#layout'
  }

  const app = createApp({
    components: {
      BaseLayout: Layout
    }
  })

  app.mount('#app')
</script>
</html>
```



#### åŠ¨æ€æ’æ§½å

[åŠ¨æ€æŒ‡ä»¤å‚æ•°](https://cn.vuejs.org/guide/essentials/template-syntax.html#dynamic-arguments)åœ¨ `v-slot` ä¸Šä¹Ÿæ˜¯æœ‰æ•ˆçš„ï¼Œå³å¯ä»¥å®šä¹‰ä¸‹é¢è¿™æ ·çš„åŠ¨æ€æ’æ§½åï¼š

```
<base-layout>
  <template v-slot:[dynamicSlotName]>
    ...
  </template>

  <!-- ç¼©å†™ä¸º -->
  <template #[dynamicSlotName]>
    ...
  </template>
</base-layout>
```

æ³¨æ„è¿™é‡Œçš„è¡¨è¾¾å¼å’ŒåŠ¨æ€æŒ‡ä»¤å‚æ•°å—ç›¸åŒçš„[è¯­æ³•é™åˆ¶](https://cn.vuejs.org/guide/essentials/template-syntax.html#directives)ã€‚

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>åŠ¨æ€æ’æ§½å</title>
</head>
<body>
  <div id="app">
    <button @click="count++">{{ count }}</button>
    <my-com>
      <template v-slot:[type]>
        {{ type }}
      </template>
    </my-com>
  </div>
</body>
<template id="com">
  <div >
    <slot name="dynFirst"> 1 åŠ¨æ€æ’æ§½å</slot>
    <br />
    <slot name="dynLast"> 2 åŠ¨æ€æ’æ§½å</slot>
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp } = Vue
  const Com = {
    template: '#com'
  }
  const app = createApp({
    components: {
      MyCom: Com
    },
    data () {
      return {
        count: 0
      }
    },
    computed: {
      type () {
        return this.count % 2 === 0 ? 'dynLast': 'dynFirst'
      }
    }
  })

  app.mount('#app')
</script>
</html>
```



### 6.3 ä½œç”¨åŸŸæ’æ§½

åœ¨æŸäº›åœºæ™¯ä¸‹æ’æ§½çš„å†…å®¹å¯èƒ½æƒ³è¦åŒæ—¶ä½¿ç”¨çˆ¶ç»„ä»¶åŸŸå†…å’Œå­ç»„ä»¶åŸŸå†…çš„æ•°æ®ã€‚è¦åšåˆ°è¿™ä¸€ç‚¹ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ç§æ–¹æ³•æ¥è®©å­ç»„ä»¶åœ¨æ¸²æŸ“æ—¶å°†ä¸€éƒ¨åˆ†æ•°æ®æä¾›ç»™æ’æ§½ã€‚

![](https://cn.vuejs.org/assets/scoped-slots.1c6d5876.svg)

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä½œç”¨åŸŸæ’æ§½</title>
</head>
<body>
  <div id="app">
    <my-com>
      <template v-slot:test="testProps">ä½œç”¨åŸŸæ’æ§½ä»¥åŠå…·åæ’æ§½-{{testProps.message}}- {{ testProps.count }}</template>
    </my-com>
    <my-com1>
      <template #default="{ message, count }">ä½œç”¨åŸŸæ’æ§½-{{message}}- {{ count }}</template>
    </my-com1>
  </div>
</body>
<template id="com">
  <div>
    <!-- ä¸€æ—¦ä½¿ç”¨äº†å…·åæ’æ§½ï¼Œåœ¨ä½¿ç”¨ä½œç”¨åŸŸæ’æ§½æ—¶ v-slot:å…·å="å±æ€§å" -->
    <slot name="test" :message="message" :count="1"></slot>
  </div>
</template>
<template id="com1">
  <div>
     <!-- æ²¡æœ‰ä½¿ç”¨å…·åæ’æ§½ï¼Œåœ¨ä½¿ç”¨ä½œç”¨åŸŸæ’æ§½æ—¶ v-slot="å±æ€§å" -->
    <slot :message="message" :count="1"></slot>
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp } = Vue

  const Com = {
    template: '#com',
    data () {
      return {
        message: 'hello msg'
      }
    }
  }
  const Com1 = {
    template: '#com1',
    data () {
      return {
        message: 'hello msg1'
      }
    }
  }
  const app = createApp({
    components: {
      MyCom: Com,
      MyCom1: Com1
    }
  })
  app.mount('#app')
</script>
</html>
```



## ä¸ƒ. ä¾èµ–æ³¨å…¥

é€šå¸¸æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬éœ€è¦ä»çˆ¶ç»„ä»¶å‘å­ç»„ä»¶ä¼ é€’æ•°æ®æ—¶ï¼Œä¼šä½¿ç”¨ [props](https://cn.vuejs.org/guide/components/props.html)ã€‚æƒ³è±¡ä¸€ä¸‹è¿™æ ·çš„ç»“æ„ï¼šæœ‰ä¸€äº›å¤šå±‚çº§åµŒå¥—çš„ç»„ä»¶ï¼Œå½¢æˆäº†ä¸€é¢—å·¨å¤§çš„ç»„ä»¶æ ‘ï¼Œè€ŒæŸä¸ªæ·±å±‚çš„å­ç»„ä»¶éœ€è¦ä¸€ä¸ªè¾ƒè¿œçš„ç¥–å…ˆç»„ä»¶ä¸­çš„éƒ¨åˆ†æ•°æ®ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œå¦‚æœä»…ä½¿ç”¨ props åˆ™å¿…é¡»å°†å…¶æ²¿ç€ç»„ä»¶é“¾é€çº§ä¼ é€’ä¸‹å»ï¼Œè¿™ä¼šéå¸¸éº»çƒ¦ï¼š

![](https://cn.vuejs.org/assets/prop-drilling.11201220.png)



æ³¨æ„ï¼Œè™½ç„¶è¿™é‡Œçš„ `<Footer>` ç»„ä»¶å¯èƒ½æ ¹æœ¬ä¸å…³å¿ƒè¿™äº› propsï¼Œä½†ä¸ºäº†ä½¿ `<DeepChild>` èƒ½è®¿é—®åˆ°å®ƒä»¬ï¼Œä»ç„¶éœ€è¦å®šä¹‰å¹¶å‘ä¸‹ä¼ é€’ã€‚å¦‚æœç»„ä»¶é“¾è·¯éå¸¸é•¿ï¼Œå¯èƒ½ä¼šå½±å“åˆ°æ›´å¤šè¿™æ¡è·¯ä¸Šçš„ç»„ä»¶ã€‚è¿™ä¸€é—®é¢˜è¢«ç§°ä¸ºâ€œprop é€çº§é€ä¼ â€ï¼Œæ˜¾ç„¶æ˜¯æˆ‘ä»¬å¸Œæœ›å°½é‡é¿å…çš„æƒ…å†µã€‚

`provide` å’Œ `inject` å¯ä»¥å¸®åŠ©æˆ‘ä»¬è§£å†³è¿™ä¸€é—®é¢˜ã€‚ [[1\]](https://cn.vuejs.org/guide/components/provide-inject.html#footnote-1) ä¸€ä¸ªçˆ¶ç»„ä»¶ç›¸å¯¹äºå…¶æ‰€æœ‰çš„åä»£ç»„ä»¶ï¼Œä¼šä½œä¸º**ä¾èµ–æä¾›è€…**ã€‚ä»»ä½•åä»£çš„ç»„ä»¶æ ‘ï¼Œæ— è®ºå±‚çº§æœ‰å¤šæ·±ï¼Œéƒ½å¯ä»¥**æ³¨å…¥**ç”±çˆ¶ç»„ä»¶æä¾›ç»™æ•´æ¡é“¾è·¯çš„ä¾èµ–ã€‚



![](https://cn.vuejs.org/assets/provide-inject.3e0505e4.png)



### 7.1 provide

è¦ä¸ºç»„ä»¶åä»£æä¾›æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨åˆ° [`provide`](https://cn.vuejs.org/api/options-composition.html#provide) é€‰é¡¹ï¼š

```
{
  provide: {
    message: 'hello!'
  }
}
```

å¯¹äº `provide` å¯¹è±¡ä¸Šçš„æ¯ä¸€ä¸ªå±æ€§ï¼Œåä»£ç»„ä»¶ä¼šç”¨å…¶ key ä¸ºæ³¨å…¥åæŸ¥æ‰¾æœŸæœ›æ³¨å…¥çš„å€¼ï¼Œå±æ€§çš„å€¼å°±æ˜¯è¦æä¾›çš„æ•°æ®ã€‚

å¦‚æœæˆ‘ä»¬éœ€è¦æä¾›ä¾èµ–å½“å‰ç»„ä»¶å®ä¾‹çš„çŠ¶æ€ (æ¯”å¦‚é‚£äº›ç”± `data()` å®šä¹‰çš„æ•°æ®å±æ€§)ï¼Œé‚£ä¹ˆå¯ä»¥ä»¥å‡½æ•°å½¢å¼ä½¿ç”¨ `provide`ï¼š

```
{
  data() {
    return {
      message: 'hello!'
    }
  },
  provide() {
    // ä½¿ç”¨å‡½æ•°çš„å½¢å¼ï¼Œå¯ä»¥è®¿é—®åˆ° `this`
    return {
      message: this.message
    }
  }
}
```

è¿™**ä¸ä¼š**ä½¿æ³¨å…¥ä¿æŒå“åº”æ€§ï¼ˆæ¯”å¦‚ç¥–å…ˆç»„ä»¶ä¸­æœ‰ä¸€ä¸ªcountçš„çŠ¶æ€ï¼Œç¥–å…ˆç»„ä»¶ä¿®æ”¹å®ŒçŠ¶æ€ï¼Œåä»£ç»„ä»¶é»˜è®¤çš„å€¼æ²¡æœ‰å“åº”å¼çš„æ”¹å˜ï¼‰



### 7.2 inject

è¦æ³¨å…¥ä¸Šå±‚ç»„ä»¶æä¾›çš„æ•°æ®ï¼Œéœ€ä½¿ç”¨ [`inject`](https://cn.vuejs.org/api/options-composition.html#inject) é€‰é¡¹æ¥å£°æ˜ï¼š

```
{
  inject: ['message'],
  created() {
    console.log(this.message) // injected value
  }
}
```

æ³¨å…¥ä¼šåœ¨ç»„ä»¶è‡ªèº«çš„çŠ¶æ€**ä¹‹å‰**è¢«è§£æï¼Œå› æ­¤ä½ å¯ä»¥åœ¨ `data()` ä¸­è®¿é—®åˆ°æ³¨å…¥çš„å±æ€§ï¼š

```
{
  inject: ['message'],
  data() {
    return {
      // åŸºäºæ³¨å…¥å€¼çš„åˆå§‹æ•°æ®
      fullMessage: this.message
    }
  }
}
```

> å½“ä»¥æ•°ç»„å½¢å¼ä½¿ç”¨ `inject`ï¼Œæ³¨å…¥çš„å±æ€§ä¼šä»¥åŒåçš„ key æš´éœ²åˆ°ç»„ä»¶å®ä¾‹ä¸Šã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæä¾›çš„å±æ€§åä¸º `"message"`ï¼Œæ³¨å…¥åä»¥ `this.message` çš„å½¢å¼æš´éœ²ã€‚è®¿é—®çš„æœ¬åœ°å±æ€§åå’Œæ³¨å…¥åæ˜¯ç›¸åŒçš„ã€‚
>
> å¦‚æœæˆ‘ä»¬æƒ³è¦ç”¨ä¸€ä¸ªä¸åŒçš„æœ¬åœ°å±æ€§åæ³¨å…¥è¯¥å±æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ `inject` é€‰é¡¹çš„å±æ€§ä¸Šä½¿ç”¨å¯¹è±¡çš„å½¢å¼ï¼š

```
{
    inject: {
         /* æœ¬åœ°å±æ€§å */ localMessage: {
           from: /* æ³¨å…¥æ¥æºå */ 'message'
         }
    }
}
```



> è¿™é‡Œï¼Œç»„ä»¶æœ¬åœ°åŒ–äº†åŸæ³¨å…¥å `"message"` æ‰€æä¾›çš„çš„å±æ€§ï¼Œå¹¶å°†å…¶æš´éœ²ä¸º `this.localMessage`ã€‚
>
> é»˜è®¤æƒ…å†µä¸‹ï¼Œ`inject` å‡è®¾ä¼ å…¥çš„æ³¨å…¥åä¼šè¢«æŸä¸ªç¥–å…ˆé“¾ä¸Šçš„ç»„ä»¶æä¾›ã€‚å¦‚æœè¯¥æ³¨å…¥åçš„ç¡®æ²¡æœ‰ä»»ä½•ç»„ä»¶æä¾›ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶è­¦å‘Šã€‚
>
> å¦‚æœåœ¨æ³¨å…¥ä¸€ä¸ªå€¼æ—¶ä¸è¦æ±‚å¿…é¡»æœ‰æä¾›è€…ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å£°æ˜ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå’Œ props ç±»ä¼¼ï¼š

```
{
    // å½“å£°æ˜æ³¨å…¥çš„é»˜è®¤å€¼æ—¶,å¿…é¡»ä½¿ç”¨å¯¹è±¡å½¢å¼
    inject: {
     message: {
       from: 'message', // å½“ä¸åŸæ³¨å…¥ååŒåæ—¶ï¼Œè¿™ä¸ªå±æ€§æ˜¯å¯é€‰çš„
       default: 'default value'
     },
     user: {
       // å¯¹äºéåŸºç¡€ç±»å‹æ•°æ®ï¼Œå¦‚æœåˆ›å»ºå¼€é”€æ¯”è¾ƒå¤§ï¼Œæˆ–æ˜¯éœ€è¦ç¡®ä¿æ¯ä¸ªç»„ä»¶å®ä¾‹
       // éœ€è¦ç‹¬ç«‹æ•°æ®çš„ï¼Œè¯·ä½¿ç”¨å·¥å‚å‡½æ•°
       default: () => ({ name: 'John' })
     }
    }
}
```

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¾èµ–æ³¨å…¥</title>
</head>
<body>
  <div id="app">
    <button @click="count++">åŠ 1</button> {{ count }}
    <my-parent></my-parent>
  </div>
</body>
<template id="parent">
  <div>
    æˆ‘æ˜¯çˆ¶ç»„ä»¶ - {{ message }}
    <my-child></my-child>
  </div>
</template>
<template id="child">
  <div>
    æˆ‘æ˜¯å­ç»„ä»¶ - {{ myMessage }} - {{ count }}
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const Child = {
    template: '#child',
    inject: {
      myMessage: { // æ›¿æ¢æœ¬åœ°åå­—ï¼Œ
        from: 'message'
      },
      count: {
        default: 100,
      }
    }
  }
  const Parent = {
    template: '#parent',
    inject: ['message'],
    components: {
      MyChild: Child
    }
  }

  const { createApp } = Vue

  const app = createApp({
    components: {
      MyParent: Parent
    },
    data () {
      return {
        message: 'ä¼ å®¶å®',
        count: 1
      }
    },
    provide () {
      return {
        message: this.message,
        count: this.count
      }
    }
  })

  app.mount('#app')

</script>
</html>
```

> å‘ç°ä»¥ä¸Šæ¡ˆä¾‹åœ¨countå€¼å‘ç”Ÿæ”¹å˜æ—¶æ²¡æœ‰æ›´æ–°åä»£æ•°æ®



### 7.3 é…åˆå“åº”æ€§ computed()

ä¸ºä¿è¯æ³¨å…¥æ–¹å’Œä¾›ç»™æ–¹ä¹‹é—´çš„å“åº”æ€§é“¾æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ [computed()](https://cn.vuejs.org/api/reactivity-core.html#computed) å‡½æ•°æä¾›ä¸€ä¸ªè®¡ç®—å±æ€§

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä¾èµ–æ³¨å…¥é…åˆå“åº”å¼</title>
</head>
<body>
  <div id="app">
    <button @click="count++">åŠ 1</button> {{ count }}
    <my-parent></my-parent>
  </div>
</body>
<template id="parent">
  <div>
    æˆ‘æ˜¯çˆ¶ç»„ä»¶ - {{ message }}
    <my-child></my-child>
  </div>
</template>
<template id="child">
  <div>
    æˆ‘æ˜¯å­ç»„ä»¶ - {{ myMessage }} - {{ count }}
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  
  const Child = {
    template: '#child',
    inject: {
      myMessage: { // æ›¿æ¢æœ¬åœ°åå­—ï¼Œ
        from: 'message'
      },
      count: {
        default: 100
      }
    }
  }
  const Parent = {
    template: '#parent',
    inject: ['message'],
    components: {
      MyChild: Child
    }
  }

  const { createApp, computed } = Vue

  const app = createApp({
    components: {
      MyParent: Parent
    },
    data () {
      return {
        message: 'ä¼ å®¶å®',
        count: 1
      }
    },
    provide () {
      return {
        message: this.message,
        // count: this.count
        count: computed(() => this.count) // å“åº”å¼å…³é”®
      }
    }
  })

  // app.config.unwrapInjectedRef = true
  app.mount('#app')
</script>
</html>
```



vue2ä¸­ä¹Ÿæ˜¯è¿™æ ·å¤„ç†æ•°æ®ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>vue2-ä¾èµ–æ³¨å…¥é…åˆå“åº”å¼</title>
</head>
<body>
<div id="app">
 <button @click="count++">åŠ 1</button> {{ count }}
 <my-parent></my-parent>
</div>
</body>
<template id="parent">
<div>
 æˆ‘æ˜¯çˆ¶ç»„ä»¶ - {{ message }}
 <my-child></my-child>
</div>
</template>
<template id="child">
<div>
 æˆ‘æ˜¯å­ç»„ä»¶ - {{ myMessage }} - {{ count }}
</div>
</template>
 <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
const Child = {
 template: '#child',
 inject: {
   myMessage: { // æ›¿æ¢æœ¬åœ°åå­—ï¼Œ
    from: 'message'
   },
   count: {
    default: 100
   }
 }
}
const Parent = {
 template: '#parent',
 inject: ['message'],
 components: {
   MyChild: Child
 }
}
// console.log(Vue.computed)
const { computed } = Vue

new Vue({
 components: {
   MyParent: Parent
 },
 data: {
   message: 'ä¼ å®¶å®',
   count: 1
 },
 provide () {
   return {
     message: this.message,
     // count: this.count
     count: computed(() => this.count) // å“åº”å¼å…³é”®
   }
 }
}).$mount('#app')

</script>
</html>
```



## å…«. å¼‚æ­¥ç»„ä»¶

åœ¨å¤§å‹é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦æ‹†åˆ†åº”ç”¨ä¸ºæ›´å°çš„å—ï¼Œå¹¶ä»…åœ¨éœ€è¦æ—¶å†ä»æœåŠ¡å™¨åŠ è½½ç›¸å…³ç»„ä»¶ã€‚Vue æä¾›äº† [`defineAsyncComponent`](https://cn.vuejs.org/api/general.html#defineasynccomponent) æ–¹æ³•æ¥å®ç°æ­¤åŠŸèƒ½

### 8.1  å®šä¹‰å¼‚æ­¥ç»„ä»¶

```
import { defineAsyncComponent } from 'vue'

const AsyncComp = defineAsyncComponent(() => {
  return new Promise((resolve, reject) => {
    // ...ä»æœåŠ¡å™¨è·å–ç»„ä»¶
    resolve(/* è·å–åˆ°çš„ç»„ä»¶ */)
  })
})
// ... åƒä½¿ç”¨å…¶ä»–ä¸€èˆ¬ç»„ä»¶ä¸€æ ·ä½¿ç”¨ `AsyncComp`
```

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>å®šä¹‰å¼‚æ­¥ç»„ä»¶</title>
</head>
<body>
  <div id="app">
    <my-test></my-test>
    <hr/>
    <my-com></my-com>
  </div>
</body>
<template id="com">
  <div>å¼‚æ­¥åŠ è½½ç»„ä»¶</div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, defineAsyncComponent } = Vue
  const Com = {
    template: '#com'
  }
  // å®šä¹‰å¼‚æ­¥ç»„ä»¶ã€‚è§„å®šäº†3sä»¥åæ‰ä¼šæ¸²æŸ“
  const myCom = defineAsyncComponent(() => {
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        resolve(Com)
      }, 3000)
    })
  })

  createApp({
    components: {
      myTest: Com, 
      myCom,  // æ³¨å†Œå¼‚æ­¥ç»„ä»¶
    }
  }).mount('#app')
</script>
</html>
```



### 8.2åŠ è½½å‡½æ•°

[ES æ¨¡å—åŠ¨æ€å¯¼å…¥](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/import#dynamic_imports)ä¹Ÿä¼šè¿”å›ä¸€ä¸ª Promiseï¼Œæ‰€ä»¥å¤šæ•°æƒ…å†µä¸‹æˆ‘ä»¬ä¼šå°†å®ƒå’Œ `defineAsyncComponent` æ­é…ä½¿ç”¨ã€‚ç±»ä¼¼ Vite å’Œ Webpack è¿™æ ·çš„æ„å»ºå·¥å…·ä¹Ÿæ”¯æŒæ­¤è¯­æ³•ï¼Œå› æ­¤æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥å¯¼å…¥ Vue å•æ–‡ä»¶ç»„ä»¶

```
import { defineAsyncComponent } from 'vue'

const AsyncComp = defineAsyncComponent(() =>
  import('./components/MyComponent.vue')
)
```

ä»¥åè®²è§£é¡¹ç›®æ—¶å¯ä»¥ç”¨åˆ°ï¼Œéœ€è¦åœ¨è„šæ‰‹æ¶ç¯å¢ƒä¸­ä½¿ç”¨ï¼ˆ`å•æ–‡ä»¶ç»„ä»¶ä¸­ä½¿ç”¨`ï¼‰



### 8.3 `<Suspense>`ç»„ä»¶

`<Suspense>` æ˜¯ä¸€ä¸ªå†…ç½®ç»„ä»¶ï¼Œç”¨æ¥åœ¨ç»„ä»¶æ ‘ä¸­åè°ƒå¯¹å¼‚æ­¥ä¾èµ–çš„å¤„ç†ï¼Œå¹¶å¯ä»¥åœ¨ç­‰å¾…æ—¶æ¸²æŸ“ä¸€ä¸ªåŠ è½½çŠ¶æ€ã€‚

> vue3ä¸­æ–°å¢çš„

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Suspense</title>
</head>
<body>
  <div id="app">
    <my-test></my-test>
    <hr/>
    <!-- Suspenseå†…éƒ¨éœ€è¦ä¸€ä¸ªæ ¹ç»„ä»¶ -->
    <Suspense>
      <!-- å¼‚æ­¥åŠ è½½ç»„ä»¶ -->
      <my-com></my-com>

      <!-- åŠ è½½çŠ¶æ€ -->
      <template #fallback>
        åŠ è½½ä¸­...
      </template>
    </Suspense>
  </div>
</body>
<template id="com">
  <div>å¼‚æ­¥åŠ è½½ç»„ä»¶</div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, defineAsyncComponent } = Vue
  const Com = {
    template: '#com'
  }
  const MyCom = defineAsyncComponent(() => {
    return new Promise((resolve, reject) => {
      setTimeout(() => {
        resolve(Com)
      }, 3000)
    })
  })

  createApp({
    components: {
      MyCom,
      MyTest: Com
    }
  }).mount('#app')
</script>
</html>
```

> åæœŸå¯ä»¥å’Œ `Transition`,`KeepAlive`,`è·¯ç”±`ç­‰ç»“åˆä½¿ç”¨



## ä¹. è‡ªå®šä¹‰æŒ‡ä»¤

é™¤äº† Vue å†…ç½®çš„ä¸€ç³»åˆ—æŒ‡ä»¤ (æ¯”å¦‚ `v-model` æˆ– `v-show`) ä¹‹å¤–ï¼ŒVue è¿˜å…è®¸ä½ æ³¨å†Œè‡ªå®šä¹‰çš„æŒ‡ä»¤ (Custom Directives)ã€‚

ä¸€ä¸ªè‡ªå®šä¹‰æŒ‡ä»¤ç”±ä¸€ä¸ªåŒ…å«ç±»ä¼¼ç»„ä»¶ç”Ÿå‘½å‘¨æœŸé’©å­çš„å¯¹è±¡æ¥å®šä¹‰ã€‚é’©å­å‡½æ•°ä¼šæ¥æ”¶åˆ°æŒ‡ä»¤æ‰€ç»‘å®šå…ƒç´ ä½œä¸ºå…¶å‚æ•°ã€‚

### 9.1 è‡ªå®šä¹‰æŒ‡ä»¤å®šä¹‰å’Œä½¿ç”¨

å½“ä¸€ä¸ª input å…ƒç´ è¢« Vue æ’å…¥åˆ° DOM ä¸­åï¼Œå®ƒä¼šè¢«è‡ªåŠ¨èšç„¦ï¼š

```
  // vue3çš„å…¨å±€è‡ªå®šä¹‰æŒ‡ä»¤ `v-focus`
  app.directive('focus', { 
     mounted (el) { // el å°±æ˜¯å½“å‰æŒ‡ä»¤å¯¹åº”çš„DOMèŠ‚ç‚¹
       el.focus()
     }
   })
   
  // vue2çš„å…¨å±€è‡ªå®šä¹‰æŒ‡ä»¤ `v-focus`
   Vue.directive('focus', {
      // å½“è¢«ç»‘å®šçš„å…ƒç´ æ’å…¥åˆ° DOM ä¸­æ—¶â€¦â€¦
      inserted: function (el) {
        // èšç„¦å…ƒç´ 
        el.focus()
      }
   })
```



å¦‚æœæƒ³æ³¨å†Œå±€éƒ¨æŒ‡ä»¤ï¼Œç»„ä»¶ä¸­ä¹Ÿæ¥å—ä¸€ä¸ª `directives` çš„é€‰é¡¹ï¼š

```
// vue3çš„å±€éƒ¨è‡ªå®šä¹‰æŒ‡ä»¤ `v-focus`
directives: {
  focus: {
    // æŒ‡ä»¤çš„å®šä¹‰
    mounted: function (el) {
      el.focus()
    }
  }
}

// vue2çš„å±€éƒ¨è‡ªå®šä¹‰æŒ‡ä»¤ `v-focus`
directives: {
  focus: {
    // æŒ‡ä»¤çš„å®šä¹‰
    inserted: function (el) {
      el.focus()
    }
  }
}
```

ç„¶åä½ å¯ä»¥åœ¨æ¨¡æ¿ä¸­ä»»ä½•å…ƒç´ ä¸Šä½¿ç”¨æ–°çš„ `v-focus` å±æ€§ï¼Œå¦‚ä¸‹ï¼š

```
<input v-focus>
```



å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è‡ªå®šä¹‰æŒ‡ä»¤</title>
</head>
<body>
  <div id="app">
    <input type="text" v-focus/>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const app = Vue.createApp({
    directives: {
      focus: {
        mounted (el) {
          el.focus()
        }
      }
    }
  })

  // å…¨å±€è‡ªå®šä¹‰æŒ‡ä»¤
  // app.directive('focus', { 
  //   mounted (el) { // el å°±æ˜¯å½“å‰æŒ‡ä»¤å¯¹åº”çš„DOMèŠ‚ç‚¹
  //     el.focus()
  //   }
  // })

  app.mount('#app')
</script>
</html>
```



### 9.2è‡ªå®šä¹‰æŒ‡ä»¤é’©å­

ä¸€ä¸ªæŒ‡ä»¤çš„å®šä¹‰å¯¹è±¡å¯ä»¥æä¾›å‡ ç§é’©å­å‡½æ•° (éƒ½æ˜¯å¯é€‰çš„)ï¼š

> vue3ç›¸æ¯” vue2ï¼Œé’©å­å‡½æ•°åšäº†æ›´æ–°
>
> vue2ä¸­ä¸€ä¸ªæŒ‡ä»¤å®šä¹‰å¯¹è±¡å¯ä»¥æä¾›å¦‚ä¸‹å‡ ä¸ªé’©å­å‡½æ•° (å‡ä¸ºå¯é€‰)ï¼š
>
> - `bind`ï¼šåªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ã€‚åœ¨è¿™é‡Œå¯ä»¥è¿›è¡Œä¸€æ¬¡æ€§çš„åˆå§‹åŒ–è®¾ç½®ã€‚
> - `inserted`ï¼šè¢«ç»‘å®šå…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ (ä»…ä¿è¯çˆ¶èŠ‚ç‚¹å­˜åœ¨ï¼Œä½†ä¸ä¸€å®šå·²è¢«æ’å…¥æ–‡æ¡£ä¸­)ã€‚
> - `update`ï¼šæ‰€åœ¨ç»„ä»¶çš„ VNode æ›´æ–°æ—¶è°ƒç”¨ï¼Œ**ä½†æ˜¯å¯èƒ½å‘ç”Ÿåœ¨å…¶å­ VNode æ›´æ–°ä¹‹å‰**ã€‚æŒ‡ä»¤çš„å€¼å¯èƒ½å‘ç”Ÿäº†æ”¹å˜ï¼Œä¹Ÿå¯èƒ½æ²¡æœ‰ã€‚ä½†æ˜¯ä½ å¯ä»¥é€šè¿‡æ¯”è¾ƒæ›´æ–°å‰åçš„å€¼æ¥å¿½ç•¥ä¸å¿…è¦çš„æ¨¡æ¿æ›´æ–° (è¯¦ç»†çš„é’©å­å‡½æ•°å‚æ•°è§ä¸‹)ã€‚
> - `componentUpdated`ï¼šæŒ‡ä»¤æ‰€åœ¨ç»„ä»¶çš„ VNode **åŠå…¶å­ VNode** å…¨éƒ¨æ›´æ–°åè°ƒç”¨ã€‚
> - `unbind`ï¼šåªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘æ—¶è°ƒç”¨ã€‚

```js
// vue3é’©å­å‡½æ•°
const myDirective = {
  // åœ¨ç»‘å®šå…ƒç´ çš„ attribute å‰æˆ–äº‹ä»¶ç›‘å¬å™¨åº”ç”¨å‰è°ƒç”¨
  created(el, binding, vnode, prevVnode) {},
  // åœ¨å…ƒç´ è¢«æ’å…¥åˆ° DOM å‰è°ƒç”¨
  beforeMount(el, binding, vnode, prevVnode) {},
  // åœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶åŠä»–è‡ªå·±çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½æŒ‚è½½å®Œæˆåè°ƒç”¨
  mounted(el, binding, vnode, prevVnode) {},
  // ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶æ›´æ–°å‰è°ƒç”¨
  beforeUpdate(el, binding, vnode, prevVnode) {},
  // åœ¨ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶åŠä»–è‡ªå·±çš„æ‰€æœ‰å­èŠ‚ç‚¹éƒ½æ›´æ–°åè°ƒç”¨
  updated(el, binding, vnode, prevVnode) {},
  // ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶å¸è½½å‰è°ƒç”¨
  beforeUnmount(el, binding, vnode, prevVnode) {},
  // ç»‘å®šå…ƒç´ çš„çˆ¶ç»„ä»¶å¸è½½åè°ƒç”¨
  unmounted(el, binding, vnode, prevVnode) {}
}
```

æŒ‡ä»¤çš„é’©å­ä¼šä¼ é€’ä»¥ä¸‹å‡ ç§å‚æ•°ï¼š

- `el`ï¼šæŒ‡ä»¤ç»‘å®šåˆ°çš„å…ƒç´ ã€‚è¿™å¯ä»¥ç”¨äºç›´æ¥æ“ä½œ DOMã€‚
- `binding`ï¼šä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«ä»¥ä¸‹å±æ€§ã€‚
  - `value`ï¼šä¼ é€’ç»™æŒ‡ä»¤çš„å€¼ã€‚ä¾‹å¦‚åœ¨ `v-my-directive="1 + 1"` ä¸­ï¼Œå€¼æ˜¯ `2`ã€‚
  - `oldValue`ï¼šä¹‹å‰çš„å€¼ï¼Œä»…åœ¨ `beforeUpdate` å’Œ `updated` ä¸­å¯ç”¨ã€‚æ— è®ºå€¼æ˜¯å¦æ›´æ”¹ï¼Œå®ƒéƒ½å¯ç”¨ã€‚
  - `arg`ï¼šä¼ é€’ç»™æŒ‡ä»¤çš„å‚æ•° (å¦‚æœæœ‰çš„è¯)ã€‚ä¾‹å¦‚åœ¨ `v-my-directive:foo` ä¸­ï¼Œå‚æ•°æ˜¯ `"foo"`ã€‚
  - `modifiers`ï¼šä¸€ä¸ªåŒ…å«ä¿®é¥°ç¬¦çš„å¯¹è±¡ (å¦‚æœæœ‰çš„è¯)ã€‚ä¾‹å¦‚åœ¨ `v-my-directive.foo.bar` ä¸­ï¼Œä¿®é¥°ç¬¦å¯¹è±¡æ˜¯ `{ foo: true, bar: true }`ã€‚
  - `instance`ï¼šä½¿ç”¨è¯¥æŒ‡ä»¤çš„ç»„ä»¶å®ä¾‹ã€‚
  - `dir`ï¼šæŒ‡ä»¤çš„å®šä¹‰å¯¹è±¡ã€‚
- `vnode`ï¼šä»£è¡¨ç»‘å®šå…ƒç´ çš„åº•å±‚ VNodeã€‚
- `prevNode`ï¼šä¹‹å‰çš„æ¸²æŸ“ä¸­ä»£è¡¨æŒ‡ä»¤æ‰€ç»‘å®šå…ƒç´ çš„ VNodeã€‚ä»…åœ¨ `beforeUpdate` å’Œ `updated` é’©å­ä¸­å¯ç”¨ã€‚



ç»™ä¸€ä¸ªå…ƒç´ è®¾ç½®é¢œè‰² v-red v-color="green",è®¾ç½®æ‰‹æœºå·æ­£ç¡®ä¸ºç»¿è‰²ï¼Œä¸æ­£ç¡®ä¸ºçº¢è‰²

å®Œæ•´æ¡ˆä¾‹:

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è‡ªå®šä¹‰æŒ‡ä»¤é’©å­å‡½æ•°åº”ç”¨</title>
</head>
<body>
  <div id="app">
    <div v-red>è‡ªå®šä¹‰æŒ‡ä»¤ æ— å‚æ•° è®¾ç½®ä¸ºçº¢è‰²</div>
    <!-- greenéœ€è¦æ·»åŠ  '' å¦åˆ™è¢«è§†ä¸º å˜é‡ -->
    <div v-color="'green'">è‡ªå®šä¹‰æŒ‡ä»¤ æœ‰å‚æ•° è®¾ç½®ä¸ºç»¿è‰²</div>
    <div v-color="'blue'">è‡ªå®šä¹‰æŒ‡ä»¤ æœ‰å‚æ•° è®¾ç½®ä¸ºè“è‰²</div>
    <input type="text" v-model="tel" v-tel/>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const app = Vue.createApp({
    data () {
      return {
        tel: ''
      }
    },
    directives: {
      tel: { // æ‰‹æœºå·è¾“å…¥æ—¶åˆ¤æ–­æ˜¯å¦ç¬¦åˆè§„åˆ™ï¼Œå¦‚æœç¬¦åˆ æ˜¾ç¤ºä¸ºç»¿è‰² å¦åˆ™ä¸ºçº¢è‰²
        // ç¡®ä¿è¾“å…¥ ä½¿ç”¨ updated é’©å­
        updated (el) {
          if (/^(?:(?:\+|00)86)?1[3-9]\d{9}$/.test(el.value)) {
            el.style.color = 'green'
          } else {
            el.style.color = 'red'
          }
        }
      }
    }
  })

  app.directive('red', {
    mounted (el) {
      el.style.color = 'red'
    }
  })
  app.directive('color', {
    mounted (el, binding) { // binding.value æŒ‡ä»¤ä¼ é€’çš„å€¼
      el.style.color = binding.value
    }
  })

  app.mount('#app')
</script>
</html>
```

> è‡ªå®šä¹‰æŒ‡ä»¤æ›´å¤šçš„ç”¨æ¥å®ç°DOMç›¸å…³æ“ä½œ

> ä¸Šè¿°æ¡ˆä¾‹ä¸­å¦‚æœåœ¨vue2ä¸­ï¼Œä½¿ç”¨ inserted ä»£æ›¿ mountedï¼Œä½¿ç”¨ updateä»£æ›¿updated



## å. vue3è¿‡æ¸¡æ•ˆæœ

Vue æä¾›äº†ä¸¤ä¸ªå†…ç½®ç»„ä»¶ï¼Œå¯ä»¥å¸®åŠ©ä½ åˆ¶ä½œåŸºäºçŠ¶æ€å˜åŒ–çš„è¿‡æ¸¡å’ŒåŠ¨ç”»ï¼š

- `<Transition>` ä¼šåœ¨ä¸€ä¸ªå…ƒç´ æˆ–ç»„ä»¶è¿›å…¥å’Œç¦»å¼€ DOM æ—¶åº”ç”¨åŠ¨ç”»ã€‚
- `<TransitionGroup>` ä¼šåœ¨ä¸€ä¸ª `v-for` åˆ—è¡¨ä¸­çš„å…ƒç´ æˆ–ç»„ä»¶è¢«æ’å…¥ï¼Œç§»åŠ¨ï¼Œæˆ–ç§»é™¤æ—¶åº”ç”¨åŠ¨ç”»ã€‚

é™¤äº†è¿™ä¸¤ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡å…¶ä»–æŠ€æœ¯æ‰‹æ®µæ¥åº”ç”¨åŠ¨ç”»ï¼Œæ¯”å¦‚åˆ‡æ¢ CSS class æˆ–ç”¨çŠ¶æ€ç»‘å®šæ ·å¼æ¥é©±åŠ¨åŠ¨ç”»ã€‚

### 10.1 `<Transition>` ç»„ä»¶

`<Transition>` æ˜¯ä¸€ä¸ªå†…ç½®ç»„ä»¶ï¼Œè¿™æ„å‘³ç€å®ƒåœ¨ä»»æ„åˆ«çš„ç»„ä»¶ä¸­éƒ½å¯ä»¥è¢«ä½¿ç”¨ï¼Œæ— éœ€æ³¨å†Œã€‚å®ƒå¯ä»¥å°†è¿›å…¥å’Œç¦»å¼€åŠ¨ç”»åº”ç”¨åˆ°é€šè¿‡é»˜è®¤æ’æ§½ä¼ é€’ç»™å®ƒçš„å…ƒç´ æˆ–ç»„ä»¶ä¸Šã€‚è¿›å…¥æˆ–ç¦»å¼€å¯ä»¥ç”±ä»¥ä¸‹çš„æ¡ä»¶ä¹‹ä¸€è§¦å‘ï¼š

- ç”± `v-if` æ‰€è§¦å‘çš„åˆ‡æ¢
- ç”± `v-show` æ‰€è§¦å‘çš„åˆ‡æ¢
- ç”±ç‰¹æ®Šå…ƒç´  `<component>` åˆ‡æ¢çš„åŠ¨æ€ç»„ä»¶

ä»¥ä¸‹æ˜¯æœ€åŸºæœ¬ç”¨æ³•çš„ç¤ºä¾‹ï¼š

```html
<button @click="show = !show">Toggle</button>
<Transition>
  <p v-if="show">hello</p>
</Transition>
```

```scss
/* ä¸‹é¢æˆ‘ä»¬ä¼šè§£é‡Šè¿™äº› class æ˜¯åšä»€ä¹ˆçš„ */
.v-enter-active,
.v-leave-active {
  transition: opacity 0.5s ease;
}

.v-enter-from,
.v-leave-to {
  opacity: 0;
}
```

> `<Transition>` ä»…æ”¯æŒå•ä¸ªå…ƒç´ æˆ–ç»„ä»¶ä½œä¸ºå…¶æ’æ§½å†…å®¹ã€‚å¦‚æœå†…å®¹æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶å¿…é¡»ä»…æœ‰ä¸€ä¸ªæ ¹å…ƒç´ ã€‚

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¿‡æ¸¡æ•ˆæœ</title>
  <style>
    .v-enter-from { opacity: 0; transform: translateX(100px);}
    .v-enter-active { transition: all 3s; }
    .v-enter-to { opacity: 1; transform: translateX(0); }
    .v-leave-from { opacity: 1; transform: translateX(0); }
    .v-leave-active { transition: all 3s; }
    .v-leave-to { opacity: 0; transform: translateX(100px); }
  </style>
</head>
<body>
  <div id="app">
    <button @click="show = !show">åˆ‡æ¢</button>
    <!-- é»˜è®¤éœ€è¦å®ç°6ä¸ªæ ·å¼
    v-enter-from
    v-enter-active
    v-enter-to
    v-leave-from
    v-leave-active
    v-leave-to
    -->
    <Transition>
      <h1 v-if="show">æ˜¾ç¤º</h1>
    </Transition>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  Vue.createApp({
    data () {
      return {
        show: false
      }
    }
  }).mount('#app')
</script>
</html>
```



### 10.2 CSS è¿‡æ¸¡ class

ä¸€å…±æœ‰ 6 ä¸ªåº”ç”¨äºè¿›å…¥ä¸ç¦»å¼€è¿‡æ¸¡æ•ˆæœçš„ CSS classã€‚

![](https://cn.vuejs.org/assets/transition-classes.f0f7b3c9.png)

1. `v-enter-from`ï¼šè¿›å…¥åŠ¨ç”»çš„èµ·å§‹çŠ¶æ€ã€‚åœ¨å…ƒç´ æ’å…¥ä¹‹å‰æ·»åŠ ï¼Œåœ¨å…ƒç´ æ’å…¥å®Œæˆåçš„ä¸‹ä¸€å¸§ç§»é™¤ã€‚
2. `v-enter-active`ï¼šè¿›å…¥åŠ¨ç”»çš„ç”Ÿæ•ˆçŠ¶æ€ã€‚åº”ç”¨äºæ•´ä¸ªè¿›å…¥åŠ¨ç”»é˜¶æ®µã€‚åœ¨å…ƒç´ è¢«æ’å…¥ä¹‹å‰æ·»åŠ ï¼Œåœ¨è¿‡æ¸¡æˆ–åŠ¨ç”»å®Œæˆä¹‹åç§»é™¤ã€‚è¿™ä¸ª class å¯ä»¥è¢«ç”¨æ¥å®šä¹‰è¿›å…¥åŠ¨ç”»çš„æŒç»­æ—¶é—´ã€å»¶è¿Ÿä¸é€Ÿåº¦æ›²çº¿ç±»å‹ã€‚
3. `v-enter-to`ï¼šè¿›å…¥åŠ¨ç”»çš„ç»“æŸçŠ¶æ€ã€‚åœ¨å…ƒç´ æ’å…¥å®Œæˆåçš„ä¸‹ä¸€å¸§è¢«æ·»åŠ  (ä¹Ÿå°±æ˜¯ `v-enter-from` è¢«ç§»é™¤çš„åŒæ—¶)ï¼Œåœ¨è¿‡æ¸¡æˆ–åŠ¨ç”»å®Œæˆä¹‹åç§»é™¤ã€‚
4. `v-leave-from`ï¼šç¦»å¼€åŠ¨ç”»çš„èµ·å§‹çŠ¶æ€ã€‚åœ¨ç¦»å¼€è¿‡æ¸¡æ•ˆæœè¢«è§¦å‘æ—¶ç«‹å³æ·»åŠ ï¼Œåœ¨ä¸€å¸§åè¢«ç§»é™¤ã€‚
5. `v-leave-active`ï¼šç¦»å¼€åŠ¨ç”»çš„ç”Ÿæ•ˆçŠ¶æ€ã€‚åº”ç”¨äºæ•´ä¸ªç¦»å¼€åŠ¨ç”»é˜¶æ®µã€‚åœ¨ç¦»å¼€è¿‡æ¸¡æ•ˆæœè¢«è§¦å‘æ—¶ç«‹å³æ·»åŠ ï¼Œåœ¨è¿‡æ¸¡æˆ–åŠ¨ç”»å®Œæˆä¹‹åç§»é™¤ã€‚è¿™ä¸ª class å¯ä»¥è¢«ç”¨æ¥å®šä¹‰ç¦»å¼€åŠ¨ç”»çš„æŒç»­æ—¶é—´ã€å»¶è¿Ÿä¸é€Ÿåº¦æ›²çº¿ç±»å‹ã€‚
6. `v-leave-to`ï¼šç¦»å¼€åŠ¨ç”»çš„ç»“æŸçŠ¶æ€ã€‚åœ¨ä¸€ä¸ªç¦»å¼€åŠ¨ç”»è¢«è§¦å‘åçš„ä¸‹ä¸€å¸§è¢«æ·»åŠ  (ä¹Ÿå°±æ˜¯ `v-leave-from` è¢«ç§»é™¤çš„åŒæ—¶)ï¼Œåœ¨è¿‡æ¸¡æˆ–åŠ¨ç”»å®Œæˆä¹‹åç§»é™¤ã€‚

`v-enter-active` å’Œ `v-leave-active` ç»™æˆ‘ä»¬æä¾›äº†ä¸ºè¿›å…¥å’Œç¦»å¼€åŠ¨ç”»æŒ‡å®šä¸åŒé€Ÿåº¦æ›²çº¿çš„èƒ½åŠ›



### 10.3 ä¸ºè¿‡æ¸¡æ•ˆæœå‘½å

æˆ‘ä»¬å¯ä»¥ç»™ `<Transition>` ç»„ä»¶ä¼ ä¸€ä¸ª `name` prop æ¥å£°æ˜ä¸€ä¸ªè¿‡æ¸¡æ•ˆæœåï¼š

```
<Transition name="fade">
  ...
</Transition>
```

å¯¹äºä¸€ä¸ªæœ‰åå­—çš„è¿‡æ¸¡æ•ˆæœï¼Œå¯¹å®ƒèµ·ä½œç”¨çš„è¿‡æ¸¡ class ä¼šä»¥å…¶åå­—è€Œä¸æ˜¯ `v` ä½œä¸ºå‰ç¼€ã€‚æ¯”å¦‚ï¼Œä¸Šæ–¹ä¾‹å­ä¸­è¢«åº”ç”¨çš„ class å°†ä¼šæ˜¯ `fade-enter-active` è€Œä¸æ˜¯ `v-enter-active`ã€‚è¿™ä¸ªâ€œfadeâ€è¿‡æ¸¡çš„ class åº”è¯¥æ˜¯è¿™æ ·ï¼š

```
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.5s ease;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}
```

> å¯ä»¥ç»“åˆ css3ä¸­çš„ `transition`ä»¥åŠ`animation`å®ç°åŠ¨ç”»æ•ˆæœ



### 10.4 è¿‡æ¸¡æ¨¡å¼

é»˜è®¤åŠ¨ç”»åŒæ—¶è¿›è¡Œçš„ï¼Œå¦‚æœæƒ³è¦è°ƒæ•´åŠ¨ç”»æ‰§è¡Œçš„å…ˆåé¡ºåºï¼Œå¯ä»¥é‡‡ç”¨è¿‡æ¸¡æ¨¡å¼è§£å†³ã€‚

åŒæ—¶ç”Ÿæ•ˆçš„è¿›å…¥å’Œç¦»å¼€çš„è¿‡æ¸¡ä¸èƒ½æ»¡è¶³æ‰€æœ‰è¦æ±‚ï¼Œæ‰€ä»¥ Vue æä¾›äº†**è¿‡æ¸¡æ¨¡å¼**

- `in-out`ï¼šæ–°å…ƒç´ å…ˆè¿›è¡Œè¿‡æ¸¡ï¼Œå®Œæˆä¹‹åå½“å‰å…ƒç´ è¿‡æ¸¡ç¦»å¼€ã€‚
- `out-in`ï¼šå½“å‰å…ƒç´ å…ˆè¿›è¡Œè¿‡æ¸¡ï¼Œå®Œæˆä¹‹åæ–°å…ƒç´ è¿‡æ¸¡è¿›å…¥ã€‚



å®Œæ•´æ¡ˆä¾‹

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>è¿‡æ¸¡æ•ˆæœ_name_mode</title>
  <style>
    .slide-enter-from { opacity: 0; transform: translateX(100px);}
    .slide-enter-active { transition: all 2s; }
    .slide-enter-to { opacity: 1; transform: translateX(0); }
    .slide-leave-from { opacity: 1; transform: translateX(0); }
    .slide-leave-active { transition: all 2s; }
    .slide-leave-to { opacity: 0; transform: translateX(100px); }

   
    .fade-enter-from, .fade-leave-to { opacity: 0; }
    .fade-enter-active, .fade-leave-active { transition: all 2s; }
    .fade-enter-to, .fade-leave-from { opacity: 1; }

  </style>
</head>
<body>
  <div id="app">
    <button @click="show = !show">åˆ‡æ¢</button>
    <!--é»˜è®¤åŠ¨ç”»åŒæ—¶è¿›è¡Œï¼Œé€šè¿‡è¿‡æ¸¡æ¨¡å¼è§£å†³-->
    <transition name="slide" mode="out-in">
      <h1 v-if="show">æ˜¾ç¤º-if</h1>
      <h1 v-else>æ˜¾ç¤º-else</h1>
    </transition>
    <hr/>
    <!--é»˜è®¤ä¸ä¼šæ¸²æŸ“é¢å¤–æ ‡ç­¾ï¼Œå¯ä»¥é€šè¿‡tagæŒ‡æ˜éœ€è¦æ¸²æŸ“ä»€ä¹ˆæ ‡ç­¾ã€‚ å†…éƒ¨å­å…ƒç´ éœ€è¦æ·»åŠ key-->
    <transition-group tag='div' name="slide" mode="out-in">
      <h1 v-if="show" key="1">æ˜¾ç¤º-if</h1>
      <h1 v-if="show" key="2">æ˜¾ç¤º-else</h1>
    </transition-group>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  Vue.createApp({
    data () {
      return {
        show: true
      }
    }
  }).mount('#app')
</script>
</html>
```

> æ›´å¤šä¿¡æ¯è¯·å‚è€ƒï¼šhttps://cn.vuejs.org/guide/built-ins/transition.html#the-transition-component



## åä¸€. Teleportä¼ é€é—¨

> vue3 æ–°å¢ï¼Œæ¨¡ä»¿äº† reactä¸­ Portal

`<Teleport>` æ˜¯ä¸€ä¸ªå†…ç½®ç»„ä»¶ï¼Œå®ƒå¯ä»¥å°†ä¸€ä¸ªç»„ä»¶å†…éƒ¨çš„ä¸€éƒ¨åˆ†æ¨¡æ¿â€œä¼ é€â€åˆ°è¯¥ç»„ä»¶çš„ DOM ç»“æ„å¤–å±‚çš„ä½ç½®å»ã€‚

æœ‰æ—¶æˆ‘ä»¬å¯èƒ½ä¼šé‡åˆ°è¿™æ ·çš„åœºæ™¯ï¼šä¸€ä¸ªç»„ä»¶æ¨¡æ¿çš„ä¸€éƒ¨åˆ†åœ¨é€»è¾‘ä¸Šä»å±äºè¯¥ç»„ä»¶ï¼Œä½†ä»æ•´ä¸ªåº”ç”¨è§†å›¾çš„è§’åº¦æ¥çœ‹ï¼Œå®ƒåœ¨ DOM ä¸­åº”è¯¥è¢«æ¸²æŸ“åœ¨æ•´ä¸ª Vue åº”ç”¨å¤–éƒ¨çš„å…¶ä»–åœ°æ–¹ã€‚

è¿™ç±»åœºæ™¯æœ€å¸¸è§çš„ä¾‹å­å°±æ˜¯å…¨å±çš„æ¨¡æ€æ¡†ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¸Œæœ›è§¦å‘æ¨¡æ€æ¡†çš„æŒ‰é’®å’Œæ¨¡æ€æ¡†æœ¬èº«æ˜¯åœ¨åŒä¸€ä¸ªç»„ä»¶ä¸­ï¼Œå› ä¸ºå®ƒä»¬éƒ½ä¸ç»„ä»¶çš„å¼€å…³çŠ¶æ€æœ‰å…³ã€‚ä½†è¿™æ„å‘³ç€è¯¥æ¨¡æ€æ¡†å°†ä¸æŒ‰é’®ä¸€èµ·æ¸²æŸ“åœ¨åº”ç”¨ DOM ç»“æ„é‡Œå¾ˆæ·±çš„åœ°æ–¹ã€‚è¿™ä¼šå¯¼è‡´è¯¥æ¨¡æ€æ¡†çš„ CSS å¸ƒå±€ä»£ç å¾ˆéš¾å†™ã€‚

å®Œæ•´æ¡ˆä¾‹

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>teleportä¼ é€é—¨</title>
  <style>
    .modal {
      position: fixed;
      left: 0;
      right: 0;
      bottom: 0;
      top: 0;
      background-color: rgba(0,0,0,0.4);
    }
    .modal .box {
      width: 50%;
      min-height: 300px;
      background-color: #fff;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
  </style>
</head>
<body>
  <div id="app">
    <button @click="open=true">æ‰“å¼€æ¨¡æ€æ¡†</button>
    <!-- å®¡æŸ¥å…ƒç´ è¿˜åœ¨ div#app å†…éƒ¨ -->
    <!-- <my-modal v-if="open" @close="close"></my-modal> -->

    <!-- å®¡æŸ¥å…ƒç´ å¾—çŸ¥ ä½ç½®å‘ç”Ÿäº†æ”¹å˜ï¼Œæ”¾åœ¨äº† body æ ‡ç­¾çš„æœ€åº•ä¸‹ -->
    <teleport to="body">
      <my-modal v-if="open" @close="close"></my-modal>
    </teleport>
  </div>
</body>
<template id="modal">
  <div class="modal">
    <div class="box">
      <p>Hello from the modal!</p>
      <button @click="$emit('close')">Close</button>
    </div>
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const Modal = {
    template: '#modal'
  }
  Vue.createApp({
    components: {
      myModal: Modal
    },
    data () {
      return {
        open: false
      }
    },
    methods: {
      close () {
        this.open = false
      }
    }
  }).mount('#app')
</script>
</html>
```

> é€šè¿‡ç»™ç»„ä»¶æ¨¡æ¿æ·»åŠ  `<teleport >`æ ‡ç­¾å®¡æŸ¥å…ƒç´ æŸ¥çœ‹ç»“æœ



## åäºŒ. æ··å…¥Mixins

ä¸€ä¸ªåŒ…å«ç»„ä»¶é€‰é¡¹å¯¹è±¡çš„æ•°ç»„ï¼Œè¿™äº›é€‰é¡¹éƒ½å°†è¢«æ··å…¥åˆ°å½“å‰ç»„ä»¶çš„å®ä¾‹ä¸­ã€‚

`mixins` é€‰é¡¹æ¥å—ä¸€ä¸ª mixin å¯¹è±¡æ•°ç»„ã€‚è¿™äº› mixin å¯¹è±¡å¯ä»¥åƒæ™®é€šçš„å®ä¾‹å¯¹è±¡ä¸€æ ·åŒ…å«å®ä¾‹é€‰é¡¹ï¼Œå®ƒä»¬å°†ä½¿ç”¨ä¸€å®šçš„é€‰é¡¹åˆå¹¶é€»è¾‘ä¸æœ€ç»ˆçš„é€‰é¡¹è¿›è¡Œåˆå¹¶ã€‚ä¸¾ä¾‹æ¥è¯´ï¼Œå¦‚æœä½ çš„ mixin åŒ…å«äº†ä¸€ä¸ª `created` é’©å­ï¼Œè€Œç»„ä»¶è‡ªèº«ä¹Ÿæœ‰ä¸€ä¸ªï¼Œé‚£ä¹ˆè¿™ä¸¤ä¸ªå‡½æ•°éƒ½ä¼šè¢«è°ƒç”¨ã€‚

Mixin é’©å­çš„è°ƒç”¨é¡ºåºä¸æä¾›å®ƒä»¬çš„é€‰é¡¹é¡ºåºç›¸åŒï¼Œä¸”ä¼šåœ¨ç»„ä»¶è‡ªèº«çš„é’©å­å‰è¢«è°ƒç”¨ã€‚

å®Œæ•´æ¡ˆä¾‹ï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>mixins</title>
</head>
<body>
  <div id="app">
    <my-child1></my-child1>
    <hr/>
    <my-child2></my-child2>
  </div>
</body>
<template id="child1">
  <div>
    <h1>child1ç»„ä»¶</h1>
    {{ count }} <button @click="add">åŠ 1</button>
  </div>
</template>
<template id="child2">
  <div>
    <h1>child2ç»„ä»¶</h1>
    {{ count }} <button @click="add">åŠ 1</button>
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp } = Vue

  const myMixin = {
    data () {
      return {
        count: 10
      }
    },
    methods: {
      add () {
        this.count++
      }
    },
    mounted () {
      console.log('1', this.count)
    }
  }

  const Child1 = {
    // å±€éƒ¨æ··å…¥
    mixins: [myMixin],
    template: '#child1',
    data () { // åˆå§‹åŒ–æ•°æ®ç›¸åŒï¼Œç»„ä»¶çš„ ä¼˜å…ˆçº§é«˜äº æ··å…¥
      return {
        count: 100
      }
    },
    mounted () {
      console.log('2', this.count)
    }
  }

  const Child2 = {
    // å±€éƒ¨æ··å…¥
    mixins: [myMixin],
    template: '#child2',
    methods: {
      add () { // å‡½æ•°åç›¸åŒï¼Œ ç»„ä»¶çš„ä¼˜å…ˆçº§é«˜äº æ··å…¥
        this.count += 10
      }
    },
    mounted () { // ç›¸åŒçš„ç”Ÿå‘½å‘¨æœŸçš„é’©å­å‡½æ•°ï¼Œå…ˆæ‰§è¡Œæ··å…¥çš„ä»£ç ï¼Œå†æ‰§è¡Œç»„ä»¶çš„ä»£ç 
      console.log('3', this.count)
    }
  }

  const app = createApp({
    components: {
      MyChild1: Child1,
      MyChild2: Child2
    }
  })

  // å…¨å±€æ··å…¥ // ä¸å»ºè®®ä½¿ç”¨å…¨å±€æ··å…¥,ä¼šç»™æ‰€æœ‰çš„ç»„ä»¶éƒ½åŠ å…¥éƒ¨åˆ†ä»£ç 
  // app.mixin(myMixin)

  app.mount('#app')
</script>
</html>
```

> é™¤äº†ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°å¤–ï¼Œæ‰€æœ‰çš„ä»£ç éƒ½ä»¥ç»„ä»¶ä¸ºä¼˜å…ˆ
>
> ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°å…ˆæ‰§è¡Œ æ··å…¥çš„ï¼Œåæ‰§è¡Œç»„ä»¶çš„



## åä¸‰. ä¸¤ä¸ªé‡è¦çš„å®ä¾‹API

### 13.1 $forceUpdate()

å¼ºåˆ¶è¯¥ç»„ä»¶é‡æ–°æ¸²æŸ“ã€‚

é‰´äº Vue çš„å…¨è‡ªåŠ¨å“åº”æ€§ç³»ç»Ÿï¼Œè¿™ä¸ªåŠŸèƒ½åº”è¯¥å¾ˆå°‘ä¼šè¢«ç”¨åˆ°ã€‚vue2ä¸­å¯¹è±¡ä»¥åŠæ•°ç»„çš„æ“ä½œ,æ•°æ®æ”¹å˜è§†å›¾æ²¡æœ‰æ›´æ–°ï¼Œå¯ä»¥ä½¿ç”¨ $forceUpdate è¿›è¡Œå¼ºåˆ¶æ›´æ–°è§†å›¾

ä¸æ·»åŠ  $forceUpdate å’Œæ·»åŠ ä¹‹åå¯¹æ¯”æŸ¥çœ‹æ•ˆæœ

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>forceupdate_vue2</title>
</head>
<body>
  <div id="app">
    <button @click="change(2)">æ”¹å˜arr[2]çš„æ•°æ®</button>
    <button @click="clear">æ¸…ç©ºæ•°ç»„</button>
    <button @click="test">æ”¹å˜obj</button>
    {{ arr[2] && arr[2].c }}
    <ul>
      <li v-for="(item, index) of arr" :key="index">{{item.a}} - {{ item.b }}</li>
    </ul>
    {{ obj.foo }} - {{ obj.bar }}
  </div>
</body>
 <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
  new Vue({
    data: {
      arr: [
        { a: 1, b:2 },
        { a: 10, b: 20 },
        { a: 100, b: 200 }
      ],
      obj: {
        foo: 'foo'
      }
    },
    methods: {
      change (index) {
        this.arr[index].c = 300 // ç»™å¯¹è±¡æ•°ç»„æ·»åŠ é¢å¤–çš„å±æ€§
        this.$forceUpdate()
      }, 
      clear () {
        this.arr.length = 0 // æ•°ç»„é•¿åº¦è®¾ç½®ä¸º0 æ¸…ç©ºæ•°ç»„
        this.$forceUpdate()
      },
      test () {
        this.obj.bar = 'bar' // å¯¹è±¡æ·»åŠ é¢å¤–çš„å±æ€§
        console.log(this.obj)
        this.$forceUpdate()
      }
    }
  }).$mount('#app')
</script>
</html>
```

> åœ¨vue2ä¸­å¦‚æœåªæ˜¯ä¸ºäº†æ•°æ®æ”¹å˜æ›´æ–°è§†å›¾ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ $set å°†å“åº”å¼æ•°æ®ä¸­æ·»åŠ é¢å¤–çš„å±æ€§ä¹Ÿå˜ä¸ºå“åº”å¼



> `set_vue2.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>vue $set</title>
</head>
<body>
<div id="app">
 <button @click="change(2)">æ”¹å˜arr[2]çš„æ•°æ®</button>
 <button @click="clear">æ¸…ç©ºæ•°ç»„</button>
 <button @click="test">æ”¹å˜obj</button>
 {{ arr[2] && arr[2].c }}
 <ul>
   <li v-for="(item, index) of arr" :key="index">{{item.a}} - {{ item.b }}</li>
 </ul>
 {{ obj.foo }} - {{ obj.bar }}
</div>
</body>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script>
new Vue({
 data: {
   arr: [
     { a: 1, b:2 },
     { a: 10, b: 20 },
     { a: 100, b: 200 }
   ],
   obj: {
     foo: 'foo'
   }
 },
 methods: {
   change (index) {
     // this.arr[index].c = 300 // ç»™å¯¹è±¡æ•°ç»„æ·»åŠ é¢å¤–çš„å±æ€§
     this.$set(this.arr[index], 'c', 300) // ç»™å¯¹è±¡æ•°ç»„æ·»åŠ é¢å¤–çš„å±æ€§
   }, 
   clear () {
     // this.list.length = 0 // æ•°ç»„é•¿åº¦è®¾ç½®ä¸º0 æ¸…ç©ºæ•°ç»„
     this.arr = []
   },
   test () {
     // this.obj.bar = 'bar' // å¯¹è±¡æ·»åŠ é¢å¤–çš„å±æ€§
     this.$set(this.obj, 'bar', 'bar')
     console.log(this.obj)
   }
 }
}).$mount('#app')
</script>
</html>
```



> vue3ä¸­çš„$forceUpdate ä¸€èˆ¬éƒ½ç”¨ä¸åˆ°ï¼Œåœ¨vue2ä¸­å®ç°ä¸äº†çš„ä»¥ä¸Šæ¡ˆä¾‹ï¼Œvue3å…¨éƒ¨æ”¯æŒ
>
> `forceupdate_vue3.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>forceupdate_vue3</title>
</head>
<body>
<div id="app">
 <button @click="change(2)">æ”¹å˜arr[2]çš„æ•°æ®</button>
 <button @click="clear">æ¸…ç©ºæ•°ç»„</button>
 <button @click="test">æ”¹å˜obj</button>
 <ul>
   <li v-for="(item, index) of list" :key="index">{{item}}</li>
 </ul>
 {{ arr[2] && arr[2].c }}
 <ul>
   <li v-for="(item, index) of arr" :key="index">{{item.a}} - {{ item.b }}</li>
 </ul>
 {{ obj.foo }} - {{ obj.bar }}
</div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
const app = Vue.createApp({
 data () {
   return {
     list: ['a', 'b', 'c'],
     arr: [
       { a: 1, b:2 },
       { a: 10, b: 20 },
       { a: 100, b: 200 }
     ],
     obj: {
       foo: 'foo'
     }
   }
 },
 methods: {
  change (index) {
    this.arr[index].c = 300 // ç»™å¯¹è±¡æ•°ç»„æ·»åŠ é¢å¤–çš„å±æ€§
  }, 
  clear () {
    this.arr.length = 0 // æ•°ç»„é•¿åº¦è®¾ç½®ä¸º0 æ¸…ç©ºæ•°ç»„
  },
  test () {
    this.obj.bar = 'bar' // å¯¹è±¡æ·»åŠ é¢å¤–çš„å±æ€§
  }
 }
})
app.mount('#app')
</script>
</html>
```

> vue3ä¸­æ²¡æœ‰äº† $set ä¸ $delete



### 13.2 $nextTick()

ç»‘å®šåœ¨å®ä¾‹ä¸Šçš„ [`nextTick()`](https://cn.vuejs.org/api/general.html#nexttick) å‡½æ•°ã€‚

å’Œå…¨å±€ç‰ˆæœ¬çš„ `nextTick()` çš„å”¯ä¸€åŒºåˆ«å°±æ˜¯ç»„ä»¶ä¼ é€’ç»™ `this.$nextTick()` çš„å›è°ƒå‡½æ•°ä¼šå¸¦ä¸Š `this` ä¸Šä¸‹æ–‡ï¼Œå…¶ç»‘å®šäº†å½“å‰ç»„ä»¶å®ä¾‹ã€‚

`nextTick.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>nextTick</title>
</head>
<body>
  <div id="app">
    <div ref="oDiv">{{ count }}</div>
    <button @click="add">åŠ 1</button>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const app = Vue.createApp({
    data () {
      return {
        count: 1
      }
    },
    methods: {
      add () {
        this.count++
        console.log(this.count) // 2
        console.log(this.$refs.oDiv.innerHTML) // 1
        this.$nextTick(function(){ // å¯ä»¥è·å–æ•°æ®æ›´æ–°åçš„çœŸå®DOMèŠ‚ç‚¹çš„å€¼
          console.log(this.$refs.oDiv.innerHTML) // 2
        })
          
        //Vue.nextTick(()=>{ // æ­¤å¤„éœ€è¦é‡‡ç”¨ç®­å¤´å‡½æ•°ï¼Œå¦åˆ™å†…éƒ¨çš„thisæŒ‡å‘æœ‰é—®é¢˜ï¼Œè·å–ä¸åˆ°$refs
        //  console.log(this)
        //  console.log(this.$refs.oDiv.innerHTML) // 2
        //})
      }
    }
  })

  app.mount('#app')
</script>
</html>
```



## åå››. Vue-cliä½¿ç”¨

ç°åœ¨ä½¿ç”¨å‰ç«¯å·¥ç¨‹åŒ–å¼€å‘é¡¹ç›®æ˜¯ä¸»æµçš„è¶‹åŠ¿ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€äº›å·¥å…·æ¥æ­å»ºvueçš„å¼€å‘ç¯å¢ƒã€‚

### **14.1 å®‰è£…æ–¹æ³•**

#### ä½¿ç”¨ vue-cli åˆ›å»º

> å…¨å±€å®‰è£…vue-cli: 

```js
 ## å®‰è£…æˆ–è€…å‡çº§ä½ çš„@vue/cli
npm install -g @vue/cli
## åˆ›å»º
vue create vue_test(é¡¹ç›®åç§°ï¼Œå¦‚æœåœ¨å½“å‰ç›®å½•çš„è¯ï¼Œç”¨.å³å¯)
## è¿›å…¥é¡¹ç›®
cd vue_test
## å®‰è£…ä¾èµ–
yarn 
## å¯åŠ¨é¡¹ç›®
yarn serve

## æŸ¥çœ‹@vue/cliç‰ˆæœ¬ï¼Œç¡®ä¿@vue/cliç‰ˆæœ¬åœ¨4.5.0ä»¥ä¸Š
vue  -V  
```



> è¿™é‡Œå¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡ä½¿ç”¨è„šæ‰‹æ¶è¿›è¡Œé¡¹ç›®åˆ›å»ºçš„è¯ï¼Œæ˜¯åªæœ‰ä¸¤é¡¹æç¤ºã€‚
>

> ç¬¬ä¸€é¡¹æ˜¯é»˜è®¤é…ç½®ï¼Œæˆ‘ä»¬ä¸€èˆ¬é€‰æ‹©ç¬¬äºŒé¡¹è‡ªå®šä¹‰é…ç½®è¿›è¡Œé¡¹ç›®æ„å»ºã€‚
>

> æˆ‘ä»¬å¯ä»¥è‡ªç”±çš„é€‰æ‹©å“ªäº›é…ç½®ï¼ŒæŒ‰é”®ç›˜ä¸Šä¸‹é”®è¿›è¡Œé€‰ä¸­ï¼Œå®‰è£…ã€‚
>

> é€‰ä¸­å“ªä¸€ä¸ªï¼Œé€šè¿‡é”®ç›˜ç©ºæ ¼é”®ç¡®å®šï¼Œæ‰€æœ‰çš„éƒ½é€‰æ‹©å®Œæ¯•åï¼ŒæŒ‰é”®ç›˜çš„Enteré”®è¿›è¡Œä¸‹ä¸€æ­¥ã€‚
>



éœ€è¦æ³¨æ„çš„æ˜¯ï¼šæ¨¡æ¿åˆ›å»ºçš„æ—¶å€™ä¼šè¯¢é—®éœ€è¦ä½¿ç”¨EsLintæ¥æ ‡å‡†åŒ–æˆ‘ä»¬çš„ä»£ç è§„èŒƒ

https://www.cnblogs.com/mingjian/p/9361027.html



#### ä½¿ç”¨ vite åˆ›å»º

å®˜æ–¹æ–‡æ¡£ï¼šhttps://cn.vuejs.org/guide/quick-start.html

- ä»€ä¹ˆæ˜¯viteï¼Ÿâ€”â€” æ–°ä¸€ä»£å‰ç«¯æ„å»ºå·¥å…·ã€‚
- ä¼˜åŠ¿å¦‚ä¸‹ï¼š
  - å¼€å‘ç¯å¢ƒä¸­ï¼Œæ— éœ€æ‰“åŒ…æ“ä½œï¼Œå¯å¿«é€Ÿçš„å†·å¯åŠ¨ã€‚
  - è½»é‡å¿«é€Ÿçš„çƒ­é‡è½½ï¼ˆHMRï¼‰ã€‚
  - çœŸæ­£çš„æŒ‰éœ€ç¼–è¯‘ï¼Œä¸å†ç­‰å¾…æ•´ä¸ªåº”ç”¨ç¼–è¯‘å®Œæˆã€‚
- ä¼ ç»Ÿæ„å»ºvue-cli ä¸ viteæ„å»ºå¯¹æ¯”å›¾

ä¼ ç»Ÿæ‰“åŒ…å™¨(webpack)çš„æµç¨‹å›¾

![](https://images.wanjunshijie.com/2021/09/20210919023247902.jpg?imageView2/0/format/webp/q/75)

ESMæ‰“åŒ…å™¨æµç¨‹å›¾

![](https://images.wanjunshijie.com/2021/09/20210919023247474.jpg?imageView2/0/format/webp/q/75)



**vite ä¸ webpackå¯¹æ¯”ï¼š**

> viteæœåŠ¡å™¨å¯åŠ¨é€Ÿåº¦æ¯”webpackå¿«ï¼Œç”±äºviteå¯åŠ¨çš„æ—¶å€™ä¸éœ€è¦æ‰“åŒ…ï¼Œä¹Ÿå°±æ— éœ€åˆ†ææ¨¡å—ä¾èµ–ã€ç¼–è¯‘ï¼Œæ‰€ä»¥å¯åŠ¨é€Ÿåº¦éå¸¸å¿«ã€‚å½“æµè§ˆå™¨è¯·æ±‚éœ€è¦çš„æ¨¡å—æ—¶ï¼Œå†å¯¹æ¨¡å—è¿›è¡Œç¼–è¯‘ï¼Œè¿™ç§æŒ‰éœ€åŠ¨æ€ç¼–è¯‘çš„æ¨¡å¼ï¼Œæå¤§ç¼©çŸ­äº†ç¼–è¯‘æ—¶é—´ï¼Œå½“é¡¹ç›®è¶Šå¤§ï¼Œæ–‡ä»¶è¶Šå¤šæ—¶ï¼Œviteçš„å¼€å‘æ—¶ä¼˜åŠ¿è¶Šæ˜æ˜¾ã€‚viteçƒ­æ›´æ–°æ¯”webpackå¿«ï¼Œviteåœ¨HRMæ–¹é¢ï¼Œå½“æŸä¸ªæ¨¡å—å†…å®¹æ”¹å˜æ—¶ï¼Œè®©æµè§ˆå™¨å»é‡æ–°è¯·æ±‚è¯¥æ¨¡å—å³å¯ï¼Œè€Œä¸æ˜¯åƒwebpacké‡æ–°å°†è¯¥æ¨¡å—çš„æ‰€æœ‰ä¾èµ–é‡æ–°ç¼–è¯‘ã€‚



```js
## åˆ›å»ºå·¥ç¨‹
npm init vue@latest

## è¿›å…¥å·¥ç¨‹ç›®å½•
cd <project-name>
## å®‰è£…ä¾èµ–
yarn install
## è¿è¡Œ
yarn dev
```

å¦‚æœé€‰æ‹©[å¿«é€Ÿä¸Šæ‰‹](https://cn.vuejs.org/guide/quick-start.html#creating-a-vue-application)çš„æ–¹æ¡ˆï¼š

å®‰è£…eslint & Prettier 

**viteåˆ›å»ºé¡¹ç›®çš„æ—¶å€™ï¼Œprettierçš„æœ«å°¾ç©ºæ ¼å‡ºç°é—®é¢˜ï¼Œå¯ä»¥å°†å…¶æ”¹æ­£ï¼š**

.prettierrc.json

```
{
  "semi": false,       // æœ«å°¾ä¸éœ€è¦åŠ åˆ†å·
  "singleQuote": true, // å•å¼•å·
  "endOfLine": "auto", // ç©ºæ ¼é—®é¢˜
  "trailingComma": "none" // æœ«å°¾é€—å·
}
```

eslinttrc.js

```
rules: {
    'vue/multi-word-component-names': 'off', // ç»„ä»¶åå­—ä¸éœ€è¦é©¼å³°å‘½å
  },
```

å…³é—­vscodeï¼Œé‡å¯yarn devå³å¯ï¼

https://www.jianshu.com/p/4b94540dd998

viteé¡¹ç›®åˆ›å»ºçš„éœ€è¦æ‰‹åŠ¨æ·»åŠ eslintçš„è§„åˆ™ï¼Œå†…éƒ¨æ‰ä¼šå¯¹äºä½ çš„ä»£ç è¿›è¡Œç›¸å…³çš„éªŒè¯ï¼

```js
/* eslint-env node */
module.exports = {
  root: true,
  'extends': [
    'plugin:vue/vue3-essential',
    'eslint:recommended'
  ],
  parserOptions: {
    ecmaVersion: 'latest'
  },
  rules: {
    quotes: [2, 'single'],// ä½¿ç”¨å•å¼•å· 
    'spaced-comment': 'error',
    'key-spacing': 'error'
  }
}
```



### [14.2 å•æ–‡ä»¶ç»„ä»¶](https://cn.vuejs.org/v2/guide/single-file-components.html)

vueä¸­çš„å•æ–‡ä»¶ç»„ä»¶åŒ…å«ä¸‰éƒ¨åˆ†ï¼š**template  script  style** 

å†…éƒ¨é…ç½®wepackçš„**vue-loader**æ¥å»è§£æå¤„ç†è§£æä»¥.vueä¸ºåç¼€åçš„å•æ–‡ä»¶ç»„ä»¶

- styleæ ‡ç­¾ åŠ ä¸Šscopedå±æ€§ï¼Œcsså±€éƒ¨ç”Ÿæ•ˆ 

    [scopedç©¿é€é—®é¢˜ï¼](https://www.jianshu.com/p/0bc2a4b823d4)

- styleæ ‡ç­¾ åŠ ä¸Šlang="scss"ï¼Œæ”¯æŒscss

    

#### 1) scopedçš„ç©¿é€

child.vue

```scss
// scopedçš„æ·±åº¦ç©¿é€ï¼Œ ä¸ä»…å½±å“è‡ªå·±çš„spanæ ‡ç­¾ï¼Œè¿˜å½±å“åä»£çš„spanæ ‡ç­¾çš„æ ·å¼
::v-deep span {  //[data-v-b36379bb] span
  background: yellow;
  width: v-bind(computedWidth); // å½“computedWidth=200px & computedWidth=100px
  display: inline-block;
}	
```

```vue
<template>
  <div @click="change" class="child">
    <p class="c-p">
      child... <span @click.stop="flag = !flag">{{ msg }}</span>
    </p>
    <hr />
    <Aaa />
  </div>
</template>

<script>
import { defineComponent } from 'vue'
import Aaa from './Aaa.vue'
export default defineComponent({
  components: {
    Aaa
  },
  props: {
    msg: {
      type: String
    }
  },
  methods: {
    change() {
      // å­çˆ¶ç»„ä»¶é€šä¿¡
      this.$emit('changemsg', 'xxxx')
    }
  },
  data() {
    return {
      flag: true
    }
  },
  computed: {
    computedWidth() {
      return this.flag ? '200px' : '100px'
    }
  }
})
</script>

<!--scopedå±æ€§é™åˆ¶æ ·å¼åªèƒ½åœ¨å½“å‰ç»„ä»¶å¯ç”¨-->
<style scoped lang="scss">
.c-p {
  color: red;
}
// scopedçš„æ·±åº¦ç©¿é€ï¼Œä¸ä»…å½±å“è‡ªå·±çš„spanæ ‡ç­¾ï¼Œè¿˜å½±å“åä»£çš„spanæ ‡ç­¾çš„æ ·å¼
::v-deep span {
  background: yellow;
  width: v-bind(computedWidth); // å½“computedWidth=200px & computedWidth=100px
  display: inline-block;
}
</style>

```

```vue
<template>
  <div class="aaa">
    <span>aaa</span>
  </div>
</template>

<script>
import { defineComponent } from 'vue'

export default defineComponent({})
</script>

<style lang="scss" scoped></style>

```



#### 	2) å…³é—­eslintæŸäº›è§„åˆ™

eslinttrc.js

```json
rules: {
     'vue/multi-word-component-names': 'off'  // ç»„ä»¶å‘½åé©¼å³°å¼å…³é—­
}
```



ç»ˆæç­–ç•¥ï¼š eslintè§„åˆ™ï¼Œå½“æˆ‘ä»¬ctrl+s ä¿å­˜çš„æ—¶å€™ï¼Œè®©å…¶è‡ªåŠ¨å¸®åŠ©æ”¹æ­£ã€‚

1. å‡çº§æœ€æ–°çš„ç‰ˆæœ¬
2. å®‰è£…eslintæ’ä»¶
3. ctrl+shift+p  é¦–é€‰é¡¹æ‰“å¼€è®¾ç½®  settings.json

```json
   "editor.codeActionsOnSave": {
        "source.fixAll.eslint":true 
    },
    "eslint.workingDirectories": [
        {"mode": "auto"}
    ],
    "vetur.ignoreProjectWarning": true,
    "vetur.validation.template": false,
```

4.æ‰“å¼€çŠ¶æ€æ ï¼Œå°†åº•éƒ¨çš„eslintç»™å®ƒallowå¼€å¯ã€‚



æ³¨æ„ï¼šeslintä¿å­˜çš„æ—¶å€™å¿½ç„¶ç¼©è¿›4ä¸ªç©ºæ ¼é—®é¢˜ï¼š

https://blog.csdn.net/weixin_43485335/article/details/108379638





å¿«é€Ÿåˆ›å»ºç»„ä»¶æ¨¡æ¿ï¼š(ä¼šæŠ¥ç©ºæ ¼é”™è¯¯ï¼Œéœ€è¦åœ¨prettierè¿›è¡Œé…ç½®)

```json
{
	// Place your snippets for vue here. Each snippet is defined under a snippet name and has a prefix, body and 
	// description. The prefix is what is used to trigger the snippet and the body will be expanded and inserted. Possible variables are:
	// $1, $2 for tab stops, $0 for the final cursor position, and ${1:label}, ${2:another} for placeholders. Placeholders with the 
	// same ids are connected.
	// Example:
	// "Print to console": {
	// 	"prefix": "log",
	// 	"body": [
	// 		"console.log('$1');",
	// 		"$2"
	// 	],
	// 	"description": "Log output to console"
	// }
	"Print to vue": {
		"prefix": "vue2",
		"body": [
		 "<template>",
		 "  <div>",
		 "       ",
		 "  </div>",
		 "</template>",
		 "",
		 "<script>",
		 "export default {",
		 "  data () {",
		 "    return {",
		 "       ",
		 "    }",
		 "  },",
		 "  methods: {",
		 "       ",
		 "  }",
		 "}",
		 "</script>",
		 "",
		 "<style lang=\"scss\" scoped>",
		 "",
		 "</style>",
		 ""
		],
		"description": "å¿«é€Ÿåˆ›å»ºvueå•æ–‡ä»¶ç»„ä»¶"
	},
	"Print to vue setup": {
		"prefix": "vue3",
		"body": [
		 "<template>\n",
		 
		 "</template>\n",
		 "<script>",
		 "import {defineComponent} from 'vue'\n",
		 "export default defineComponent({",
		 "$1",
		 "})",
		 "</script>\n",
		 "<style lang=\"scss\" scoped>\n",
		 "</style>",
		],
		"description": "å¿«é€Ÿåˆ›å»ºvue3å•æ–‡ä»¶ç»„ä»¶"
	}
}
```







#### 	3) proxyä»£ç†é…ç½®

vue-cliè„šæ‰‹æ¶çš„vue.config.jsé…ç½®çš„ï¼š

```json
devServer: {
	 open:true, //è‡ªåŠ¨å¼€å¯æµè§ˆå™¨
     port:8000, //éšä¾¿æ”¹ç«¯å£å·
     proxy: {
         '/api': {
             target: 'https://*.*.com',
             pathRewrite:{
             	'^/api':''
             }
         }
     }
}
```

```js
// axiosè¯·æ±‚çŒ«çœ¼çš„æ•°æ®  å› ä¸ºåç«¯æ²¡æœ‰è®¾ç½®CORSå­—æ®µï¼Œéœ€è¦å‰ç«¯é€šè¿‡proxyä»£ç†è§£å†³
axios.get('/api/ajax/movieOnInfoList?token=&optimus_uuid=A455C0E0F66311EAB68535C86A5B6D1156E0B73EE0934BC586655D13ADC60663&optimus_risk_level=71&optimus_code=10').then(res => {
      console.log(res)
 })
```



vite.config.js

```js
import { fileURLToPath, URL } from 'node:url'

import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'

// https://vitejs.dev/config/
export default defineConfig({
  plugins: [vue()],
  resolve: {
    alias: {
      '@': fileURLToPath(new URL('./src', import.meta.url))
    }
  },
  server: {
    port: 5172,
    proxy: {
      '/db': {
        target: 'http://47.96.0.211:9000'
      }
    }
  }
})

```

```js
axios({
  url: '/db/in_theaters'
}).then((res) => console.log(res))
```



## åäº”. ç§»åŠ¨ç«¯å¼€å‘

æˆ‘ä»¬ç°åœ¨å…³æ³¨çš„ç‚¹è¿˜åœ¨ç§»åŠ¨Mç«™ä¸Šï¼Œæˆ–è€…æˆ‘ä»¬å¯ä»¥å«åšwebappï¼Œå…¶å®å°±æ˜¯è¿è¡Œåœ¨ç§»åŠ¨ç«¯æµè§ˆå™¨ä¸­çš„webç½‘ç«™ã€‚

app:applicationåº”ç”¨ç¨‹åºã€‚

æ‰‹æœºè½¯ä»¶:ä¸»è¦æŒ‡å®‰è£…åœ¨æ™ºèƒ½æ‰‹æœºä¸Šçš„è½¯ä»¶ï¼Œå®Œå–„åŸå§‹ç³»ç»Ÿçš„ä¸è¶³ä¸ä¸ªæ€§åŒ–ã€‚

ç§»åŠ¨ç«¯å¼€å‘æ˜¯ä¸PCç«¯è‚¯å®šæ˜¯æœ‰å¾ˆå¤§ä¸åŒçš„ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦å­¦ä¹ å¦‚ä½•åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šå¼€å‘å®Œç¾é€‚é…çš„app

> ä»å±å¹•å°ºå¯¸ã€å±å¹•ç±»å‹ç­‰æ–¹é¢æ¥çœ‹çš„è¯ï¼Œç§»åŠ¨è®¾å¤‡å’ŒPCè®¾å¤‡å¤§æœ‰ä¸åŒï¼Œæ‰€ä»¥ä»å¸ƒå±€ã€é€‚é…ç­‰æ–¹é¢éƒ½éœ€è¦æˆ‘ä»¬è€ƒè™‘åˆ°

### 15.1 Viewportè§†å£çš„ä½œç”¨ (åœ¨ç§»åŠ¨ç«¯æµè§ˆå™¨ä¸Šé¢ç”¨æ¥æ˜¾ç¤ºç½‘é¡µçš„é‚£ä¸€å—åŒºåŸŸ)

åœ¨å¾ˆä¹…ä»¥å‰ï¼Œæˆ‘ä»¬çš„è®¾å¤‡è¿˜ä¸æ˜¯æ™ºèƒ½è®¾å¤‡çš„æ—¶å€™ï¼Œè®¾å¤‡è®¿é—®æ™ºèƒ½è®¿é—®åˆ°ç½‘é¡µçš„å·¦ä¸Šè§’ï¼ˆå½“æ—¶éƒ½æ˜¯pcç½‘ç«™ï¼‰ï¼ŒæŸ¥çœ‹å…¨éƒ¨å†…å®¹éœ€è¦é€šè¿‡æ»šåŠ¨æ¡

æ…¢æ…¢çš„æˆ‘ä»¬å‘ç°ï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªé¡µé¢æ”¾åˆ°ç§»åŠ¨ç«¯ä¸­è®¿é—®çš„æ—¶å€™ï¼Œæ²¡æœ‰æ»šåŠ¨æ¡äº†ï¼Œä½†æ˜¯å†…å®¹éƒ½ç¼©å°äº†

è¿™æ˜¯å› ä¸ºæˆ‘ä»¬æœ‰äº†ä¸€ä¸ªå«åš**viewport**çš„ä¸€ä¸ªä¸œè¥¿

ç½‘é¡µä¸æ˜¯ç›´æ¥æ”¾å…¥æµè§ˆå™¨ä¸­çš„ï¼Œè€Œæ˜¯å…ˆæ”¾å…¥åˆ°viewportä¸­ï¼Œç„¶åviewportåœ¨ç­‰æ¯”ç¼©æ”¾åˆ°æµè§ˆå™¨çš„å®½åº¦ï¼Œæ”¾å…¥æµè§ˆå™¨ï¼Œviewportåœ¨ç¼©æ”¾çš„è¿‡ç¨‹ä¸­ï¼Œç½‘é¡µå†…å®¹ä¹Ÿè¢«ç¼©å°äº†

ç½‘é¡µè®¿é—®åˆ°çš„clientWidthå…¶å®æ˜¯viewportçš„å®½åº¦

è¿™æ ·çš„è¯æˆ‘ä»¬éœ€è¦åšä¸€äº›å¤„ç†ï¼Œå…¶å®é—®é¢˜çš„æ ¹æºåœ¨äºviewportçš„å®½åº¦å’Œæµè§ˆå™¨å®½åº¦ä¸ä¸€æ ·ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å°†å…¶è®¾ç½®ä¸ºä¸€æ ·çš„è¯ï¼Œä¸ä¼šå‡ºç°è¿™æ ·çš„é—®é¢˜äº†

æˆ‘ä»¬å¯ä»¥é€šè¿‡metaæ ‡ç­¾æ¥è®¾ç½®viewportå°†å…¶è®¾ç½®ä¸ºæµè§ˆå™¨çš„å®½åº¦ï¼Œä¹Ÿå°±æ˜¯è®¾å¤‡çš„å®½åº¦ï¼Œè¿™æ ·çš„è¯å¸ƒå±€å°±ä¼šç®€å•å¤šäº†

**viewportçš„å®½åº¦**

å½“æµè§ˆå™¨å®½åº¦å°äº980çš„æ—¶å€™ï¼Œå®½åº¦å°±æ˜¯980ï¼Œå½“æµè§ˆå™¨å°ºå¯¸å®½åº¦å¤§äº980çš„æ—¶å€™ï¼Œå®½åº¦å’Œæµè§ˆå™¨å®½åº¦ä¸€è‡´

**é€šè¿‡metaæ ‡ç­¾æ¥è®¾ç½®viewport**

<meta> æ ‡ç­¾æä¾›å…³äº HTML æ–‡æ¡£çš„å…ƒæ•°æ®ã€‚å®ƒä¸ä¼šæ˜¾ç¤ºåœ¨é¡µé¢ä¸Šï¼Œä½†æ˜¯å¯¹äºæœºå™¨æ˜¯å¯è¯»çš„ã€‚å¯ç”¨äºæµè§ˆå™¨ï¼ˆå¦‚ä½•æ˜¾ç¤ºå†…å®¹æˆ–é‡æ–°åŠ è½½é¡µé¢ï¼‰ï¼Œæœç´¢å¼•æ“ï¼ˆå…³é”®è¯ï¼‰ï¼Œæˆ–å…¶ä»– web æœåŠ¡ã€‚

[metaæ ‡ç­¾å¤§å…¨](http://blog.csdn.net/yc123h/article/details/51356143)

<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">  
meta viewport çš„6ä¸ªå±æ€§ï¼š

| width         | è®¾ç½®layout viewport çš„å®½åº¦ï¼Œä¸ºä¸€ä¸ªæ­£æ•´æ•°ï¼Œæˆ–å­—ç¬¦ä¸²"width-device" |
| ------------- | -----------------------------------------------------------: |
| initial-scale |                 è®¾ç½®é¡µé¢çš„åˆå§‹ç¼©æ”¾å€¼ï¼Œä¸ºä¸€ä¸ªæ•°å­—ï¼Œå¯ä»¥å¸¦å°æ•° |
| minimum-scale |                 è®¾ç½®é¡µé¢çš„æœ€å°ç¼©æ”¾å€¼ï¼Œä¸ºä¸€ä¸ªæ•°å­—ï¼Œå¯ä»¥å¸¦å°æ•° |
| maximum-scale |                 å…è®¸ç”¨æˆ·çš„æœ€å¤§ç¼©æ”¾å€¼ï¼Œä¸ºä¸€ä¸ªæ•°å­—ï¼Œå¯ä»¥å¸¦å°æ•° |
| height        |       è®¾ç½®layout viewport çš„é«˜åº¦ï¼Œè¿™ä¸ªå±æ€§å¹¶ä¸é‡è¦ï¼Œå¾ˆå°‘ä½¿ç”¨ |
| user-scalable | æ˜¯å¦å…è®¸ç”¨æˆ·è¿›è¡Œç¼©æ”¾ï¼Œå€¼ä¸º"no"æˆ–"yes", no ä»£è¡¨ä¸å…è®¸ï¼Œyesä»£è¡¨å…è®¸ |



ç§»åŠ¨ç«¯å¸ƒå±€æ–¹å¼ä¸è®¾è®¡å›¾

ç°æœ‰çš„å¸ƒå±€æ–¹å¼ï¼š

1. å›ºå®šå¸ƒå±€ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯å›ºå®šçš„å°ºå¯¸ï¼Œå†…å®¹åŒºåŸŸå±…ä¸­åœ¨æµè§ˆå™¨ä¸­é—´

   å†…å®¹åŒºåŸŸçš„å°ºå¯¸ï¼š980,1000,1100,1200


2. å“åº”å¼å¸ƒå±€ï¼Œåˆ©ç”¨åª’ä½“æŸ¥è¯¢æ¥å®ç°ä¸åŒå°ºå¯¸çš„æµè§ˆå™¨æ˜¾ç¤ºç»“æ„ä¸ä¸€æ ·  @media  æ ¹æ®æµè§ˆå™¨åˆ†è¾¨ç‡å¤§å°è¿›è¡Œé€‚é…

   ä¸€èˆ¬ä¼šæœ‰ä¸‰å¼ è®¾è®¡å›¾ï¼ŒPC,å¹³æ¿,æ‰‹æœº 

3. è‡ªé€‚åº”å¸ƒå±€ï¼Œå±äºå“åº”å¼é‡Œçš„ä¸€ç§ï¼Œåˆ©ç”¨remã€ç™¾åˆ†æ¯”ã€vwvhç­‰å¸ƒå±€å•ä½æ¥å®ç°

   è®¾è®¡å›¾ä¸€èˆ¬åªæœ‰ä¸€å¼ ï¼Œ640ã€750å±…å¤š

   

### 15.2 ç§»åŠ¨ç«¯å¸ƒå±€

ç§»åŠ¨çš„å±å¹•å’ŒPCçš„å±å¹•æœ‰ä¸€ä¸ªå¾ˆå¤§çš„åŒºåˆ«ï¼Œ**ç§»åŠ¨ç«¯æ˜¯è§†ç½‘è†œé«˜æ¸…å±ï¼ˆRetinaï¼‰**

**retinaå±å¹•æœ‰ä¸€ä¸ªå±æ€§å«DPRï¼ˆè®¾å¤‡åƒç´ ç¼©æ”¾æ¯”ï¼‰ = ç‰©ç†åƒç´ /é€»è¾‘åƒç´ **

ä¾‹å¦‚ï¼Œiphone 6æ‰‹æœºå•†å®£ä¼ æ‰‹æœºçš„å°ºå¯¸æ˜¯ï¼š750å®½ï¼Œè¿™ä¸ªå€¼å°±æ˜¯ç‰©ç†åƒç´ ï¼Œè€Œä»å¼€å‘è€…çœ¼é‡Œæˆ‘ä»¬æ‰€æŒ‡çš„å…¶å®æ˜¯375pxï¼ˆé€»è¾‘åƒç´ ï¼‰

**åœ¨dprä¸º2çš„æ‰‹æœºä¸­ï¼Œæˆ‘ä»¬çš„ä¸€ä¸ªé€»è¾‘åƒç´ ä¼šä»æ¨ªçºµä¸¤ä¸ªæ–¹å‘åˆ†åˆ«ä»¥2ä¸ªåƒç´ ç‚¹æ¥æ¸²æŸ“**

å¦‚æœä¸ç®¡dprçš„è¯ï¼Œå…¶å®æˆ‘ä»¬å¸ƒå±€ä¾ç„¶å¯ä»¥ï¼Œå› ä¸ºæˆ‘ä»¬è®¾ç½®ä¸€ä¸ªåƒç´ å®½é«˜çš„ä¸œè¥¿çš„è¯ï¼Œåœ¨æ‰‹æœºä¸Šçœ‹è§çš„åŸºæœ¬ä¹Ÿå°±æ˜¯è¿™ä¹ˆå¤§ï¼Œè‡³äºæ‰‹æœºè®¾å¤‡ç”¨å¤šå°‘ä¸ªç‰©ç†åƒç´ å»æ¸²æŸ“ï¼Œå¤§å°è¿˜æ˜¯ä¸ä¼šå˜åŒ–çš„

è®¾è®¡å¸ˆå‡ºå›¾éƒ½æ˜¯2å€çš„ï¼Œæ˜¯å› ä¸ºï¼Œåœ¨é¡µé¢ä¸­é™¤äº†å­—ä½“ï¼ˆçŸ¢é‡å›¾ï¼‰å¤§éƒ¨åˆ†éƒ½æ˜¯ä½å›¾ï¼Œä¹Ÿå°±æ˜¯å¦‚æœä¸€ä¸ªåƒç´ å®½é«˜çš„ç›’å­é‡Œå‡†å¤‡æ”¾å…¥å›¾ç‰‡ï¼Œå¦‚æœå›¾ç‰‡çš„å°ºå¯¸ä¹Ÿæ˜¯ä¸€ä¸ªåƒç´ å®½é«˜çš„è¯ï¼Œå› ä¸ºå…¶å®åœ¨ç§»åŠ¨ç«¯æ¸²æŸ“çš„æ—¶å€™æ˜¯ç”¨å››ä¸ªåƒç´ æ¥æ¸²æŸ“ï¼Œå›¾ç‰‡ä¼šå¤±çœŸï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬ç»™ä¸€åƒç´ å®½é«˜çš„ç›’å­æ”¾å…¥2åƒç´ å®½é«˜çš„å›¾ç‰‡çš„è¯ï¼Œå°±ä¸ä¼šå¤±çœŸ

#### å¸ƒå±€å•ä½

>å› ä¸ºæˆ‘ä»¬çš„ç§»åŠ¨è®¾å¤‡æœ‰å¾ˆå¤šç§ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„å¸ƒå±€ä¸å¯èƒ½æ˜¯å›ºå®šå¸ƒå±€ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦ä½¿ç”¨è‡ªé€‚åº”å¸ƒå±€

æˆ‘ä»¬åœ¨å¼€å‘ä¸­å¯ä»¥é€‰ç”¨å¾ˆå¤šè‡ªé€‚åº”å¸ƒå±€å•ä½ï¼Œè¿™äº›å•ä½å¿…é¡»æ»¡è¶³ä¸€ä¸ªæ¡ä»¶

1. % 

   ä¼˜ç‚¹ï¼šç®€å•ï¼Œæ— éœ€è®¾ç½®ï¼Œå…¼å®¹æ€§å¥½
   ç¼ºç‚¹ï¼šåŸºäºçˆ¶å…ƒç´ çš„å±æ€§æ¥è®¾ç½®ï¼Œå¦‚æœçˆ¶å…ƒç´ æ²¡æœ‰å®½é«˜ï¼Œè®¾ç½®æ— æ•ˆ

2. vwvh

   ä¸€ä¸ªvwç­‰äºviewportå®½åº¦çš„ç™¾åˆ†ä¹‹ä¸€ï¼Œä¸€ä¸ªvhç­‰äºviewporté«˜åº¦çš„ç™¾åˆ†ä¹‹ä¸€
   vmaxç­‰äºvwå’Œvhä¸­è¾ƒå¤§çš„é‚£ä¸ª  vminç­‰äºvwå’Œvhä¸­è¾ƒå°çš„é‚£ä¸ª

   ä¼˜ç‚¹ï¼šç®€å•ï¼Œæ— éœ€è®¾ç½®
   ç¼ºç‚¹ï¼šå…¼å®¹æ€§ä¸å¥½

3. rem

   ä¸€ä¸ªremç­‰äºæ ¹å…ƒç´ ï¼ˆhtmlï¼‰çš„å­—ä½“å¤§å°ï¼Œå…¼å®¹æ€§å¾ˆå¥½

   ä¼˜ç‚¹ï¼šå…¼å®¹å¥½ï¼Œä½¿ç”¨ç®€å•
   ç¼ºç‚¹ï¼šéœ€è¦è®¾ç½®



#### remé€‚é…

å½“æˆ‘ä»¬æƒ³ä½¿ç”¨ä¸€ä¸ªè‡ªé€‚åº”å•ä½çš„æ—¶å€™ï¼Œå‘ç°%æœ‰ç¼ºé™·ï¼Œvwvhå…¼å®¹æ€§å·®ï¼Œå¼¹æ€§ç›’æ‰€é’ˆå¯¹çš„æ˜¯å…ƒç´ æ’åˆ—çš„é—®é¢˜ï¼Œåªé€‚ç”¨äºæŸç§æƒ…å†µï¼Œæ‰€ä»¥æˆ‘ä»¬å°±æƒ³ï¼Œèƒ½ç»™æˆ‘ä¸€ä¸ªæ²¡å•¥ä¸Šé¢çš„ç¼ºé™·çš„å•ä½ï¼Œæƒ³åˆ°äº†rem

remçš„å…¼å®¹æ€§å¥½ä¸€ç‚¹ï¼Œå®ƒä¹Ÿç¡®å®æ˜¯ä¸€ä¸ªå¸ƒå±€å•ä½ï¼Œä¸å—çˆ¶å­å…ƒç´ çš„å½±å“ï¼Œè®¾ç½®äº†remä¹‹åï¼Œä¹Ÿä¸ä¼šå¯¹pxã€emç­‰å•ä½é€ æˆå½±å“ï¼Œå®ƒæ˜¯ä¸€ä¸ªç†æƒ³çš„å•ä½

**remä¹Ÿæœ‰ä¸€ä¸ªè‡´å‘½çš„é—®é¢˜ï¼Œå°±æ˜¯å®ƒä¸æ˜¯ä¸€ä¸ªè‡ªé€‚åº”çš„å•ä½ï¼Œä¸ä¼šè·Ÿç€è®¾å¤‡å°ºå¯¸ä¸åŒè€Œä¸åŒï¼Œä½†æ˜¯æ²¡æœ‰å…³ç³»ï¼Œæˆ‘ä»¬æœ‰ä¸‡èƒ½çš„jsï¼Œå¯ä»¥å»åŠ¨æ€çš„è®¾ç½®å®ƒ**



æ–¹æ³•ï¼š

å¦‚æœè®¾è®¡å›¾æ˜¯640çš„å›¾ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬çŸ¥é“å®ƒæ˜¯ç…§ç€i5æ¥çš„ï¼Œæˆ‘ä»¬ç°åœ¨å‡è®¾ä¸–ç•Œä¸Šæ‰€æœ‰çš„æ‰‹æœºéƒ½æ˜¯320çš„ï¼Œä¹Ÿå°±æ˜¯æ¯ä¸€ä¸ªäººç”¨çš„éƒ½æ˜¯i5ï¼Œåœ¨è¿™ä¸ªç†æƒ³çš„æƒ…å†µä¸‹ï¼Œå› ä¸ºæ‰‹æœºéƒ½ä¸€æ ·ï¼Œå°ºå¯¸éƒ½ä¸€æ ·ï¼Œå’Œpcç«¯çš„å›ºå®šå¸ƒå±€ä¹Ÿå°±ä¸€æ ·äº†

å‡è®¾æœ‰ä¸€ä¸ªåœ¨640çš„å›¾ä¸Šæˆ‘ä»¬é‡å¾—çš„å®½åº¦æ˜¯320ï¼Œå› ä¸ºæ˜¯äºŒå€å›¾ï¼Œæ‰€ä»¥æˆ‘ä»¬çŸ¥é“ï¼Œå®ƒçš„å®é™…å®½åº¦æ˜¯160pxï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬ç›´æ¥ç»™è¿™ä¸ªè®¾ç½®è®¾ç½®widthï¼š160pxå°±å¯ä»¥äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œæˆ‘ä»¬ç©ä¸ªèŠ±å­ï¼Œä¸è¦å•çº¯çš„ä½¿ç”¨pxæ¥è®¾ç½®ï¼Œç”¨remæ¥è®¾ç½®ï¼Œä¾‹å¦‚ï¼Œæˆ‘å¯ä»¥å°†remè®¾ç½®ä¸º100pxï¼Œè¿™æ ·çš„ï¼Œåˆšæ‰çš„ç›’å­è®¾ç½®ä¸ºwidthï¼š1.6remï¼Œç®—æ³•å°±æ˜¯ é‡çš„å®½åº¦/(dpr*100) = è¦è®¾ç½®çš„remå€¼

è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å¼€å¿ƒçš„å¼€å‘ï¼Œé‡ä¸€ä¸ªå°ºå¯¸ï¼Œé™¤ä¸ª2ï¼Œå†å°æ•°ç‚¹æ¨ä¸¤ä½ï¼Œè®¾ç½®å°±è¡Œäº†ï¼Œä½†æ˜¯æˆ‘ä»¬ä¹ŸçŸ¥é“ï¼Œæ‰‹æœºçš„å°ºå¯¸å¹¶ä¸å¯èƒ½éƒ½æ˜¯320ï¼Œè¿™æ ·çš„è¯ï¼Œæ²¡æœ‰å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸€ä¸ªæ¯”ä¾‹æ¥ç®—remåˆ°åº•è®¾ç½®ä¸ºå¤šå°‘

ç”¨jså»è®¾ç½®ï¼š

**document.documentElement.style.fontSize = document.documentElement.clientWidth/3.2 + 'px'** 

è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å¾—åˆ°ä¸€ä¸ªè‡ªé€‚åº”çš„rem 



#### rem+vwè¿›è¡Œé€‚é…

https://www.cnblogs.com/tu-0718/p/10826846.html

https://www.jb51.net/css/731937.html

100vw = 750px ---->  13.333333vw = 100px ---->  html:{font-size:13.3333333vw}






### 15.3 æ³¨æ„çš„1pxè¾¹æ¡†é—®é¢˜

[1pxè¾¹æ¡†](https://www.jianshu.com/p/5ff121936666)

åœ¨ç§»åŠ¨ç«¯ä¸­ï¼Œå¦‚æœç»™å…ƒç´ è®¾ç½®ä¸€ä¸ªåƒç´ çš„è¾¹æ¡†çš„è¯ï¼Œé‚£ä¹ˆåœ¨æ‰‹æœºä¸Šçœ‹èµ·æ¥æ˜¯ä¼šæ¯”ä¸€ä¸ªåƒç´ ç²—çš„ã€‚

è§£å†³æ–¹æ³•ï¼šä½¿ç”¨ä¼ªç±»å…ƒç´ æ¨¡æ‹Ÿè¾¹æ¡†ï¼Œä½¿ç”¨transformç¼©æ”¾



 ä¾‹å¦‚googleæµè§ˆå™¨æ”¯æŒçš„æœ€å°å­—ä½“æ˜¯12px,å¦‚ä½•è®©å…¶æ”¯æŒæ›´å°å­—ä½“?

```
transform:scale()  //css3æ–°ç‰¹æ€§   ï¼ˆå…³é”®å¸§ã€transformã€nth-childé«˜çº§é€‰æ‹©å™¨ï¼‰
```

















## åå…­. vue-router

ç°åœ¨çš„åº”ç”¨éƒ½æµè¡ŒSPAåº”ç”¨ï¼ˆsingle page applicationï¼‰

ä¼ ç»Ÿçš„é¡¹ç›®å¤§å¤šä½¿ç”¨å¤šé¡µé¢ç»“æ„ï¼Œéœ€è¦åˆ‡æ¢å†…å®¹çš„æ—¶å€™æˆ‘ä»¬å¾€å¾€ä¼šè¿›è¡Œå•ä¸ªhtmlæ–‡ä»¶çš„è·³è½¬ï¼Œè¿™ä¸ªæ—¶å€™å—ç½‘ç»œã€æ€§èƒ½å½±å“ï¼Œæµè§ˆå™¨ä¼šå‡ºç°ä¸å®šæ—¶é—´çš„ç©ºç™½ç•Œé¢ï¼Œç”¨æˆ·ä½“éªŒä¸å¥½

**å•é¡µé¢åº”ç”¨å°±æ˜¯ç”¨æˆ·é€šè¿‡æŸäº›æ“ä½œæ›´æ”¹åœ°å€æ urlä¹‹åï¼ŒåŠ¨æ€çš„è¿›è¡Œä¸åŒæ¨¡æ¿å†…å®¹çš„æ— åˆ·æ–°åˆ‡æ¢ï¼Œç”¨æˆ·ä½“éªŒå¥½ã€‚**

**Vueä¸­ä¼šä½¿ç”¨å®˜æ–¹æä¾›çš„vue-routeræ’ä»¶æ¥ä½¿ç”¨å•é¡µé¢ï¼ŒåŸç†å°±æ˜¯é€šè¿‡æ£€æµ‹åœ°å€æ å˜åŒ–åå°†å¯¹åº”çš„è·¯ç”±ç»„ä»¶è¿›è¡Œåˆ‡æ¢ï¼ˆå¸è½½å’Œå®‰è£…ï¼‰**



> SPA vs MPA

<img src="https://s1.ax1x.com/2020/06/01/t8pJ8U.png" alt="spa"  />





### 16.1 ç®€å•è·¯ç”±å®ç°

> yarn add vue-router@4

1. åˆ›å»ºrouterå®ä¾‹

   src/router/index.js

```js
import { createRouter, createWebHashHistory } from 'vue-router'
import FilmsView from '@/views/FilmsView.vue'
import CinemaView from '@/views/CinemaView.vue'
import CenterView from '@/views/CenterView.vue'
import NowplayingView from '@/views/films/NowplayingView.vue'
import ComingSoonView from '@/views/films/ComingSoonView.vue'
const routes = [
  {
    path: '/films',
    component: FilmsView,
  },

  {
    path: '/cinema',
    component: CinemaView
  },
  {
    path: '/center',
    component: CenterView
  },
  {
    path: '/',
    redirect: '/films'  // å†…éƒ¨ä¼šç›´æ¥ /films/nowplaying
  },
  {
    path: '/:pathMatch(.*)',
    redirect: '/films'
  }
]
const router = createRouter({
  history: createWebHashHistory(),
  routes // `routes: routes` çš„ç¼©å†™
})
export default router

```

2. useä½¿ç”¨

```js
import { createApp } from 'vue'
import App from './App.vue'
import router from '@/router'
createApp(App).use(router).mount('#app')
```

3. åˆ©ç”¨**router-view**æ¥æŒ‡å®šè·¯ç”±åˆ‡æ¢çš„ä½ç½®

```vue
 <div>
    <ul>
      <li>
        <router-link to="/films" active-class="orange">ç”µå½±</router-link>
      </li>
      <li>
        <router-link to="/cinema" active-class="orange">å½±é™¢</router-link>
      </li>
      <li>
        <router-link to="/center" active-class="orange">æˆ‘çš„</router-link>
      </li>
    </ul>

    <!-- <ul>
      <router-link
        to="/films"
        v-bind="$props"
        custom
        v-slot="{ isActive, navigate }"
      >
        <li @click="navigate" :class="isActive ? 'orange' : ''">ç”µå½±</li>
      </router-link>
      <router-link
        to="/cinema"
        v-bind="$props"
        custom
        v-slot="{ isActive, navigate }"
      >
        <li @click="navigate" :class="isActive ? 'orange' : ''">å½±é™¢</li>
      </router-link>
    </ul> -->

    <!--æ¸²æŸ“pathå¯¹åº”çš„ç»„ä»¶é¡µé¢-->
    <router-view></router-view>
</div>
```



### [16.2 è·¯ç”±çš„æ‡’åŠ è½½](https://www.cnblogs.com/lijuntao/p/7777581.html)    

æ‡’åŠ è½½ä¹Ÿå«å»¶è¿ŸåŠ è½½ï¼Œå³åœ¨éœ€è¦çš„æ—¶å€™è¿›è¡ŒåŠ è½½ï¼Œéšç”¨éšè½½ã€‚åœ¨å•é¡µåº”ç”¨ä¸­ï¼Œå¦‚æœæ²¡æœ‰åº”ç”¨æ‡’åŠ è½½ï¼Œè¿ç”¨webpackæ‰“åŒ…åçš„æ–‡ä»¶å°†ä¼šå¼‚å¸¸çš„å¤§ï¼Œé€ æˆè¿›å…¥é¦–é¡µæ—¶ï¼Œéœ€è¦åŠ è½½çš„å†…å®¹è¿‡å¤šï¼Œå»¶æ—¶è¿‡é•¿ï¼Œä¸åˆ©äºç”¨æˆ·ä½“éªŒï¼Œè€Œ**è¿ç”¨æ‡’åŠ è½½åˆ™å¯ä»¥å°†é¡µé¢è¿›è¡Œåˆ’åˆ†ï¼Œéœ€è¦çš„æ—¶å€™åŠ è½½é¡µé¢ï¼Œå¯ä»¥æœ‰æ•ˆçš„åˆ†æ‹…é¦–é¡µæ‰€æ‰¿æ‹…çš„åŠ è½½å‹åŠ›ï¼Œå‡å°‘é¦–é¡µåŠ è½½ç”¨æ—¶**ã€‚

éæŒ‰éœ€åŠ è½½åˆ™ä¼šæŠŠæ‰€æœ‰çš„è·¯ç”±ç»„ä»¶å—çš„jsåŒ…æ‰“åœ¨ä¸€èµ·ã€‚å½“ä¸šåŠ¡åŒ…å¾ˆå¤§çš„æ—¶å€™å»ºè®®ç”¨è·¯ç”±çš„æŒ‰éœ€åŠ è½½ï¼ˆæ‡’åŠ è½½ï¼‰ã€‚
æŒ‰éœ€åŠ è½½ä¼šåœ¨é¡µé¢ç¬¬ä¸€æ¬¡è¯·æ±‚çš„æ—¶å€™ï¼ŒæŠŠç›¸å…³è·¯ç”±ç»„ä»¶å—çš„jsæ·»åŠ ä¸Šï¼›

```json
{
  path: '/about',
  name: 'about',
  component: () => import('@/views/About')    //é‡‡ç”¨äº†è·¯ç”±æ‡’åŠ è½½æ–¹å¼(å¼‚æ­¥ç»„ä»¶+webpackä»£ç åˆ†å‰²)
}
```






### 16.3 å¤šçº§è·¯ç”±

åœ¨åˆ›å»ºè·¯ç”±è¡¨çš„æ—¶å€™ï¼Œå¯ä»¥ä¸ºæ¯ä¸€ä¸ªè·¯ç”±å¯¹è±¡åˆ›å»ºchildrenå±æ€§ï¼Œå€¼ä¸ºæ•°ç»„ï¼Œåœ¨è¿™ä¸ªé‡Œé¢åˆå¯ä»¥é…ç½®ä¸€äº›è·¯ç”±å¯¹è±¡æ¥ä½¿ç”¨å¤šçº§è·¯ç”±ï¼Œæ³¨æ„ï¼šä¸€çº§è·¯ç”±pathå‰åŠ '/'

```  js
const routes = [
  {
    path: '/films',
    component: FilmsView, // ä¸€çº§çš„è§†å›¾FilmsView
    name: 'films',
    children: [
      // å¸Œæœ›åœ¨ä¸€çº§è§†å›¾filmsé‡Œé¢æ¸²æŸ“äºŒçº§è§†å›¾çš„è¯ï¼Œéœ€è¦å€ŸåŠ©childrenè¿›è¡Œé…ç½®
      {
        path: '/films',
        redirect: '/films/nowplaying'
      },
      {
        path: '/films/nowplaying',
        component: NowplayingView,
        name: 'np'
      },
      {
        path: '/films/comingsoon',
        component: ComingSoonView,
        name: 'cs'
      }
    ]
  },

  {
    path: '/cinema',
    component: CinemaView
  },
  {
    path: '/center',
    component: CenterView
  },
  {
    path: '/',
    redirect: '/films' // å†…éƒ¨ä¼šç›´æ¥ /films/nowplaying
    // redirect: { name: 'cs' } //name:filmsåªä¼šè·³è½¬åˆ°films
  },
  {
    path: '/:pathMatch(.*)',
    redirect: '/films'
  }
]
```

äºŒçº§è·¯ç”±ç»„ä»¶çš„åˆ‡æ¢ä½ç½®ä¾ç„¶ç”±router-viewæ¥æŒ‡å®šï¼ˆæŒ‡å®šåœ¨çˆ¶çº§è·¯ç”±ç»„ä»¶çš„æ¨¡æ¿ä¸­ï¼‰

```vue
<p>
    <router-link to='/films/nowplaying'>æ­£åœ¨çƒ­æ˜ </router-link>
    <router-link :to='{name:"cs"}'>å³å°†ä¸Šæ˜ </router-link>
</p>
<router-view></router-view>
```



### 16.4 é»˜è®¤è·¯ç”±å’Œé‡å®šå‘

å½“æˆ‘ä»¬è¿›å…¥åº”ç”¨ï¼Œé»˜è®¤åƒæ˜¾ç¤ºæŸä¸€ä¸ªè·¯ç”±ç»„ä»¶ï¼Œæˆ–è€…å½“æˆ‘ä»¬è¿›å…¥æŸä¸€çº§è·¯ç”±ç»„ä»¶çš„æ—¶å€™æƒ³é»˜è®¤æ˜¾ç¤ºå…¶æŸä¸€ä¸ªå­è·¯ç”±ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®é»˜è®¤è·¯ç”±ï¼š

```js
{
    path: '/films',
    component: FilmsView,
    name: 'films',
    children: [
      // å¸Œæœ›åœ¨ä¸€çº§è§†å›¾filmsé‡Œé¢æ¸²æŸ“äºŒçº§è§†å›¾çš„è¯ï¼Œéœ€è¦å€ŸåŠ©childrenè¿›è¡Œé…ç½®
      {
        path: '/films',
        redirect: '/films/nowplaying'
      },
      {
        path: '/films/nowplaying',
        component: NowplayingView,
        name: 'np'
      },
      {
        path: '/films/comingsoon',
        component: ComingSoonView,
        name: 'cs'
      }
    ]
  },
```

å½“æˆ‘ä»¬éœ€è¦è¿›å…¥ä¹‹åè¿›è¡Œé‡å®šå‘åˆ°å…¶ä»–è·¯ç”±çš„æ—¶å€™ï¼Œæˆ–è€…å½“urlä¸è·¯ç”±è¡¨ä¸åŒ¹é…çš„æ—¶å€™ï¼š

```js
{
    path: '/',
    redirect: '/films' // å†…éƒ¨ä¼šç›´æ¥ /films/nowplaying
    // redirect: { name: 'cs' } //name:filmsåªä¼šè·³è½¬åˆ°films
  },
  {
    path: '/:pathMatch(.*)',
    redirect: '/films'
  }
```



### 16.5 å‘½åè·¯ç”±

æˆ‘ä»¬å¯ä»¥ç»™è·¯ç”±å¯¹è±¡é…ç½®nameå±æ€§ï¼Œè¿™æ ·çš„è¯ï¼Œæˆ‘ä»¬åœ¨è·³è½¬çš„æ—¶å€™ç›´æ¥å†™name:mainå°±ä¼šå¿«é€Ÿçš„æ‰¾åˆ°æ­¤nameå±æ€§å¯¹åº”çš„è·¯ç”±ï¼Œä¸éœ€è¦å†™å¤§é‡çš„urlpathè·¯å¾„äº†

```js
{
    path: '/films',
    component: FilmsView,
    name: 'films',
    children: [
      {
        path: '/films',
        redirect: '/films/nowplaying'
      },
      {
        path: '/films/nowplaying',
        component: NowplayingView,
        name: 'np'
      },
      {
        path: '/films/comingsoon',
        component: ComingSoonView,
        name: 'cs'
      }
    ]
  },
```

```vue
<router-link to='/films/comingsoon'>å³å°†ä¸Šæ˜ </router-link>
<router-link :to='{name:"cs"}'>å³å°†ä¸Šæ˜ </router-link>
```





### 16.6 åŠ¨æ€è·¯ç”±åŒ¹é…    

æœ‰çš„æ—¶å€™æˆ‘ä»¬éœ€è¦åœ¨è·¯ç”±è·³è½¬çš„æ—¶å€™è·Ÿä¸Šå‚æ•°ï¼Œè·¯ç”±ä¼ å‚çš„å‚æ•°ä¸»è¦æœ‰ä¸¤ç§ï¼šè·¯ç”±å‚æ•°ã€queryStringå‚æ•°

è·¯ç”±å‚æ•°éœ€è¦åœ¨è·¯ç”±è¡¨é‡Œè®¾ç½®

```js
{
	path:'/detail/:id',
	component:Detail
}
```

ä¸Šé¢çš„ä»£ç å°±æ˜¯ç»™Userè·¯ç”±é…ç½®æ¥æ”¶idçš„å‚æ•°ï¼Œå¤šä¸ªå‚æ•°ç»§ç»­åœ¨åé¢è®¾ç½®

åœ¨ç»„ä»¶ä¸­å¯ä»¥é€šè¿‡**this.$route.params**æ¥ä½¿ç”¨

queryStringå‚æ•°ä¸éœ€è¦åœ¨è·¯ç”±è¡¨è®¾ç½®æ¥æ”¶ï¼Œç›´æ¥è®¾ç½®ï¼Ÿåé¢çš„å†…å®¹ï¼Œåœ¨è·¯ç”±ç»„ä»¶ä¸­é€šè¿‡**this.$route.query**æ¥æ”¶





> é¢è¯•é¢˜ï¼Ÿ

vue-router æ ¸å¿ƒçš„æ ‡ç­¾ï¼Ÿ       router-link    router-view

vue-router æ ¸å¿ƒçš„apiå±æ€§ï¼Ÿ  $routeï¼ˆåŠ¨æ€è·¯ç”±å‚æ•°ï¼‰ vs   $router(ç¼–ç¨‹å¼å¯¼èˆª  push go back forward replaceç­‰)







### 16.7 å£°æ˜å¼å¯¼èˆª router-link

<router-link> ç»„ä»¶æ”¯æŒç”¨æˆ·åœ¨å…·æœ‰è·¯ç”±åŠŸèƒ½çš„åº”ç”¨ä¸­ï¼ˆç‚¹å‡»ï¼‰å¯¼èˆªã€‚ é€šè¿‡ to å±æ€§æŒ‡å®šç›®æ ‡åœ°å€ï¼Œé»˜è®¤æ¸²æŸ“æˆå¸¦æœ‰æ­£ç¡®é“¾æ¥çš„ <a> æ ‡ç­¾ï¼Œå¯ä»¥é€šè¿‡é…ç½® tag å±æ€§ç”Ÿæˆåˆ«çš„æ ‡ç­¾.ã€‚å¦å¤–ï¼Œå½“ç›®æ ‡è·¯ç”±æˆåŠŸæ¿€æ´»æ—¶ï¼Œé“¾æ¥å…ƒç´ è‡ªåŠ¨è®¾ç½®ä¸€ä¸ªè¡¨ç¤ºæ¿€æ´»çš„ CSS ç±»åã€‚

router-linkçš„toå±æ€§ï¼Œé»˜è®¤å†™çš„æ˜¯pathï¼ˆè·¯ç”±çš„è·¯å¾„ï¼‰ï¼Œå¯ä»¥é€šè¿‡è®¾ç½®ä¸€ä¸ªå¯¹è±¡ï¼Œæ¥åŒ¹é…æ›´å¤š

```
:to='{name:"detail",params:{id:_new.id},query:{content:_new.content}}'
```

**nameæ˜¯è¦è·³è½¬çš„è·¯ç”±çš„åå­—ï¼Œä¹Ÿå¯ä»¥å†™pathæ¥æŒ‡å®šè·¯å¾„ï¼Œä½†æ˜¯ç”¨pathçš„æ—¶å€™å°±ä¸èƒ½ä½¿ç”¨paramsä¼ å‚ï¼Œparamsæ˜¯ä¼ è·¯ç”±å‚æ•°ï¼Œqueryä¼ queryStringå‚æ•°**

**replaceå±æ€§å¯ä»¥æ§åˆ¶router-linkçš„è·³è½¬ä¸è¢«è®°å½•**   

**active-classå±æ€§å¯ä»¥æ§åˆ¶è·¯å¾„åˆ‡æ¢çš„æ—¶å€™å¯¹åº”çš„router-linkæ¸²æŸ“çš„domæ·»åŠ çš„ç±»å**

**router-linkå¯ä»¥æ¸²æŸ“é¢å¤–çš„æ ‡ç­¾**

```vue
<ul>
      <!--é‡‡ç”¨å£°æ˜å¼å¯¼èˆªæ–¹å¼è¿›è¡Œè·³è½¬-->
      <router-link to="/film/nowplaying" custom v-slot="{ isActive,navigate }">
        <li :class="isActive ? 'active' : '' " @click="navigate" role="link">æ­£åœ¨çƒ­æ˜ </li>
      </router-link>
      <router-link to="/film/comingsoon" custom v-slot="{ isActive,navigate }">
        <li :class="isActive ? 'active' : '' " @click="navigate" role="link">å³å°†ä¸Šæ˜ </li>
      </router-link>
 </ul>
```





### 16.8 ç¼–ç¨‹å¼å¯¼èˆª

æœ‰çš„æ—¶å€™éœ€è¦åœ¨è·³è½¬å‰è¿›è¡Œä¸€äº›åŠ¨ä½œï¼Œrouter-linkç›´æ¥è·³è½¬ï¼Œéœ€è¦åœ¨æ–¹æ³•é‡Œä½¿ç”¨$routerçš„æ–¹æ³• (push/replace/go/back/forwardç­‰)

> this.$router.push()
>






### 16.9 è·¯ç”±æ¨¡å¼

ä¸ºäº†æ„å»ºSPAï¼ˆå•é¡µé¢åº”ç”¨ï¼‰ï¼Œéœ€è¦å¼•å…¥å‰ç«¯è·¯ç”±ç³»ç»Ÿï¼Œè¿™ä¹Ÿå°±æ˜¯Vue-routerå­˜åœ¨çš„æ„ä¹‰ã€‚å‰ç«¯è·¯ç”±çš„æ ¸å¿ƒï¼Œå°±åœ¨äº â€”â€”â€” æ”¹å˜è§†å›¾çš„åŒæ—¶ä¸ä¼šå‘åç«¯å‘å‡ºè¯·æ±‚ã€‚

è·¯ç”±æœ‰ä¸¤ç§æ¨¡å¼ï¼šhashã€historyï¼Œé»˜è®¤ä¼šä½¿ç”¨hashæ¨¡å¼ï¼Œä½†æ˜¯å¦‚æœurlé‡Œä¸æƒ³å‡ºç°ä¸‘é™‹hashå€¼ï¼Œåœ¨new VueRouterçš„æ—¶å€™é…ç½®modeå€¼ä¸ºhistoryæ¥æ”¹å˜è·¯ç”±æ¨¡å¼ï¼Œæœ¬è´¨ä½¿ç”¨H5çš„histroy.pushStateæ–¹æ³•æ¥æ›´æ”¹urlï¼Œä¸ä¼šå¼•èµ·åˆ·æ–°.

historyæ¨¡å¼ï¼Œä¼šå‡ºç°404 çš„æƒ…å†µï¼Œéœ€è¦åå°é…ç½®ã€‚

å› ä¸ºæˆ‘ä»¬çš„åº”ç”¨æ˜¯ä¸ªå•é¡µå®¢æˆ·ç«¯åº”ç”¨ï¼Œå¦‚æœåå°æ²¡æœ‰æ­£ç¡®çš„é…ç½®ï¼Œå½“ç”¨æˆ·åœ¨æµè§ˆå™¨ç›´æ¥è®¿é—® http://oursite.com/user/id å°±ä¼šè¿”å› 404ï¼Œè¿™å°±ä¸å¥½çœ‹äº†ã€‚

æ‰€ä»¥å‘¢ï¼Œä½ è¦åœ¨æœåŠ¡ç«¯å¢åŠ ä¸€ä¸ªè¦†ç›–æ‰€æœ‰æƒ…å†µçš„å€™é€‰èµ„æºï¼šå¦‚æœ URL åŒ¹é…ä¸åˆ°ä»»ä½•é™æ€èµ„æºï¼Œåˆ™åº”è¯¥è¿”å›åŒä¸€ä¸ª index.html é¡µé¢ï¼Œè¿™ä¸ªé¡µé¢å°±æ˜¯ä½  app ä¾èµ–çš„é¡µé¢ã€‚

https://www.cnblogs.com/leyan/p/8677274.html

https://blog.csdn.net/ygh5123687/article/details/89473578



> hashæ¨¡å¼èƒŒååŸç†ï¼š å…¶å®å°±æ˜¯è°ƒç”¨äº†window.onhashchangeæ–¹æ³• hashå€¼çš„åˆ‡æ¢
>
> historyæ¨¡å¼çš„åŸç†ï¼š æœ¬è´¨ä½¿ç”¨H5çš„histroy.pushStateæ–¹æ³•æ¥æ›´æ”¹url





#### hashæ¨¡å¼å’Œhistoryæ¨¡å¼çš„åŒºåˆ« 

- hashæ¨¡å¼è¾ƒä¸‘ï¼Œhistoryæ¨¡å¼è¾ƒä¼˜é›…
- hashå…¼å®¹IE8ä»¥ä¸Šï¼Œhistoryå…¼å®¹IE10ä»¥ä¸Š
- historyæ¨¡å¼éœ€è¦åç«¯é…åˆå°†æ‰€æœ‰è®¿é—®éƒ½æŒ‡å‘index.htmlï¼Œå¦åˆ™ç”¨æˆ·åˆ·æ–°é¡µé¢ï¼Œä¼šå¯¼è‡´404é”™è¯¯

**åˆ›å»ºhashçš„è·¯ç”±æ¨¡å¼ï¼š**

```js
const router = createRouter({
  // å†…éƒ¨æä¾›äº† history æ¨¡å¼çš„å®ç°ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬åœ¨è¿™é‡Œä½¿ç”¨ hash æ¨¡å¼ã€‚
  history: createWebHashHistory(),
  routes 
})
```



**åˆ›å»ºhistoryçš„è·¯ç”±æ¨¡å¼ï¼š**

```js
const router = createRouter({
  history: createWebHistory(),
  routes
})
```



å¦‚æœæ˜¯historyæ¨¡å¼çš„æ‰“åŒ…ï¼Œåç»­éœ€è¦åœ¨nginx.configä¸­è¿›è¡Œå¦‚ä¸‹é…ç½®ï¼Œå¦åˆ™é¡µé¢åˆ·æ–°404ï¼

http>serverä¸‹æ·»åŠ ï¼š

```js
location / {
	try_files $uri $uri/ /index.html;
}
```

æœ€åæ›¿æ¢å®Œæ¯•é…ç½®æ–‡ä»¶åï¼Œéœ€è¦é‡å¯nginxçš„é…ç½®ï¼š

```js
cd /usr/local/nginx/sbin/
./nginx -s reload
```




### 16.10 è·¯ç”±å®ˆå«

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå½“è·¯ç”±è·³è½¬å‰æˆ–è·³è½¬åã€è¿›å…¥ã€ç¦»å¼€æŸä¸€ä¸ªè·¯ç”±å‰ã€åï¼Œéœ€è¦åšæŸäº›æ“ä½œï¼Œå°±å¯ä»¥ä½¿ç”¨è·¯ç”±é’©å­æ¥ç›‘å¬è·¯ç”±çš„å˜åŒ–

#### å…¨å±€è·¯ç”±é’©å­

```js
let isLogin = true
// router.beforeEach((to) => { // æ²¡æœ‰ä½¿ç”¨ç¬¬ä¸‰ä¸ªå‚æ•°
//   if (!isLogin && to.name !== 'login') {
//     return { name: 'login' }
//   }
// })

// è·¯ç”±è·³è½¬ä¹‹å‰åšä¸€äº›ä¸šåŠ¡
router.beforeEach((to, from, next) => { // ä½¿ç”¨äº†ç¬¬ä¸‰ä¸ªå‚æ•°
  if (to.name !== 'login' && !isLogin) {
    next({ name: 'login' })
  } else {
    next()
  }
})

// è·¯ç”±è·³è½¬ä¹‹å
router.afterEach((to, from) => {
    //ä¼šåœ¨ä»»æ„è·¯ç”±è·³è½¬åæ‰§è¡Œ
  console.log('afterEach')
})
```



#### å•ä¸ªè·¯ç”±é’©å­

åªæœ‰beforeEnterï¼Œåœ¨è¿›å…¥å‰æ‰§è¡Œï¼Œtoå‚æ•°å°±æ˜¯å½“å‰è·¯ç”±

```js
 routes: [
    {
      path: '/foo',
      component: Foo,
      //è¿›å…¥åˆ°Fooç»„ä»¶ä¹‹å‰è°ƒç”¨ï¼
      beforeEnter: (to, from, next) => {
        // ...
      }
    }
  ]
```



#### è·¯ç”±ç»„ä»¶é’©å­

```js
  beforeRouteEnter (to, from, next) {
    // åœ¨æ¸²æŸ“è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±è¢« confirm å‰è°ƒç”¨
    // ä¸ï¼èƒ½ï¼è·å–ç»„ä»¶å®ä¾‹ `this`
    // å› ä¸ºå½“å®ˆå«æ‰§è¡Œå‰ï¼Œç»„ä»¶å®ä¾‹è¿˜æ²¡è¢«åˆ›å»º
  },
  beforeRouteUpdate (to, from, next) {
    // åœ¨å½“å‰è·¯ç”±æ”¹å˜ï¼Œä½†æ˜¯è¯¥ç»„ä»¶è¢«å¤ç”¨æ—¶è°ƒç”¨    
    // ä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªå¸¦æœ‰åŠ¨æ€å‚æ•°çš„è·¯å¾„ /detail/:idï¼Œåœ¨ /detail/1 å’Œ /detail/2 ä¹‹é—´è·³è½¬çš„æ—¶å€™ï¼Œ
    // ç”±äºä¼šæ¸²æŸ“åŒæ ·çš„ Detail ç»„ä»¶ï¼Œå› æ­¤ç»„ä»¶å®ä¾‹ä¼šè¢«å¤ç”¨ã€‚è€Œè¿™ä¸ªé’©å­å°±ä¼šåœ¨è¿™ä¸ªæƒ…å†µä¸‹è¢«è°ƒç”¨ã€‚
    // å¯ä»¥è®¿é—®ç»„ä»¶å®ä¾‹ `this`
  },
  beforeRouteLeave (to, from, next) {
    // å¯¼èˆªç¦»å¼€è¯¥ç»„ä»¶çš„å¯¹åº”è·¯ç”±æ—¶è°ƒç”¨
    // å¯ä»¥è®¿é—®ç»„ä»¶å®ä¾‹ `this`
  }

```



## åä¸ƒ. Vuex

> Vuex æ˜¯ä¸€ä¸ªä¸“ä¸º Vue.js åº”ç”¨ç¨‹åºå¼€å‘çš„**çŠ¶æ€ç®¡ç†æ¨¡å¼ + åº“**ã€‚å®ƒé‡‡ç”¨é›†ä¸­å¼å­˜å‚¨ç®¡ç†åº”ç”¨çš„æ‰€æœ‰ç»„ä»¶çš„çŠ¶æ€ï¼Œå¹¶ä»¥ç›¸åº”çš„è§„åˆ™ä¿è¯çŠ¶æ€ä»¥ä¸€ç§å¯é¢„æµ‹çš„æ–¹å¼å‘ç”Ÿå˜åŒ–ã€‚
>

### 17.1 vuexçš„å®‰è£…ä¸ç®€å•ä½¿ç”¨

yarn add vuex@4

store/index.js

```js
import { createStore } from 'vuex'
// åˆ›å»ºä¸€ä¸ªæ–°çš„ store å®ä¾‹
const store = createStore({
  state() {
    // å®šä¹‰å¤šç»„ä»¶ä¹‹é—´çš„å…±äº«çŠ¶æ€
    return {
      count: 0
    }
  },
  mutations: {
    // æä¾›äº†å¾ˆå¤šåŒæ­¥ä¿®æ”¹stateçŠ¶æ€çš„æ–¹æ³•
    increment(state) {
      state.count++
    }
  }
})

export default store

```

main.js

```js
import { createApp } from 'vue'
import App from './App.vue'
import router from '@/router'
import store from '@/store'
createApp(App).use(router).use(store).mount('#app')
```

cinemaView.vue

```vue
<template>
  <div>cinema...{{ $store.state.count }}</div>
  <button @click="changeCount">æ›´æ”¹count</button>
</template>

<script>
import { defineComponent } from 'vue'

export default defineComponent({
  methods: {
    changeCount() {
      // å¯ä»¥é€šè¿‡commitè§¦å‘å…·ä½“mutationsé‡Œé¢çš„æ–¹æ³•
      this.$store.commit('increment')
    }
  }
})
</script>

<style lang="scss" scoped></style>

```



### 17.2 Getters

Vuex å…è®¸æˆ‘ä»¬åœ¨ store ä¸­å®šä¹‰â€œgetterâ€ï¼ˆå¯ä»¥è®¤ä¸ºæ˜¯ store çš„è®¡ç®—å±æ€§ï¼‰ã€‚

store/index.js

```js
getters: {
    // vuexçš„è®¡ç®—å±æ€§
    doubleCount(state) {
      return state.count * 2
    }
  },
```

```vue
<div>
    cinema...{{ $store.state.count }}...{{ $store.getters.doubleCount }}
  </div>
```



### 17.3 Actions

- Action æäº¤çš„æ˜¯ mutationï¼Œè€Œä¸æ˜¯ç›´æ¥å˜æ›´çŠ¶æ€ã€‚

- Action å¯ä»¥åŒ…å«ä»»æ„å¼‚æ­¥æ“ä½œã€‚

  store/index.js

  ```js
  actions: {
      incrementAsync(context) {
        setTimeout(() => {
          // éœ€è¦è°ƒç”¨mutationsé‡Œé¢çš„incrementæ–¹æ³•ï¼Œå®ç°countæ›´æ”¹
          context.commit('increment')
        }, 1000)
      }
    },
  ```

  ```vue
   <button @click="changeCountAsync">æ›´æ”¹count-async</button>
   
   methods: {
      changeCount() {
        this.$store.commit('increment') // åŒæ­¥çš„è§¦å‘mutationsæ–¹æ³•-é€šè¿‡commitè°ƒç”¨
      },
      changeCountAsync() {
        this.$store.dispatch('incrementAsync') // å¼‚æ­¥çš„è§¦å‘actionsæ–¹æ³•-é€šè¿‡dispatchè°ƒç”¨
      }
    }
  ```



### 17.4 è¾…åŠ©å‡½æ•°ä½¿ç”¨

#### 	mapState

â€‹		å¿«é€Ÿçš„è·å–vuexçš„state   éœ€è¦å†™åœ¨computedä¸­ã€‚ 

####     mapGetters

â€‹     	å¿«é€Ÿçš„è·å–vuexçš„getters éœ€è¦å†™åœ¨computedä¸­ã€‚

â€‹    

```js
import { mapState, mapGetters } from 'vuex'
computed: {
    ...mapState(['count']),
    ...mapGetters(['doubleCount'])
  },
```

```vue
<div>cinema...{{ count }}...{{ doubleCount(3) }}</div>
```



####     mapMutations  

â€‹		å¿«é€Ÿçš„è·å–vuexçš„mutations   éœ€è¦å†™åœ¨methodsä¸­ã€‚

####     mapActions

â€‹		å¿«é€Ÿçš„è·å–vuexçš„actions   éœ€è¦å†™åœ¨methodsä¸­ã€‚ 

```js
import { mapState, mapGetters, mapMutations, mapActions } from 'vuex'

methods: {
    ...mapMutations(['increment']),
    ...mapActions(['incrementAsync']),
 }
```

```vue
<button @click="increment(1)">æ›´æ”¹count</button>
<button @click="incrementAsync(1)">æ›´æ”¹count-async</button>
```



### 17.5 modules

Vuex å…è®¸æˆ‘ä»¬å°† store åˆ†å‰²æˆ**æ¨¡å—ï¼ˆmoduleï¼‰**ã€‚æ¯ä¸ªæ¨¡å—æ‹¥æœ‰è‡ªå·±çš„ stateã€mutationã€actionã€getterã€ç”šè‡³æ˜¯åµŒå¥—å­æ¨¡å—

store/module/countModule.js

```js
export default {
  state() {
    // å®šä¹‰å¤šç»„ä»¶ä¹‹é—´çš„å…±äº«çŠ¶æ€
    return {
      count: 0
    }
  },
  getters: {
    doubleCount: (state) => (params) => {
      return state.count * params
    }
  },
  actions: {
    incrementAsync(context, payload) {
      setTimeout(() => {
        // éœ€è¦è°ƒç”¨mutationsé‡Œé¢çš„incrementæ–¹æ³•ï¼Œå®ç°countæ›´æ”¹
        context.commit('increment', payload)
      }, 1000)
    }
  },
  mutations: {
    // æä¾›äº†å¾ˆå¤šåŒæ­¥ä¿®æ”¹stateçŠ¶æ€çš„æ–¹æ³•
    increment(state, payload) {
      state.count += payload
    }
  }
}

```



store/index.js

```js
import { createStore } from 'vuex'
import countModule from './module/countModule'
const store = createStore({
  modules: {
    // åˆ’åˆ†æ¨¡å—
    countModule
  }
})

export default store
```



cinemaView.vue

```vue
<template>
  <div>cinema...{{ countModule.count }}...{{ doubleCount(3) }}</div>
  <button @click="increment(1)">æ›´æ”¹count</button>
  <button @click="incrementAsync(1)">æ›´æ”¹count-async</button>
</template>

<script>
import { defineComponent } from 'vue'
import { mapState, mapGetters, mapActions, mapMutations } from 'vuex'
export default defineComponent({
  computed: {
    ...mapState(['countModule']), // éœ€è¦æ”¾æ¨¡å—åå­—countModuleæ‰å¯ä»¥
    ...mapGetters(['doubleCount'])
  },
  methods: {
    ...mapMutations(['increment']),
    ...mapActions(['incrementAsync']),
  }
})
</script>

<style lang="scss" scoped></style>

```



å¦‚æœé‡‡ç”¨å‘½åç©ºé—´çš„è¯ï¼š

countModule.js

```
  namespaced: true, //å¼€å¯å‘½åç©ºé—´
```

CinemaView.vue

```vue
<template>
  <div>cinema...{{ count }}.. {{ doubleCount(2) }}</div>
  <button @click="increment(1)">æ›´æ”¹count</button>
  <button @click="incrementAsync(1)">æ›´æ”¹count-async</button>
</template>

<script>
import { defineComponent } from 'vue'
import { mapState, mapMutations, mapGetters, mapActions } from 'vuex'
export default defineComponent({
  computed: {
    ...mapState('countModule', ['count']), // ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡æ˜å…·ä½“çš„æ¨¡å—çš„åå­—
    ...mapGetters('countModule', ['doubleCount'])
  },
  methods: {
    ...mapMutations('countModule', ['increment']), // this.$store.commit('countModule/increment',1)
    ...mapActions('countModule', ['incrementAsync']),// this.$store.dispatch('countModule/incrementAsync',2)
  }
})
</script>

<style lang="scss" scoped></style>

```



### 17.6 vuexçš„æŒä¹…åŒ–

vuexæ˜¯å­˜å†…å­˜çš„ï¼Œæµè§ˆå™¨ä¸€åˆ·æ–°çš„çš„æ—¶å€™ï¼Œæ•°æ®é‡ç½®äº†ï¼Œéœ€è¦ä¸æœ¬åœ°å­˜å‚¨åŒæ­¥ä¸€ä¸‹

```
yarn add vuex-persistedstate
```

store/index.js

```js
import createPersistedState from "vuex-persistedstate";
const store = createStore({
  plugins: [createPersistedState()],
  modules: {
    // åˆ’åˆ†æ¨¡å—
    countModule,
    tabbarModule
  }
})
```

ä¹Ÿå¯ä»¥å•ç‹¬æŒ‡æ˜ç¼“å­˜æŸä¸ªmoduleæ•°æ®ï¼š

```js
plugins: [
    createPersistedState({
      reducer(state) {
        return {
          countModule: state.countModule // åªä¼šç¼“å­˜countModuleè¿™ä¸ªæ¨¡å—çš„æ•°æ®
        }
      }
    })
  ],
```



## åå…«. vue3ç»„åˆå¼API

### 18.1ã€ç»„åˆå¼API

#### ä»€ä¹ˆæ˜¯ç»„åˆå¼API

ç»„åˆå¼ API (Composition API) æ˜¯ä¸€ç³»åˆ— API çš„é›†åˆï¼Œä½¿æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‡½æ•°è€Œä¸æ˜¯å£°æ˜é€‰é¡¹çš„æ–¹å¼ä¹¦å†™ Vue ç»„ä»¶ã€‚å®ƒæ˜¯ä¸€ä¸ªæ¦‚æ‹¬æ€§çš„æœ¯è¯­ï¼Œæ¶µç›–äº†ä»¥ä¸‹æ–¹é¢çš„ APIï¼š

- [å“åº”å¼ API](https://cn.vuejs.org/api/reactivity-core.html)ï¼šä¾‹å¦‚ `ref()` å’Œ `reactive()`ï¼Œä½¿æˆ‘ä»¬å¯ä»¥ç›´æ¥åˆ›å»ºå“åº”å¼çŠ¶æ€ã€è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨ã€‚
- [ç”Ÿå‘½å‘¨æœŸé’©å­](https://cn.vuejs.org/api/composition-api-lifecycle.html)ï¼šä¾‹å¦‚ `onMounted()` å’Œ `onUnmounted()`ï¼Œä½¿æˆ‘ä»¬å¯ä»¥åœ¨ç»„ä»¶å„ä¸ªç”Ÿå‘½å‘¨æœŸé˜¶æ®µæ·»åŠ é€»è¾‘ã€‚
- [ä¾èµ–æ³¨å…¥](https://cn.vuejs.org/api/composition-api-dependency-injection.html)ï¼šä¾‹å¦‚ `provide()` å’Œ `inject()`ï¼Œä½¿æˆ‘ä»¬å¯ä»¥åœ¨ä½¿ç”¨å“åº”å¼ API æ—¶ï¼Œåˆ©ç”¨ Vue çš„ä¾èµ–æ³¨å…¥ç³»ç»Ÿã€‚

ç»„åˆå¼ API æ˜¯ Vue 3 åŠ [Vue 2.7](https://blog.vuejs.org/posts/vue-2-7-naruto.html) çš„å†…ç½®åŠŸèƒ½ã€‚å¯¹äºæ›´è€çš„ Vue 2 ç‰ˆæœ¬ï¼Œå¯ä»¥ä½¿ç”¨å®˜æ–¹ç»´æŠ¤çš„æ’ä»¶ [`@vue/composition-api`](https://github.com/vuejs/composition-api)ã€‚åœ¨ Vue 3 ä¸­ï¼Œç»„åˆå¼ API åŸºæœ¬ä¸Šéƒ½ä¼šé…åˆ<script setup>è¯­æ³•åœ¨å•æ–‡ä»¶ç»„ä»¶ä¸­ä½¿ç”¨ã€‚

#### ä¸ºä»€ä¹ˆä½¿ç”¨å®ƒ

##### æ›´å¥½çš„é€»è¾‘å¤ç”¨[#](https://cn.vuejs.org/guide/extras/composition-api-faq.html#better-logic-reuse)

ç»„åˆå¼ API æœ€åŸºæœ¬çš„ä¼˜åŠ¿æ˜¯å®ƒä½¿æˆ‘ä»¬èƒ½å¤Ÿé€šè¿‡[ç»„åˆå‡½æ•°](https://cn.vuejs.org/guide/reusability/composables.html)æ¥å®ç°æ›´åŠ ç®€æ´é«˜æ•ˆçš„é€»è¾‘å¤ç”¨ã€‚åœ¨é€‰é¡¹å¼ API ä¸­æˆ‘ä»¬ä¸»è¦çš„é€»è¾‘å¤ç”¨æœºåˆ¶æ˜¯ mixinsï¼Œè€Œç»„åˆå¼ API è§£å†³äº† [mixins çš„æ‰€æœ‰ç¼ºé™·](https://cn.vuejs.org/guide/reusability/composables.html#vs-mixins)ã€‚

ç»„åˆå¼ API æä¾›çš„é€»è¾‘å¤ç”¨èƒ½åŠ›å­µåŒ–äº†ä¸€äº›éå¸¸æ£’çš„ç¤¾åŒºé¡¹ç›®ï¼Œæ¯”å¦‚ [VueUse](https://vueuse.org/)ï¼Œä¸€ä¸ªä¸æ–­æˆé•¿çš„å·¥å…·å‹ç»„åˆå¼å‡½æ•°é›†åˆã€‚ç»„åˆå¼ API è¿˜ä¸ºå…¶ä»–ç¬¬ä¸‰æ–¹çŠ¶æ€ç®¡ç†åº“ä¸ Vue çš„å“åº”å¼ç³»ç»Ÿä¹‹é—´çš„é›†æˆæä¾›äº†ä¸€å¥—ç®€æ´æ¸…æ™°çš„æœºåˆ¶ï¼Œä¾‹å¦‚ [RxJS](https://vueuse.org/rxjs/readme.html#vueuse-rxjs)ã€‚

##### æ›´çµæ´»çš„ä»£ç ç»„ç»‡[#](https://cn.vuejs.org/guide/extras/composition-api-faq.html#more-flexible-code-organization)

è®¸å¤šç”¨æˆ·å–œæ¬¢é€‰é¡¹å¼ API çš„åŸå› æ˜¯å› ä¸ºå®ƒåœ¨é»˜è®¤æƒ…å†µä¸‹å°±èƒ½å¤Ÿè®©äººå†™å‡ºæœ‰ç»„ç»‡çš„ä»£ç ï¼šå¤§éƒ¨åˆ†ä»£ç éƒ½è‡ªç„¶åœ°è¢«æ”¾è¿›äº†å¯¹åº”çš„é€‰é¡¹é‡Œã€‚ç„¶è€Œï¼Œé€‰é¡¹å¼ API åœ¨å•ä¸ªç»„ä»¶çš„é€»è¾‘å¤æ‚åˆ°ä¸€å®šç¨‹åº¦æ—¶ï¼Œä¼šé¢ä¸´ä¸€äº›æ— æ³•å¿½è§†çš„é™åˆ¶ã€‚è¿™äº›é™åˆ¶ä¸»è¦ä½“ç°åœ¨éœ€è¦å¤„ç†å¤šä¸ª**é€»è¾‘å…³æ³¨ç‚¹**çš„ç»„ä»¶ä¸­ï¼Œè¿™æ˜¯æˆ‘ä»¬åœ¨è®¸å¤š Vue 2 çš„å®é™…æ¡ˆä¾‹ä¸­æ‰€è§‚å¯Ÿåˆ°çš„ã€‚

æˆ‘ä»¬ä»¥ Vue CLI GUI ä¸­çš„æ–‡ä»¶æµè§ˆå™¨ç»„ä»¶ä¸ºä¾‹ï¼šè¿™ä¸ªç»„ä»¶æ‰¿æ‹…äº†ä»¥ä¸‹å‡ ä¸ªé€»è¾‘å…³æ³¨ç‚¹ï¼š

- è¿½è¸ªå½“å‰æ–‡ä»¶å¤¹çš„çŠ¶æ€ï¼Œå±•ç¤ºå…¶å†…å®¹
- å¤„ç†æ–‡ä»¶å¤¹çš„ç›¸å…³æ“ä½œ (æ‰“å¼€ã€å…³é—­å’Œåˆ·æ–°)
- æ”¯æŒåˆ›å»ºæ–°æ–‡ä»¶å¤¹
- å¯ä»¥åˆ‡æ¢åˆ°åªå±•ç¤ºæ”¶è—çš„æ–‡ä»¶å¤¹
- å¯ä»¥å¼€å¯å¯¹éšè—æ–‡ä»¶å¤¹çš„å±•ç¤º
- å¤„ç†å½“å‰å·¥ä½œç›®å½•ä¸­çš„å˜æ›´

è¿™ä¸ªç»„ä»¶[æœ€åŸå§‹çš„ç‰ˆæœ¬](https://github.com/vuejs/vue-cli/blob/a09407dd5b9f18ace7501ddb603b95e31d6d93c0/packages/@vue/cli-ui/src/components/folder/FolderExplorer.vue#L198-L404)æ˜¯ç”±é€‰é¡¹å¼ API å†™æˆçš„ã€‚å¦‚æœæˆ‘ä»¬ä¸ºç›¸åŒçš„é€»è¾‘å…³æ³¨ç‚¹æ ‡ä¸Šä¸€ç§é¢œè‰²ï¼Œé‚£å°†ä¼šæ˜¯è¿™æ ·ï¼š

![](https://user-images.githubusercontent.com/499550/62783021-7ce24400-ba89-11e9-9dd3-36f4f6b1fae2.png)

ä½ å¯ä»¥çœ‹åˆ°ï¼Œå¤„ç†ç›¸åŒé€»è¾‘å…³æ³¨ç‚¹çš„ä»£ç è¢«å¼ºåˆ¶æ‹†åˆ†åœ¨äº†ä¸åŒçš„é€‰é¡¹ä¸­ï¼Œä½äºæ–‡ä»¶çš„ä¸åŒéƒ¨åˆ†ã€‚åœ¨ä¸€ä¸ªå‡ ç™¾è¡Œçš„å¤§ç»„ä»¶ä¸­ï¼Œè¦è¯»æ‡‚ä»£ç ä¸­çš„ä¸€ä¸ªé€»è¾‘å…³æ³¨ç‚¹ï¼Œéœ€è¦åœ¨æ–‡ä»¶ä¸­åå¤ä¸Šä¸‹æ»šåŠ¨ï¼Œè¿™å¹¶ä¸ç†æƒ³ã€‚å¦å¤–ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å°†ä¸€ä¸ªé€»è¾‘å…³æ³¨ç‚¹æŠ½å–é‡æ„åˆ°ä¸€ä¸ªå¯å¤ç”¨çš„å·¥å…·å‡½æ•°ä¸­ï¼Œéœ€è¦ä»æ–‡ä»¶çš„å¤šä¸ªä¸åŒéƒ¨åˆ†æ‰¾åˆ°æ‰€éœ€çš„æ­£ç¡®ç‰‡æ®µã€‚

è€Œå¦‚æœ[ç”¨ç»„åˆå¼ API é‡æ„](https://gist.github.com/yyx990803/8854f8f6a97631576c14b63c8acd8f2e)è¿™ä¸ªç»„ä»¶ï¼Œå°†ä¼šå˜æˆä¸‹é¢å³è¾¹è¿™æ ·ï¼š

![](https://user-images.githubusercontent.com/499550/62783026-810e6180-ba89-11e9-8774-e7771c8095d6.png)

ç°åœ¨ä¸åŒä¸€ä¸ªé€»è¾‘å…³æ³¨ç‚¹ç›¸å…³çš„ä»£ç è¢«å½’ä¸ºäº†ä¸€ç»„ï¼šæˆ‘ä»¬æ— éœ€å†ä¸ºäº†ä¸€ä¸ªé€»è¾‘å…³æ³¨ç‚¹åœ¨ä¸åŒçš„é€‰é¡¹å—é—´æ¥å›æ»šåŠ¨åˆ‡æ¢ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å¾ˆè½»æ¾åœ°å°†è¿™ä¸€ç»„ä»£ç ç§»åŠ¨åˆ°ä¸€ä¸ªå¤–éƒ¨æ–‡ä»¶ä¸­ï¼Œä¸å†éœ€è¦ä¸ºäº†æŠ½è±¡è€Œé‡æ–°ç»„ç»‡ä»£ç ï¼Œå¤§å¤§é™ä½äº†é‡æ„æˆæœ¬ï¼Œè¿™åœ¨é•¿æœŸç»´æŠ¤çš„å¤§å‹é¡¹ç›®ä¸­éå¸¸å…³é”®ã€‚

##### æ›´å¥½çš„ç±»å‹æ¨å¯¼[#](https://cn.vuejs.org/guide/extras/composition-api-faq.html#better-type-inference)

è¿‘å‡ å¹´æ¥ï¼Œè¶Šæ¥è¶Šå¤šçš„å¼€å‘è€…å¼€å§‹ä½¿ç”¨ [TypeScript](https://www.typescriptlang.org/) ä¹¦å†™æ›´å¥å£®å¯é çš„ä»£ç ï¼ŒTypeScript è¿˜æä¾›äº†éå¸¸å¥½çš„ IDE å¼€å‘æ”¯æŒã€‚ç„¶è€Œé€‰é¡¹å¼ API æ˜¯åœ¨ 2013 å¹´è¢«è®¾è®¡å‡ºæ¥çš„ï¼Œé‚£æ—¶å¹¶æ²¡æœ‰æŠŠç±»å‹æ¨å¯¼è€ƒè™‘è¿›å»ï¼Œå› æ­¤æˆ‘ä»¬ä¸å¾—ä¸åšäº†ä¸€äº›[å¤æ‚åˆ°å¤¸å¼ çš„ç±»å‹ä½“æ“](https://github.com/vuejs/core/blob/44b95276f5c086e1d88fa3c686a5f39eb5bb7821/packages/runtime-core/src/componentPublicInstance.ts#L132-L165)æ‰å®ç°äº†å¯¹é€‰é¡¹å¼ API çš„ç±»å‹æ¨å¯¼ã€‚ä½†å°½ç®¡åšäº†è¿™ä¹ˆå¤šçš„åŠªåŠ›ï¼Œé€‰é¡¹å¼ API çš„ç±»å‹æ¨å¯¼åœ¨å¤„ç† mixins å’Œä¾èµ–æ³¨å…¥ç±»å‹æ—¶ä¾ç„¶ä¸ç”šç†æƒ³ã€‚

å› æ­¤ï¼Œå¾ˆå¤šæƒ³è¦æ­é… TS ä½¿ç”¨ Vue çš„å¼€å‘è€…é‡‡ç”¨äº†ç”± `vue-class-component` æä¾›çš„ Class APIã€‚ç„¶è€Œï¼ŒåŸºäº Class çš„ API éå¸¸ä¾èµ– ES è£…é¥°å™¨ï¼Œåœ¨ 2019 å¹´æˆ‘ä»¬å¼€å§‹å¼€å‘ Vue 3 æ—¶ï¼Œå®ƒä»æ˜¯ä¸€ä¸ªä»…å¤„äº stage 2 çš„è¯­è¨€åŠŸèƒ½ã€‚æˆ‘ä»¬è®¤ä¸ºåŸºäºä¸€ä¸ªä¸ç¨³å®šçš„è¯­è¨€ææ¡ˆå»è®¾è®¡æ¡†æ¶çš„æ ¸å¿ƒ API é£é™©å®åœ¨å¤ªå¤§äº†ï¼Œå› æ­¤æ²¡æœ‰ç»§ç»­å‘ Class API çš„æ–¹å‘å‘å±•ã€‚åœ¨é‚£ä¹‹åè£…é¥°å™¨ææ¡ˆæœç„¶åˆå‘ç”Ÿäº†å¾ˆå¤§çš„å˜åŠ¨ï¼Œåœ¨ 2022 å¹´æ‰ç»ˆäºåˆ°è¾¾ stage 3ã€‚å¦ä¸€ä¸ªé—®é¢˜æ˜¯ï¼ŒåŸºäº Class çš„ API å’Œé€‰é¡¹å¼ API åœ¨é€»è¾‘å¤ç”¨å’Œä»£ç ç»„ç»‡æ–¹é¢å­˜åœ¨ç›¸åŒçš„é™åˆ¶ã€‚

ç›¸æ¯”ä¹‹ä¸‹ï¼Œç»„åˆå¼ API ä¸»è¦åˆ©ç”¨åŸºæœ¬çš„å˜é‡å’Œå‡½æ•°ï¼Œå®ƒä»¬æœ¬èº«å°±æ˜¯ç±»å‹å‹å¥½çš„ã€‚ç”¨ç»„åˆå¼ API é‡å†™çš„ä»£ç å¯ä»¥äº«å—åˆ°å®Œæ•´çš„ç±»å‹æ¨å¯¼ï¼Œä¸éœ€è¦ä¹¦å†™å¤ªå¤šç±»å‹æ ‡æ³¨ã€‚å¤§å¤šæ•°æ—¶å€™ï¼Œç”¨ TypeScript ä¹¦å†™çš„ç»„åˆå¼ API ä»£ç å’Œç”¨ JavaScript å†™éƒ½å·®ä¸å¤ªå¤šï¼è¿™ä¹Ÿè®©è®¸å¤šçº¯ JavaScript ç”¨æˆ·ä¹Ÿèƒ½ä» IDE ä¸­äº«å—åˆ°éƒ¨åˆ†ç±»å‹æ¨å¯¼åŠŸèƒ½ã€‚

##### æ›´å°çš„ç”Ÿäº§åŒ…ä½“ç§¯[#](https://cn.vuejs.org/guide/extras/composition-api-faq.html#smaller-production-bundle-and-less-overhead)

æ­é… `<script setup>` ä½¿ç”¨ç»„åˆå¼ API æ¯”ç­‰ä»·æƒ…å†µä¸‹çš„é€‰é¡¹å¼ API æ›´é«˜æ•ˆï¼Œå¯¹ä»£ç å‹ç¼©ä¹Ÿæ›´å‹å¥½ã€‚è¿™æ˜¯ç”±äº `<script setup>` å½¢å¼ä¹¦å†™çš„ç»„ä»¶æ¨¡æ¿è¢«ç¼–è¯‘ä¸ºäº†ä¸€ä¸ªå†…è”å‡½æ•°ï¼Œå’Œ `<script setup>` ä¸­çš„ä»£ç ä½äºåŒä¸€ä½œç”¨åŸŸã€‚ä¸åƒé€‰é¡¹å¼ API éœ€è¦ä¾èµ– `this` ä¸Šä¸‹æ–‡å¯¹è±¡è®¿é—®å±æ€§ï¼Œè¢«ç¼–è¯‘çš„æ¨¡æ¿å¯ä»¥ç›´æ¥è®¿é—® `<script setup>` ä¸­å®šä¹‰çš„å˜é‡ï¼Œæ— éœ€ä¸€ä¸ªä»£ç å®ä¾‹ä»ä¸­ä»£ç†ã€‚è¿™å¯¹ä»£ç å‹ç¼©æ›´å‹å¥½ï¼Œå› ä¸ºæœ¬åœ°å˜é‡çš„åå­—å¯ä»¥è¢«å‹ç¼©ï¼Œä½†å¯¹è±¡çš„å±æ€§ååˆ™ä¸èƒ½ã€‚



#### ç¬¬ä¸€ä¸ªç»„åˆå¼APIçš„ä¾‹å­

`composition.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ä½“éªŒç»„åˆå¼API</title>
</head>
<body>
  <div id="app">
    <button @click="increment">ç‚¹å‡»äº†{{ count }}æ¬¡</button>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, onMounted, onUpdated } = Vue

  const app = createApp({
    setup () { // ç»„åˆå¼API
      const count = ref(0)
      const increment = () => {
        count.value += 1
      }
      onMounted(() => { // ç”Ÿå‘½å‘¨æœŸé’©å­å‡½æ•°
        document.title = `ç‚¹å‡»æ¬¡æ•°ä¸º${count.value}`
      })
      onUpdated(() => {
        document.title = `ç‚¹å‡»æ¬¡æ•°ä¸º${count.value}`
      })
      return {
        count,
        increment
      }
    }
  })
  app.mount('#app')
</script>
</html>
```

> æå–å…¬å…±éƒ¨åˆ†
>
> `composition_hooks.html`
>
> ```html
> <!DOCTYPE html>
> <html lang="en">
> <head>
> <meta charset="UTF-8">
> <meta http-equiv="X-UA-Compatible" content="IE=edge">
> <meta name="viewport" content="width=device-width, initial-scale=1.0">
> <title>æå–å¤ç”¨ä»£ç </title>
> </head>
> <body>
> <div id="app">
>  <button @click="increment">ç‚¹å‡»äº†{{ count }}æ¬¡</button>
> </div>
> </body>
> <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
> <script>
> const { createApp, ref, onMounted, onUpdated } = Vue
> 
> const useCount = () => {
>  const count = ref(0)
>  const increment = () => {
>    count.value += 1
>  }
>  return {
>    count,
>    increment
>  }
> }
> 
> const useTitle = (count) => {
>  onMounted(() => { 
>    document.title = `ç‚¹å‡»æ¬¡æ•°ä¸º${count.value}`
>  })
>  onUpdated(() => {
>    document.title = `ç‚¹å‡»æ¬¡æ•°ä¸º${count.value}`
>  })
> }
> const app = createApp({
>  setup () { // ç»„åˆå¼API
>    const { count, increment } = useCount() // è‡ªå®šä¹‰hooks
>    useTitle(count) // è‡ªå®šä¹‰hooks
>    return {
>      count,
>      increment
>    }
>  }
> })
> 
> app.mount('#app')
> </script>
> </html>
> ```





### 18.2ã€setup()å‡½æ•°

`setup()` é’©å­æ˜¯åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç»„åˆå¼ API çš„å…¥å£ï¼Œé€šå¸¸åªåœ¨ä»¥ä¸‹æƒ…å†µä¸‹ä½¿ç”¨ï¼š

1. éœ€è¦åœ¨éå•æ–‡ä»¶ç»„ä»¶ä¸­ä½¿ç”¨ç»„åˆå¼ API æ—¶ã€‚
2. éœ€è¦åœ¨åŸºäºé€‰é¡¹å¼ API çš„ç»„ä»¶ä¸­é›†æˆåŸºäºç»„åˆå¼ API çš„ä»£ç æ—¶ã€‚

**å…¶ä»–æƒ…å†µä¸‹ï¼Œéƒ½åº”ä¼˜å…ˆä½¿ç”¨ [`<script setup>`](https://cn.vuejs.org/api/sfc-script-setup.html) è¯­æ³•ã€‚**

#### åŸºæœ¬ä½¿ç”¨

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨[å“åº”å¼ API](https://cn.vuejs.org/api/reactivity-core.html) æ¥å£°æ˜å“åº”å¼çš„çŠ¶æ€ï¼Œåœ¨ `setup()` å‡½æ•°ä¸­è¿”å›çš„å¯¹è±¡ä¼šæš´éœ²ç»™æ¨¡æ¿å’Œç»„ä»¶å®ä¾‹ã€‚å…¶å®ƒçš„é€‰é¡¹ä¹Ÿå¯ä»¥é€šè¿‡ç»„ä»¶å®ä¾‹æ¥è·å– `setup()` æš´éœ²çš„å±æ€§

```vue
<script>
import { ref } from 'vue'

export default {
  setup() {
    const count = ref(0)
    // è¿”å›å€¼ä¼šæš´éœ²ç»™æ¨¡æ¿å’Œå…¶ä»–çš„é€‰é¡¹å¼ API é’©å­
    return {
      count
    }
  },
  mounted() {
    console.log(this.count) // 0
  }
}
</script>

<template>
  <button @click="count++">{{ count }}</button>
</template>

```



è¯·æ³¨æ„åœ¨æ¨¡æ¿ä¸­è®¿é—®ä» `setup` è¿”å›çš„ [ref](https://cn.vuejs.org/api/reactivity-core.html#ref) æ—¶ï¼Œå®ƒä¼š[è‡ªåŠ¨æµ…å±‚è§£åŒ…](https://cn.vuejs.org/guide/essentials/reactivity-fundamentals.html#deep-reactivity)ï¼Œå› æ­¤ä½ æ— é¡»å†åœ¨æ¨¡æ¿ä¸­ä¸ºå®ƒå†™ `.value`ã€‚å½“é€šè¿‡ `this` è®¿é—®æ—¶ä¹Ÿä¼šåŒæ ·å¦‚æ­¤è§£åŒ…ã€‚

> `setup()` è‡ªèº«å¹¶ä¸å«å¯¹ç»„ä»¶å®ä¾‹çš„è®¿é—®æƒï¼Œå³åœ¨ `setup()` ä¸­è®¿é—® `this` ä¼šæ˜¯ `undefined`ã€‚ä½ å¯ä»¥åœ¨é€‰é¡¹å¼ API ä¸­è®¿é—®ç»„åˆå¼ API æš´éœ²çš„å€¼ï¼Œä½†åè¿‡æ¥åˆ™ä¸è¡Œã€‚

`composition_setup_base.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>setupçš„åŸºæœ¬ä½¿ç”¨</title>
</head>
<body>
  <div id="app">
    {{ count }}
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, onMounted, onUpdated } = Vue

  const app = createApp({
    setup () { // ç»„åˆå¼API
      // åˆ›å»ºäº†å“åº”å¼å˜é‡
      const count = ref(0)
      // è¿”å›å€¼ä¼šæš´éœ²ç»™æ¨¡æ¿å’Œå…¶ä»–çš„é€‰é¡¹å¼ API é’©å­
      return {
        count
      }
    },
    data () { // è™½ç„¶è®¾ç½®äº†åŒåçš„å˜é‡ï¼Œä½†æ˜¯æ˜¾ç¤ºçš„æ˜¯ ç»„åˆå¼APIä¸­çš„æ•°æ®
      return {
        count: 100
      }
    },
    mounted () {
      console.log(this.count) // 0
    }
  })

  app.mount('#app')
</script>
</html>
```



#### è®¿é—® Prop

`setup` å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç»„ä»¶çš„ `props`ã€‚å’Œæ ‡å‡†çš„ç»„ä»¶ä¸€è‡´ï¼Œä¸€ä¸ª `setup` å‡½æ•°çš„ `props` æ˜¯å“åº”å¼çš„ï¼Œå¹¶ä¸”ä¼šåœ¨ä¼ å…¥æ–°çš„ props æ—¶åŒæ­¥æ›´æ–°ã€‚

```js
{
  props: {
    title: String,
    count: Number
  },
  setup(props) {
    console.log(props.title)
    console.log(props.count)
  }
}
```

> è¯·æ³¨æ„å¦‚æœä½ è§£æ„äº† `props` å¯¹è±¡ï¼Œè§£æ„å‡ºçš„å˜é‡å°†ä¼šä¸¢å¤±å“åº”æ€§ã€‚å› æ­¤æˆ‘ä»¬æ¨èé€šè¿‡ `props.xxx` çš„å½¢å¼æ¥ä½¿ç”¨å…¶ä¸­çš„ propsã€‚

å¦‚æœä½ ç¡®å®éœ€è¦è§£æ„ `props` å¯¹è±¡ï¼Œæˆ–è€…éœ€è¦å°†æŸä¸ª prop ä¼ åˆ°ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ä¸­å¹¶ä¿æŒå“åº”æ€§ï¼Œé‚£ä¹ˆä½ å¯ä»¥ä½¿ç”¨ [toRefs()](https://cn.vuejs.org/api/reactivity-utilities.html#torefs) å’Œ [toRef()](https://cn.vuejs.org/api/reactivity-utilities.html#toref) è¿™ä¸¤ä¸ªå·¥å…·å‡½æ•°ï¼š

```js
{
  setup(props) {
    // å°† `props` è½¬ä¸ºä¸€ä¸ªå…¶ä¸­å…¨æ˜¯ ref çš„å¯¹è±¡ï¼Œç„¶åè§£æ„
    const { title } = toRefs(props)
    // `title` æ˜¯ä¸€ä¸ªè¿½è¸ªç€ `props.title` çš„ ref
    console.log(title.value)

    // æˆ–è€…ï¼Œå°† `props` çš„å•ä¸ªå±æ€§è½¬ä¸ºä¸€ä¸ª ref
    const title = toRef(props, 'title')
  }
}
```

`composition_setup_props.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>setupè®¿é—®props</title>
</head>
<body>
  <div id="app">
    {{ count }} <button @click="count++">åŠ 1</button>
    <my-com :count="count"></my-com>
  </div>
</body>
<template id="com">
  <div>
    <h1>å­ç»„ä»¶</h1>
    {{ count }} -- {{doubleCount}}
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, computed, toRefs, toRef } = Vue
  const Com = {
    template: '#com',
    props: {
      count: Number
    },
    setup (props) {
      // console.log(props)
      // 1.è®¡ç®—å±æ€§ - å“åº”å¼
      // const doubleCount = computed(() => props.count * 2)

      // 2.ä¸è¦æŠŠpropsä¸­çš„æ•°æ®è§£æ„ï¼Œè§£æ„ä¼šä¸¢å¤±å“åº”å¼
      // const { count } = props // æ¨¡æ¿ä¸­ doubleCount å§‹ç»ˆä¸º 0
      // const doubleCount = computed(() => count * 2)

      // 3.å¦‚æœæ—¢éœ€è¦è§£æ„ï¼Œè¿˜è¦ä¿æŒå“åº”å¼ toRefs
      // const { count } = toRefs(props) // å°† `props` è½¬ä¸ºä¸€ä¸ªå…¶ä¸­å…¨æ˜¯ ref çš„å¯¹è±¡ï¼Œç„¶åè§£æ„
      // const doubleCount = computed(() => count.value * 2) // refå¯¹è±¡è®¿é—®å€¼é€šè¿‡ value å±æ€§

      // 4.ä¿æŒå“åº”å¼ toRef
      const count = toRef(props, 'count') // å°† `props` çš„å•ä¸ªå±æ€§è½¬ä¸ºä¸€ä¸ª ref
      const doubleCount = computed(() => count.value * 2)

      return {
        doubleCount
      }
    }
  }

  const app = createApp({
   components: {
    myCom: Com
   },
   setup () {
    const count = ref(0)
    return {
      count
    }
   }
  })

  app.mount('#app')
</script>
</html>
```



#### Setupçš„ä¸Šä¸‹æ–‡

ä¼ å…¥ `setup` å‡½æ•°çš„ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ª **Setup ä¸Šä¸‹æ–‡**å¯¹è±¡ã€‚ä¸Šä¸‹æ–‡å¯¹è±¡æš´éœ²äº†å…¶ä»–ä¸€äº›åœ¨ `setup` ä¸­å¯èƒ½ä¼šç”¨åˆ°çš„å€¼ï¼š

```
{
  setup(props, context) {
    // é€ä¼  Attributesï¼ˆéå“åº”å¼çš„å¯¹è±¡ï¼Œç­‰ä»·äº $attrsï¼‰
    console.log(context.attrs)

    // æ’æ§½ï¼ˆéå“åº”å¼çš„å¯¹è±¡ï¼Œç­‰ä»·äº $slotsï¼‰
    console.log(context.slots)

    // è§¦å‘äº‹ä»¶ï¼ˆå‡½æ•°ï¼Œç­‰ä»·äº $emitï¼‰
    console.log(context.emit)

    // æš´éœ²å…¬å…±å±æ€§ï¼ˆå‡½æ•°ï¼‰
    console.log(context.expose)
  }
}
```

è¯¥ä¸Šä¸‹æ–‡å¯¹è±¡æ˜¯éå“åº”å¼çš„ï¼Œå¯ä»¥å®‰å…¨åœ°è§£æ„ï¼š

```
{
  setup(props, { attrs, slots, emit, expose }) {
    ...
  }
}
```



`expose` å‡½æ•°ç”¨äºæ˜¾å¼åœ°é™åˆ¶è¯¥ç»„ä»¶æš´éœ²å‡ºçš„å±æ€§ï¼Œå½“çˆ¶ç»„ä»¶é€šè¿‡[æ¨¡æ¿å¼•ç”¨](https://cn.vuejs.org/guide/essentials/template-refs.html#ref-on-component)è®¿é—®è¯¥ç»„ä»¶çš„å®ä¾‹æ—¶ï¼Œå°†ä»…èƒ½è®¿é—® `expose` å‡½æ•°æš´éœ²å‡ºçš„å†…å®¹

`composition_setup_context.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>setupä¸Šä¸‹æ–‡å¯¹è±¡-attrs-slots-emit-expose</title>
</head>
<body>
  <div id="app">
    <!-- 1.éªŒè¯ ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­çš„ attrs å±æ€§ -->
    <!-- <my-com class="active" style="color: red" id="box" @click="test" @my-event="getData"></my-com> -->
    <!-- 2.éªŒè¯ä¸Šä¸‹æ–‡å¯¹è±¡ä¸­çš„ slots å±æ€§ -->
    <my-com ref="child" class="active" style="color: red" id="box" @click="test" @my-event="getData">
      <template #default>
        111
      </template>
      <template #footer>
        222
      </template>
    </my-com>
  </div>
</body>
<template id="com">
  <div>
    <h1>å­ç»„ä»¶</h1>
    <button @click="sendData">ä¼ å€¼ç»™çˆ¶ç»„ä»¶</button>
    <slot>333</slot>
    <slot name="footer"></slot>
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, computed, toRefs, toRef, onMounted } = Vue

  const Com = {
    template: '#com',
    // mounted(){
    //   console.log('this-->',this.$attrs,this.$slots)
    // },
    setup (props, context) {
      // 1.é€ä¼  Attributesï¼ˆéå“åº”å¼çš„å¯¹è±¡ï¼Œç­‰ä»·äº $attrsï¼‰
      // { class: 'active', id: 'box', style: {color:'red'}, onClick: fn,onMyEvent:fn}
      console.log(context.attrs)

      // 2.æ’æ§½ï¼ˆéå“åº”å¼çš„å¯¹è±¡ï¼Œç­‰ä»·äº $slotsï¼‰
      console.log(context.slots) // { default: fn, footer: fn }

      // 3. è§¦å‘äº‹ä»¶ï¼ˆå‡½æ•°ï¼Œç­‰ä»·äº $emitï¼‰
      const sendData = () => {
        // é€‰é¡¹å¼ç»„ä»¶ this.$emit('my-event', 1000)
        // ç»„åˆå¼ç»„ä»¶ ä¸å¯ä»¥åœ¨setupä¸­è®¿é—®this
        context.emit('my-event', 1000)
      }

      // 4.æš´éœ²å…¬å…±å±æ€§ï¼ˆå‡½æ•°ï¼‰ 
      const msg = ref('hello composition api')
      const name = ref('zhangsan')
      const changeName = () => {
        name.value = 'å¼ ä¸‰'
      }
      context.expose({ // çˆ¶ç»„ä»¶å¯ä»¥é€šè¿‡ ref è·å–åˆ°æš´éœ²å‡ºå»çš„æ•°æ®å’Œæ–¹æ³•
        name, changeName
      })
      return {
        sendData
      }
    }
  }

  const app = createApp({
   components: {
    MyCom: Com
   },
   setup () {
    const test = () => {console.log('test...')}
    const getData = (val) => {
      console.log(val)
    }
    // ç»„åˆå¼api ç»™ç»„ä»¶å®šä¹‰ref
    const child = ref()
    onMounted(() => {
      // console.log('msg', this) // thisæŒ‡å‘window,ä¸èƒ½this.$refs.childä½¿ç”¨ï¼
      // console.log('msg', child.value.msg) // undefined å› ä¸ºå­ç»„ä»¶æ²¡æœ‰ expose è¿™ä¸ªå€¼
      
      // child.value.changeName() // è°ƒç”¨childç»„ä»¶æš´éœ²çš„changeNameæ–¹æ³•
      // console.log('name', child.value.name) // zhangsan
    })
    return {
      child, // ä¸€å®šå°†childå‘å¤–æš´éœ²ï¼Œåœ¨æ¨¡æ¿ä¸­é€šè¿‡ref='child'
      test,
      getData
    }
   },
  //  mounted () { // é€‰é¡¹å¼APIè·å–å­ç»„ä»¶å®ä¾‹
  //   console.log('msg', this.$refs.child.msg) // undefined å› ä¸ºå­ç»„ä»¶æ²¡æœ‰ expose è¿™ä¸ªå€¼
  //   console.log('name', this.$refs.child.name) // zhangsan
  //  }
  })

  app.mount('#app')
</script>
</html>
```

> åœ¨çˆ¶ç»„ä»¶é€šè¿‡refè·å–å­ç»„ä»¶çš„å®ä¾‹çš„å±æ€§å’Œæ–¹æ³•çš„éœ€æ±‚ä¸­ï¼Œéœ€è¦æ³¨æ„ï¼š
>
> 1.å¦‚æœå­ç»„ä»¶æ˜¯ é€‰é¡¹å¼APIç»„ä»¶ï¼ŒåŸºæœ¬ä¸éœ€è¦åšä»»ä½•æ“ä½œ
>
> 2.å¦‚æœå­ç»„ä»¶æ˜¯ ç»„åˆå¼APIç»„ä»¶ï¼Œéœ€è¦é€šè¿‡ context.expose æš´éœ²ç»™çˆ¶ç»„ä»¶éœ€è¦ä½¿ç”¨çš„å±æ€§å’Œæ–¹æ³•
>
> 3.å¦‚æœçˆ¶ç»„ä»¶ä½¿ç”¨ é€‰é¡¹å¼API, å¯ä»¥é€šè¿‡ this.$refs.refName è®¿é—®åˆ°å­ç»„ä»¶æƒ³è¦ä½ çœ‹åˆ°çš„å±æ€§å’Œæ–¹æ³•
>
> 4.å¦‚æœçˆ¶ç»„ä»¶ä½¿ç”¨ ç»„åˆå¼API,éœ€è¦åœ¨setupä¸­å…ˆåˆ›å»º refNameï¼Œç„¶åå†è®¿é—®å­ç»„ä»¶exposeæš´éœ²çš„å±æ€§å’Œæ–¹æ³•ï¼ˆconst refName = ref()    refName.value.Xï¼‰



#### ä¸æ¸²æŸ“å‡½æ•°ä¸€èµ·ä½¿ç”¨

`setup` ä¹Ÿå¯ä»¥è¿”å›ä¸€ä¸ª[æ¸²æŸ“å‡½æ•°](https://cn.vuejs.org/guide/extras/render-function.html)ï¼Œæ­¤æ—¶åœ¨æ¸²æŸ“å‡½æ•°ä¸­å¯ä»¥ç›´æ¥ä½¿ç”¨åœ¨åŒä¸€ä½œç”¨åŸŸä¸‹å£°æ˜çš„å“åº”å¼çŠ¶æ€ï¼š

```
{
  setup() {
    const count = ref(0)
    return () => h('div', count.value)
  }
}
```

è¿”å›ä¸€ä¸ªæ¸²æŸ“å‡½æ•°å°†ä¼šé˜»æ­¢æˆ‘ä»¬è¿”å›å…¶ä»–ä¸œè¥¿ã€‚å¯¹äºç»„ä»¶å†…éƒ¨æ¥è¯´ï¼Œè¿™æ ·æ²¡æœ‰é—®é¢˜ï¼Œä½†å¦‚æœæˆ‘ä»¬æƒ³é€šè¿‡æ¨¡æ¿å¼•ç”¨å°†è¿™ä¸ªç»„ä»¶çš„æ–¹æ³•æš´éœ²ç»™çˆ¶ç»„ä»¶ï¼Œé‚£å°±æœ‰é—®é¢˜

æˆ‘ä»¬å¯ä»¥é€šè¿‡è°ƒç”¨ [`expose()`](https://cn.vuejs.org/api/composition-api-setup.html#exposing-public-properties) è§£å†³è¿™ä¸ªé—®é¢˜ï¼š

```
{
  setup(props, { expose }) {
    const count = ref(0)
    const increment = () => ++count.value

    expose({
      increment
    })

    return () => h('div', count.value)
  }
}
```

`composition_setup_render_function.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>setupæ¸²æŸ“å‡½æ•°</title>
</head>
<body>
  <div id="app">
    <button @click="add">åŠ 1</button>
    <my-com ref="com" ></my-com>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, h } = Vue
  const Com = {
    setup (props, { expose,emit }) {
      const count = ref(0)
      const increment = () => {
        count.value += 1
      } 
       expose({ // å…³é”®å°†incrementæ–¹æ³•å‘å¤–æš´éœ²ç»™çˆ¶ç»„ä»¶è°ƒç”¨
         increment
       })
      return () => h('div', { class: 'box' }, count.value)
    }
  }
  const app = createApp({
    components: {
      myCom: Com
    },
    setup (props,{emit}) { // ç»„åˆå¼API
      const com = ref()
      const add = () => {
        com.value.increment() // è·å–åˆ°å­ç»„ä»¶å‘å¤–æš´éœ²çš„incrementæ–¹æ³•
      }
      return {
        com,
        add,
      }
    }
  })

  app.mount('#app')
</script>
</html>
```



ä¸Šè¿°ä»£ç ç­‰ä»·äºï¼š

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>setupæ¸²æŸ“å‡½æ•°</title>
</head>
<body>
  <div id="app">
    <button @click="add">åŠ 1</button>
    <my-com ref="com" ></my-com>
  </div>

  <template id="com">
    <div>{{count}}</div>
  </template>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, h } = Vue
  const Com = {
    template:'#com',
    setup (props, { expose,emit }) {
      const count = ref(0)
      const increment = () => {
        count.value += 1
      } 
      return {
        count,
        increment  // å¯ä»¥æ”¾åœ¨æ­¤å¤„å‘å¤–æš´éœ²ï¼Œä¹Ÿå¯ä»¥å€ŸåŠ©exposeè¿›è¡Œå¤–éƒ¨æš´éœ²
      }
    }
  }
  const app = createApp({
    components: {
      myCom: Com
    },
    setup (props,{emit}) { // ç»„åˆå¼API
      const com = ref()
      const add = () => {
        com.value.increment()
      }
      return {
        com,
        add,
      }
    }
  })

  app.mount('#app')
</script>
</html>
```



### 18.3ã€å“åº”å¼æ ¸å¿ƒ

#### ref()

æ¥å—ä¸€ä¸ªå†…éƒ¨å€¼ï¼Œè¿”å›ä¸€ä¸ªå“åº”å¼çš„ã€å¯æ›´æ”¹çš„ ref å¯¹è±¡ï¼Œæ­¤å¯¹è±¡åªæœ‰ä¸€ä¸ªæŒ‡å‘å…¶å†…éƒ¨å€¼çš„å±æ€§ `.value`ã€‚

ref å¯¹è±¡æ˜¯å¯æ›´æ”¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥ä¸º `.value` èµ‹äºˆæ–°çš„å€¼ã€‚å®ƒä¹Ÿæ˜¯å“åº”å¼çš„ï¼Œå³æ‰€æœ‰å¯¹ `.value` çš„æ“ä½œéƒ½å°†è¢«è¿½è¸ªï¼Œå¹¶ä¸”å†™æ“ä½œä¼šè§¦å‘ä¸ä¹‹ç›¸å…³çš„å‰¯ä½œç”¨ã€‚

å¦‚æœå°†ä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™ refï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†é€šè¿‡ [reactive()](https://cn.vuejs.org/api/reactivity-core.html#reactive) è½¬ä¸ºå…·æœ‰æ·±å±‚æ¬¡å“åº”å¼çš„å¯¹è±¡ã€‚

**å°†ä¸€ä¸ª refå¯¹è±¡èµ‹å€¼ç»™ä¸€ä¸ª reactive å¯¹è±¡å±æ€§å€¼çš„æ—¶åï¼Œæ­¤ ref ä¼šè¢«è‡ªåŠ¨è§£åŒ…**

`composition_ref.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_ref</title>
</head>
<body>
  <div id="app">
    count: <button @click="add">åŠ 1</button>{{ count }} <br />
    state.count: <button @click="increment">åŠ 1</button> {{ state.count }} <br />
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, reactive } = Vue

  const app = createApp({
    setup () {
      // 1.ref å¯¹è±¡æ˜¯å¯æ›´æ”¹çš„ï¼Œä¹Ÿå°±æ˜¯è¯´ä½ å¯ä»¥ä¸º `.value` èµ‹äºˆæ–°çš„å€¼
      const count = ref(0)
      const add = () => {
        count.value += 1
      }

      // 2.å¦‚æœå°†ä¸€ä¸ªå¯¹è±¡èµ‹å€¼ç»™ refï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°†é€šè¿‡ reactive() è½¬ä¸ºå…·æœ‰æ·±å±‚æ¬¡å“åº”å¼çš„å¯¹è±¡ã€‚
      const state = ref({ count: 10 })
      const increment = () => {
        state.value.count += 1
      }

      // 3.å°†ä¸€ä¸ª refå¯¹è±¡countèµ‹å€¼ç»™ä¸€ä¸ª reactiveå¯¹è±¡å±æ€§å€¼æ—¶å€™ï¼Œæ­¤refå¯¹è±¡ä¼šè¢«è‡ªåŠ¨è§£åŒ…
      const obj = reactive({}) 
      obj.count = count 
      // è¯¥ ref ä¼šè¢«è‡ªåŠ¨è§£åŒ…
      console.log(obj.count) // 0

      // ä¸€å®šè¦è¿”å›ï¼Œæš´éœ²ç»™é¡µé¢æ¨¡æ¿ä½¿ç”¨
      return {
        count,
        add,
        state,
        increment
      }

    }
  })

  app.mount('#app')
</script>
</html>
```

> ä»¥ååˆ›å»º é å¯¹è±¡ç±»å‹çš„æ•°æ® ä½¿ç”¨  refï¼Œ åˆ›å»ºå¯¹è±¡ç±»å‹çš„æ•°æ®å»ºè®®ä½¿ç”¨ reactive

#### computed ()

æ¥å—ä¸€ä¸ª getter å‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªåªè¯»çš„å“åº”å¼ [ref](https://cn.vuejs.org/api/reactivity-core.html#ref) å¯¹è±¡ã€‚è¯¥ ref é€šè¿‡ `.value` æš´éœ² getter å‡½æ•°çš„è¿”å›å€¼ã€‚å®ƒä¹Ÿå¯ä»¥æ¥å—ä¸€ä¸ªå¸¦æœ‰ `get` å’Œ `set` å‡½æ•°çš„å¯¹è±¡æ¥åˆ›å»ºä¸€ä¸ªå¯å†™çš„ ref å¯¹è±¡ã€‚

åˆ›å»ºä¸€ä¸ªåªè¯»çš„è®¡ç®—å±æ€§ refï¼š

```
const count = ref(1)
const plusOne = computed(() => count.value + 1)

console.log(plusOne.value) // 2

plusOne.value++ // é”™è¯¯
```

åˆ›å»ºä¸€ä¸ªå¯å†™çš„è®¡ç®—å±æ€§ refï¼š

```
const count = ref(1)
const plusOne = computed({
  get: () => count.value + 1,
  set: (val) => {
    count.value = val - 1
  }
})

plusOne.value = 1
console.log(count.value) // 0
```

`composition_computed.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_computed</title>
</head>
<body>
  <div id="app">
    count: <button @click="add">åŠ 1</button>{{ count }} - {{ doubleCount }} - {{ plusOne }}<br />
    <button @click="updateComputed">æ”¹å˜è®¡ç®—å±æ€§çš„å€¼</button>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, computed } = Vue

  const app = createApp({
    setup () {
      // 1.åŸºæœ¬è®¡ç®—å±æ€§ - ä¸€ä¸ªåªè¯»çš„è®¡ç®—å±æ€§ ref
      const count = ref(0)
      const add = () => {
        count.value += 1
      }
      const doubleCount = computed(() => count.value * 2)


      // 2.åˆ›å»ºä¸€ä¸ªå¯å†™çš„è®¡ç®—å±æ€§ refï¼š
      const plusOne = computed({
        get () { return count.value + 1 },
        set (val) { count.value = val - 1 }
      })

      const updateComputed = () => {
        plusOne.value = 100
        console.log('count', count.value) // 99
      }
      return {
        count,
        add,
        doubleCount,
        plusOne,
        updateComputed
      }

    }
  })

  app.mount('#app')
</script>
</html>
```

#### reactive()

è¿”å›ä¸€ä¸ªå¯¹è±¡çš„å“åº”å¼ä»£ç†ã€‚

å“åº”å¼è½¬æ¢æ˜¯â€œæ·±å±‚â€çš„ï¼šå®ƒä¼šå½±å“åˆ°æ‰€æœ‰åµŒå¥—çš„å±æ€§ã€‚ä¸€ä¸ªå“åº”å¼å¯¹è±¡ä¹Ÿå°†æ·±å±‚åœ°è§£åŒ…ä»»ä½• [ref](https://cn.vuejs.org/api/reactivity-core.html#ref) å±æ€§ï¼ŒåŒæ—¶ä¿æŒå“åº”æ€§ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå½“è®¿é—®åˆ°æŸä¸ªå“åº”å¼æ•°ç»„æˆ– `Map` è¿™æ ·çš„åŸç”Ÿé›†åˆç±»å‹ä¸­çš„ ref å…ƒç´ æ—¶ï¼Œä¸ä¼šæ‰§è¡Œ ref çš„è§£åŒ…ã€‚

è¿”å›çš„å¯¹è±¡ä»¥åŠå…¶ä¸­åµŒå¥—çš„å¯¹è±¡éƒ½ä¼šé€šè¿‡ [ES Proxy](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy) åŒ…è£¹ï¼Œå› æ­¤**ä¸ç­‰äº**æºå¯¹è±¡ï¼Œå»ºè®®åªä½¿ç”¨å“åº”å¼ä»£ç†ï¼Œé¿å…ä½¿ç”¨åŸå§‹å¯¹è±¡ã€‚

åˆ›å»ºä¸€ä¸ªå“åº”å¼å¯¹è±¡ï¼š

```
const obj = reactive({ count: 0 })
obj.count++
```

ref çš„è§£åŒ…ï¼š

```
const count = ref(1)
const obj = reactive({ count })

// ref ä¼šè¢«è§£åŒ…
console.log(obj.count === count.value) // true

// ä¼šæ›´æ–° `obj.count`
count.value++
console.log(count.value) // 2
console.log(obj.count) // 2

// ä¹Ÿä¼šæ›´æ–° `count` ref
obj.count++
console.log(obj.count) // 3
console.log(count.value) // 3
```

æ³¨æ„å½“è®¿é—®åˆ°æŸä¸ªå“åº”å¼æ•°ç»„æˆ– `Map` è¿™æ ·çš„åŸç”Ÿé›†åˆç±»å‹ä¸­çš„ ref å…ƒç´ æ—¶ï¼Œ**ä¸ä¼š**æ‰§è¡Œ ref çš„è§£åŒ…ï¼š

```
const books = reactive([ref('Vue 3 Guide')])
// è¿™é‡Œéœ€è¦ .value
console.log(books[0].value)

const map = reactive(new Map([['count', ref(0)]]))
// è¿™é‡Œéœ€è¦ .value
console.log(map.get('count').value)
```

å°†ä¸€ä¸ª [ref](https://cn.vuejs.org/api/reactivity-core.html#ref) èµ‹å€¼ç»™ä¸ºä¸€ä¸ª `reactive` å±æ€§å€¼æ—¶ï¼Œè¯¥ ref ä¼šè¢«è‡ªåŠ¨è§£åŒ…ï¼šï¼ˆè®²è§£refæ—¶å·²ç»è¯´æ˜ï¼‰

```
const count = ref(1)
const obj = reactive({count})


console.log(obj.count) // 1
console.log(obj.count === count.value) // true
```

`composition__reactive.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_reactive</title>
</head>
<body>
  <div id="app">
    state.count: <button @click="add">åŠ 1</button>{{ state.count }}<br />
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, reactive } = Vue

  const app = createApp({
    setup () {
      const state = reactive({ count: 10})
      const add = () => {
        state.count++
      }

      // refçš„è§£åŒ…
      const count = ref(1)
      const obj = reactive({ count })
      console.log(count.value === obj.count) // true

      count.value++
      console.log(count.value) // 2
      console.log(obj.count) // 2

      obj.count++
      console.log(count.value) // 3
      console.log(obj.count) // 3

      // æ³¨æ„å½“è®¿é—®åˆ°æŸä¸ªå“åº”å¼æ•°ç»„æˆ– `Map` è¿™æ ·çš„åŸç”Ÿé›†åˆç±»å‹ä¸­çš„ ref å…ƒç´ æ—¶ï¼Œä¸ä¼šæ‰§è¡Œ ref çš„è§£åŒ…
      const books = reactive([ref('vue3 æŒ‡å—')])
      console.log(books[0].value) // vue3 æŒ‡å—
      const map = reactive(new Map([['count', ref(0)]]))
      console.log(map.get('count').value) // 0
      
      return {
        state,
        add
      }

    }
  })

  app.mount('#app')
</script>
</html>
```

>  å¯¹è±¡å“åº”å¼å¤„ç†å€ŸåŠ©reactive  å…¶ä½™çš„ç”¨ref

#### readonly()

æ¥å—ä¸€ä¸ªå¯¹è±¡ (ä¸è®ºæ˜¯å“åº”å¼è¿˜æ˜¯æ™®é€šçš„) æˆ–æ˜¯ä¸€ä¸ª [ref](https://cn.vuejs.org/api/reactivity-core.html#ref)ï¼Œè¿”å›ä¸€ä¸ªåŸå€¼çš„åªè¯»ä»£ç†ã€‚

åªè¯»ä»£ç†æ˜¯æ·±å±‚çš„ï¼šå¯¹ä»»ä½•åµŒå¥—å±æ€§çš„è®¿é—®éƒ½å°†æ˜¯åªè¯»çš„ã€‚å®ƒçš„ ref è§£åŒ…è¡Œä¸ºä¸ `reactive()` ç›¸åŒï¼Œä½†è§£åŒ…å¾—åˆ°çš„å€¼æ˜¯åªè¯»çš„ã€‚

```
const original = reactive({ count: 0 })

const copy = readonly(original)

watchEffect(() => {
  // ç”¨æ¥åšå“åº”æ€§è¿½è¸ª
  console.log(copy.count)
})

// æ›´æ”¹æºå±æ€§ä¼šè§¦å‘å…¶ä¾èµ–çš„ä¾¦å¬å™¨
original.count++

// æ›´æ”¹è¯¥åªè¯»å‰¯æœ¬å°†ä¼šå¤±è´¥ï¼Œå¹¶ä¼šå¾—åˆ°ä¸€ä¸ªè­¦å‘Š
copy.count++ // warning
```



`composition_readonly.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_readonly</title>
</head>
<body>
  <div id="app">
    {{ count }} <button @click="addCount">ä¿®æ”¹count</button> <br />
    {{ copy }} <button @click="addCopy">ä¿®æ”¹copy</button>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, reactive, readonly } = Vue

  const app = createApp({
    setup () {
      const count = ref(10)
      const addCount = () => {
        count.value += 1
      }
      const copy = readonly(count)
      const addCopy = () => { // Set operation on key "value" failed: target is readonly. 
        copy.value += 1
      }
      return {
        count,
        addCount,
        copy,
        addCopy
      }
    }
  })

  app.mount('#app')
</script>
</html>
```



#### watchEffect()

ç«‹å³è¿è¡Œä¸€ä¸ªå‡½æ•°ï¼ŒåŒæ—¶å“åº”å¼åœ°è¿½è¸ªå…¶ä¾èµ–ï¼Œå¹¶åœ¨ä¾èµ–æ›´æ”¹æ—¶é‡æ–°æ‰§è¡Œã€‚

ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯è¦è¿è¡Œçš„å‰¯ä½œç”¨å‡½æ•°ã€‚è¿™ä¸ªå‰¯ä½œç”¨å‡½æ•°çš„å‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œç”¨æ¥æ³¨å†Œæ¸…ç†å›è°ƒã€‚æ¸…ç†å›è°ƒä¼šåœ¨è¯¥å‰¯ä½œç”¨ä¸‹ä¸€æ¬¡æ‰§è¡Œå‰è¢«è°ƒç”¨ï¼Œå¯ä»¥ç”¨æ¥æ¸…ç†æ— æ•ˆçš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ç­‰å¾…ä¸­çš„å¼‚æ­¥è¯·æ±‚ã€‚

è¿”å›å€¼æ˜¯ä¸€ä¸ªç”¨æ¥åœæ­¢è¯¥å‰¯ä½œç”¨çš„å‡½æ•°ã€‚

```
const count = ref(0)

watchEffect(() => console.log(count.value))
// -> è¾“å‡º 0

count.value++
// -> è¾“å‡º 1
```

å‰¯ä½œç”¨æ¸…é™¤ï¼š

```js
watchEffect((onInvalidate) => {
    console.log(id.value) 
    const timer = setTimeout(() => {
        console.log('è¯·æ±‚æˆåŠŸ') // 2ç§’ä¹‹å†…ç‚¹å‡»åˆ—è¡¨ åªæ˜¾ç¤ºä¸€æ¬¡
        data.value = 'æ•°æ®' + id.value
    }, 2000)
    onInvalidate(() => {
        clearTimeout(timer)
    })
})
```

åœæ­¢ä¾¦å¬å™¨ï¼š

```js
 const stop = watchEffect(() => {
     console.log(count.value)
 })
 // å½“ä¸å†éœ€è¦æ­¤ä¾¦å¬å™¨æ—¶:
 const stopWatch = () => {
     stop()
 }
```

`composition_watchEffect.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_watchEffect</title>
</head>
<body>
  <div id="app">
    <button @click="increment">ç‚¹å‡»äº†{{ count }}æ¬¡</button>
    <button @click="stopWatch">åœæ­¢ç›‘å¬</button>
    <ul>
      <li @click="id=1">è¯·æ±‚ç¬¬ä¸€æ¡æ•°æ®</li>
      <li @click="id=2">è¯·æ±‚ç¬¬äºŒæ¡æ•°æ®</li>
    </ul>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, watchEffect } = Vue

  const app = createApp({
    setup () {
      const count = ref(0)
      const increment = () => {
        count.value = 1
      }

      const stop = watchEffect(() => {
        console.log(`ç›‘å¬åˆ°countçš„æ•°æ®ä¸º${count.value}`)
      })
      // åœæ­¢ç›‘å¬åï¼Œå½“ä¾èµ–é¡¹countå‘ç”Ÿæ”¹å˜äº†ï¼Œä¹Ÿä¸ä¼šè§¦å‘äº†
      const stopWatch = () => {
        stop()
      }
      
      const id = ref(1)
      watchEffect((onInvalidate) => {
        console.log(id.value) 
        const timer = setTimeout(() => {
          console.log(`è¯·æ±‚ç¬¬${id.value}æ¡æ•°æ®`)
        }, 3000)
        onInvalidate(() => { // å½“idæ”¹å˜çš„æ—¶å€™ï¼Œæ­¤å›è°ƒå°±ä¼šæ‰§è¡Œï¼Œå¯ä»¥æ¸…é™¤ä¸Šä¸€æ¬¡çš„timer
          console.log('æ¸…é™¤')
          clearTimeout(timer)
        })
      })
      return {
        count,
        increment,
        stopWatch,
        id
      }
    }
  })

  app.mount('#app')
</script>
</html>
```

> watchEffectæ²¡æœ‰å…·ä½“ç›‘å¬å“ªä¸€ä¸ªå€¼çš„å˜åŒ–ï¼Œåªè¦å†…éƒ¨æœ‰æŸä¸€ä¸ªçŠ¶æ€å‘ç”Ÿæ”¹å˜å°±ä¼šæ‰§è¡Œ

#### watch()

ä¾¦å¬ä¸€ä¸ªæˆ–å¤šä¸ªå“åº”å¼æ•°æ®æºï¼Œå¹¶åœ¨æ•°æ®æºå˜åŒ–æ—¶è°ƒç”¨æ‰€ç»™çš„å›è°ƒå‡½æ•°ã€‚

- `watch()` é»˜è®¤æ˜¯æ‡’ä¾¦å¬çš„ï¼Œå³ä»…åœ¨ä¾¦å¬æºå‘ç”Ÿå˜åŒ–æ—¶æ‰æ‰§è¡Œå›è°ƒå‡½æ•°ã€‚

  ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ä¾¦å¬å™¨çš„**æº**ã€‚è¿™ä¸ªæ¥æºå¯ä»¥æ˜¯ä»¥ä¸‹å‡ ç§ï¼š

  - ä¸€ä¸ªå‡½æ•°ï¼Œè¿”å›ä¸€ä¸ªå€¼
  - ä¸€ä¸ª ref
  - ä¸€ä¸ªå“åº”å¼å¯¹è±¡
  - ...æˆ–æ˜¯ç”±ä»¥ä¸Šç±»å‹çš„å€¼ç»„æˆçš„æ•°ç»„

  ç¬¬äºŒä¸ªå‚æ•°æ˜¯åœ¨å‘ç”Ÿå˜åŒ–æ—¶è¦è°ƒç”¨çš„å›è°ƒå‡½æ•°ã€‚è¿™ä¸ªå›è°ƒå‡½æ•°æ¥å—ä¸‰ä¸ªå‚æ•°ï¼šæ–°å€¼ã€æ—§å€¼ï¼Œä»¥åŠä¸€ä¸ªç”¨äºæ³¨å†Œå‰¯ä½œç”¨æ¸…ç†çš„å›è°ƒå‡½æ•°ã€‚è¯¥å›è°ƒå‡½æ•°ä¼šåœ¨å‰¯ä½œç”¨ä¸‹ä¸€æ¬¡é‡æ–°æ‰§è¡Œå‰è°ƒç”¨ï¼Œå¯ä»¥ç”¨æ¥æ¸…é™¤æ— æ•ˆçš„å‰¯ä½œç”¨ï¼Œä¾‹å¦‚ç­‰å¾…ä¸­çš„å¼‚æ­¥è¯·æ±‚ã€‚

  å½“ä¾¦å¬å¤šä¸ªæ¥æºæ—¶ï¼Œå›è°ƒå‡½æ•°æ¥å—ä¸¤ä¸ªæ•°ç»„ï¼Œåˆ†åˆ«å¯¹åº”æ¥æºæ•°ç»„ä¸­çš„æ–°å€¼å’Œæ—§å€¼ã€‚

  ç¬¬ä¸‰ä¸ªå¯é€‰çš„å‚æ•°æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæ”¯æŒä»¥ä¸‹è¿™äº›é€‰é¡¹ï¼š

  - **`immediate`**ï¼šåœ¨ä¾¦å¬å™¨åˆ›å»ºæ—¶ç«‹å³è§¦å‘å›è°ƒã€‚ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶æ—§å€¼æ˜¯ `undefined`ã€‚
  - **`deep`**ï¼šå¦‚æœæºæ˜¯å¯¹è±¡ï¼Œå¼ºåˆ¶æ·±åº¦éå†ï¼Œä»¥ä¾¿åœ¨æ·±å±‚çº§å˜æ›´æ—¶è§¦å‘å›è°ƒã€‚å‚è€ƒ[æ·±å±‚ä¾¦å¬å™¨](https://cn.vuejs.org/guide/essentials/watchers.html#deep-watchers)ã€‚

  ä¸ [`watchEffect()`](https://cn.vuejs.org/api/reactivity-core.html#watcheffect) ç›¸æ¯”ï¼Œ`watch()` ä½¿æˆ‘ä»¬å¯ä»¥ï¼š

  - æ‡’æ‰§è¡Œå‰¯ä½œç”¨ï¼›
  - æ›´åŠ æ˜ç¡®æ˜¯åº”è¯¥ç”±å“ªä¸ªçŠ¶æ€è§¦å‘ä¾¦å¬å™¨é‡æ–°æ‰§è¡Œï¼›
  - å¯ä»¥è®¿é—®æ‰€ä¾¦å¬çŠ¶æ€çš„å‰ä¸€ä¸ªå€¼å’Œå½“å‰å€¼ã€‚

- **ç¤ºä¾‹**

  ä¾¦å¬ä¸€ä¸ª getter å‡½æ•°ï¼š

  ```
  const state = reactive({ count: 0 })
  watch(
    () => state.count,
    (count, prevCount) => {
      /* ... */
    }
  )
  ```

  ä¾¦å¬ä¸€ä¸ª refï¼š

  ```
  const count = ref(0)
  watch(count, (count, prevCount) => {
    /* ... */
  })
  ```

  å½“ä¾¦å¬å¤šä¸ªæ¥æºæ—¶ï¼Œå›è°ƒå‡½æ•°æ¥å—ä¸¤ä¸ªæ•°ç»„ï¼Œåˆ†åˆ«å¯¹åº”æ¥æºæ•°ç»„ä¸­çš„æ–°å€¼å’Œæ—§å€¼ï¼š

  ```
  watch([fooRef, barRef], ([foo, bar], [prevFoo, prevBar]) => {
    /* ... */
  })
  ```

  å½“ä½¿ç”¨ getter å‡½æ•°ä½œä¸ºæºæ—¶ï¼Œå›è°ƒåªåœ¨æ­¤å‡½æ•°çš„è¿”å›å€¼å˜åŒ–æ—¶æ‰ä¼šè§¦å‘ã€‚å¦‚æœä½ æƒ³è®©å›è°ƒåœ¨æ·±å±‚çº§å˜æ›´æ—¶ä¹Ÿèƒ½è§¦å‘ï¼Œä½ éœ€è¦ä½¿ç”¨ `{ deep: true }` å¼ºåˆ¶ä¾¦å¬å™¨è¿›å…¥æ·±å±‚çº§æ¨¡å¼ã€‚åœ¨æ·±å±‚çº§æ¨¡å¼æ—¶ï¼Œå¦‚æœå›è°ƒå‡½æ•°ç”±äºæ·±å±‚çº§çš„å˜æ›´è€Œè¢«è§¦å‘ï¼Œé‚£ä¹ˆæ–°å€¼å’Œæ—§å€¼å°†æ˜¯åŒä¸€ä¸ªå¯¹è±¡ã€‚

  ```
  const state = reactive({ count: 0 })
  watch(
    () => state,
    (newValue, oldValue) => {
      // newValue === oldValue
    },
    { deep: true }
  )
  ```

  å½“ç›´æ¥ä¾¦å¬ä¸€ä¸ªå“åº”å¼å¯¹è±¡æ—¶ï¼Œä¾¦å¬å™¨ä¼šè‡ªåŠ¨å¯ç”¨æ·±å±‚æ¨¡å¼ï¼š

  ```
  const state = reactive({ count: 0 })
  watch(state, () => {
    /* æ·±å±‚çº§å˜æ›´çŠ¶æ€æ‰€è§¦å‘çš„å›è°ƒ */
  })
  ```

`composition_watch.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_watch</title>
</head>
<body>
  <div id="app">
    <button @click="increment">ç‚¹å‡»äº†{{ count }}æ¬¡</button>
    <button @click="foo='foo!!!'">æ”¹å˜foo</button>
    <button @click="bar='bar!!!'">æ”¹å˜bar</button>
    <button @click="state.obj.a=100">æ”¹å˜state</button>{{ state.obj.a }}

  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, watch, reactive } = Vue

  const app = createApp({
    setup () {
      const count = ref(0)
      const increment = () => {
        count.value += 1
      }
      // å‡½æ•°ä½œä¸ºç›‘å¬æº --- è¦çš„æ˜¯é‚£ä¸ªæ•°æ® -- éœ€è¦value
      // watch(()=>count.value, (val, oldVal) => {
      //   console.log('fn', val, oldVal)
      // })

      // ä¾¦å¬ref ä¸è¦å†™value
      // watch(count, (val, oldVal) => {
      //   console.log('ref', val, oldVal)
      // })

      // ä¾¦å¬å¤šä¸ªæ¥æº
      const foo = ref('foo')
      const bar = ref('bar')
      // watch([foo, bar], ([foo, bar], [oldFoo, oldBar]) => {
      //   console.log('f', foo, oldFoo)
      //   console.log('b', bar, oldBar)
      // })

      // ä¾¦å¬æºä¸ºå‡½æ•°ï¼Œä¸ä¼šå¼€å¯æ·±åº¦ä¾¦å¬
      const state = reactive({ obj: { a: 10 } })
  
      // ä¾¦å¬æºä¸ºå‡½æ•°,ç›‘å¬å…·ä½“æŸä¸ªæ•°æ®çš„å˜åŒ–
      // watch(()=>state.obj.a,(val,oldVal)=>{
      //   console.log(val,oldVal)
      // },{immediate:true})


      // ç›´æ¥ä¾¦å¬ä¸€ä¸ªå“åº”å¼å¯¹è±¡æ—¶,è‡ªåŠ¨å¼€å¯æ·±åº¦ä¾¦å¬
      // watch(state, (val, oldVal) => {
      //   console.log('auto', val, oldVal)
      // }, {
      //   immediate: true // æ­¤å¤„ä¸éœ€è¦å†™ deep: true
      // } )

      // æ— æ³•æ·±åº¦ä¾¦å¬
      // watch(() => state, (val, oldVal) => {
      //   console.log('s', val, oldVal)
      // } )
      // watch(() => state, (val, oldVal) => {
      //   console.log('d', val, oldVal)
      // }, {
      //   deep: true,
      //   immediate: true
      // } )
      return {
        count,
        increment,
        foo,
        bar,
        state
      }

    }
  })

  app.mount('#app')
</script>
</html>
```



### 18.4ã€å·¥å…·å‡½æ•°

#### toRef()

åŸºäºå“åº”å¼å¯¹è±¡ä¸Šçš„ä¸€ä¸ªå±æ€§ï¼Œåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ refã€‚è¿™æ ·åˆ›å»ºçš„ ref ä¸å…¶æºå±æ€§ä¿æŒåŒæ­¥ï¼šæ”¹å˜æºå±æ€§çš„å€¼å°†æ›´æ–° ref çš„å€¼ï¼Œåä¹‹äº¦ç„¶ã€‚

`composition_toRef.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_toRef</title>
</head>
<body>
  <div id="app">
    
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, toRef, reactive } = Vue

  const app = createApp({
    setup () {
      // åŸºäºå“åº”å¼å¯¹è±¡ä¸Šçš„ä¸€ä¸ªå±æ€§ï¼Œåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ refã€‚
      // è¿™æ ·åˆ›å»ºçš„ ref ä¸å…¶æºå±æ€§ä¿æŒåŒæ­¥ï¼šæ”¹å˜æºå±æ€§çš„å€¼å°†æ›´æ–° ref çš„å€¼ï¼Œåä¹‹äº¦ç„¶ã€‚
      const state = reactive({
        foo: 1,
        bar: 2
      })

      const count = toRef(state, 'foo')

      console.log(count.value) // 1

      count.value++
      console.log(state.foo) // 2
      console.log(count.value) // 2

      state.foo++
      console.log(state.foo) // 3
      console.log(count.value) // 3
    }
  })

  app.mount('#app')
</script>
</html>
```

#### toRefs()

å°†ä¸€ä¸ªå“åº”å¼å¯¹è±¡è½¬æ¢ä¸ºä¸€ä¸ªæ™®é€šå¯¹è±¡ï¼Œè¿™ä¸ªæ™®é€šå¯¹è±¡çš„æ¯ä¸ªå±æ€§éƒ½æ˜¯æŒ‡å‘æºå¯¹è±¡ç›¸åº”å±æ€§çš„ refã€‚æ¯ä¸ªå•ç‹¬çš„ ref éƒ½æ˜¯ä½¿ç”¨ [`toRef()`](https://cn.vuejs.org/api/reactivity-utilities.html#toref) åˆ›å»ºçš„ã€‚

`composition_toRefs.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_toRefs</title>
</head>
<body>
  <div id="app">
    
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, toRefs, reactive } = Vue

  const app = createApp({
    setup () {
      // åŸºäºå“åº”å¼å¯¹è±¡ä¸Šçš„ä¸€ä¸ªå±æ€§ï¼Œåˆ›å»ºä¸€ä¸ªå¯¹åº”çš„ refã€‚
      // è¿™æ ·åˆ›å»ºçš„ ref ä¸å…¶æºå±æ€§ä¿æŒåŒæ­¥ï¼šæ”¹å˜æºå±æ€§çš„å€¼å°†æ›´æ–° ref çš„å€¼ï¼Œåä¹‹äº¦ç„¶ã€‚
      const state = reactive({
        foo: 1,
        bar: 2
      })

      const newState = toRefs(state)

      console.log(newState.foo.value) // 1

      newState.foo.value ++

      console.log(newState.foo.value) // 2
      console.log(state.foo) // 2

      state.foo++
      console.log(newState.foo.value) // 3
      console.log(state.foo) // 3
    }
  })

  app.mount('#app')
</script>
</html>
```



> `toRefs` åœ¨è°ƒç”¨æ—¶åªä¼šä¸ºæºå¯¹è±¡ä¸Šå¯ä»¥æšä¸¾çš„å±æ€§åˆ›å»º refã€‚å¦‚æœè¦ä¸ºå¯èƒ½è¿˜ä¸å­˜åœ¨çš„å±æ€§åˆ›å»º refï¼Œè¯·æ”¹ç”¨ [`toRef`](https://cn.vuejs.org/api/reactivity-utilities.html#toref)ã€‚



### 18.5ã€ç”Ÿå‘½å‘¨æœŸé’©å­

#### onBeforeMount()

æ³¨å†Œä¸€ä¸ªé’©å­ï¼Œåœ¨ç»„ä»¶è¢«æŒ‚è½½ä¹‹å‰è¢«è°ƒç”¨ã€‚

å½“è¿™ä¸ªé’©å­è¢«è°ƒç”¨æ—¶ï¼Œç»„ä»¶å·²ç»å®Œæˆäº†å…¶å“åº”å¼çŠ¶æ€çš„è®¾ç½®ï¼Œä½†è¿˜æ²¡æœ‰åˆ›å»º DOM èŠ‚ç‚¹ã€‚å®ƒå³å°†é¦–æ¬¡æ‰§è¡Œ DOM æ¸²æŸ“è¿‡ç¨‹ã€‚

#### onMounted()

æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨ç»„ä»¶æŒ‚è½½å®Œæˆåæ‰§è¡Œã€‚

#### onBeforeUpdate()

æ³¨å†Œä¸€ä¸ªé’©å­ï¼Œåœ¨ç»„ä»¶å³å°†å› ä¸ºå“åº”å¼çŠ¶æ€å˜æ›´è€Œæ›´æ–°å…¶ DOM æ ‘ä¹‹å‰è°ƒç”¨ã€‚

è¿™ä¸ªé’©å­å¯ä»¥ç”¨æ¥åœ¨ Vue æ›´æ–° DOM ä¹‹å‰è®¿é—® DOM çŠ¶æ€ã€‚åœ¨è¿™ä¸ªé’©å­ä¸­æ›´æ”¹çŠ¶æ€ä¹Ÿæ˜¯å®‰å…¨çš„ã€‚

#### onUpdated()

æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨ç»„ä»¶å› ä¸ºå“åº”å¼çŠ¶æ€å˜æ›´è€Œæ›´æ–°å…¶ DOM æ ‘ä¹‹åè°ƒç”¨ã€‚

çˆ¶ç»„ä»¶çš„æ›´æ–°é’©å­å°†åœ¨å…¶å­ç»„ä»¶çš„æ›´æ–°é’©å­ä¹‹åè°ƒç”¨ã€‚

è¿™ä¸ªé’©å­ä¼šåœ¨ç»„ä»¶çš„ä»»æ„ DOM æ›´æ–°åè¢«è°ƒç”¨ï¼Œè¿™äº›æ›´æ–°å¯èƒ½æ˜¯ç”±ä¸åŒçš„çŠ¶æ€å˜æ›´å¯¼è‡´çš„ã€‚å¦‚æœä½ éœ€è¦åœ¨æŸä¸ªç‰¹å®šçš„çŠ¶æ€æ›´æ”¹åè®¿é—®æ›´æ–°åçš„ DOMï¼Œè¯·ä½¿ç”¨ [nextTick()](https://cn.vuejs.org/api/general.html#nexttick) ä½œä¸ºæ›¿ä»£ã€‚

#### onBeforeUnmount()

æ³¨å†Œä¸€ä¸ªé’©å­ï¼Œåœ¨ç»„ä»¶å®ä¾‹è¢«å¸è½½ä¹‹å‰è°ƒç”¨ã€‚

å½“è¿™ä¸ªé’©å­è¢«è°ƒç”¨æ—¶ï¼Œç»„ä»¶å®ä¾‹ä¾ç„¶è¿˜ä¿æœ‰å…¨éƒ¨çš„åŠŸèƒ½ã€‚

#### onUnmounted()

æ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œåœ¨ç»„ä»¶å®ä¾‹è¢«å¸è½½ä¹‹åè°ƒç”¨ã€‚

ä¸€ä¸ªç»„ä»¶åœ¨ä»¥ä¸‹æƒ…å†µä¸‹è¢«è§†ä¸ºå·²å¸è½½ï¼š

- å…¶æ‰€æœ‰å­ç»„ä»¶éƒ½å·²ç»è¢«å¸è½½ã€‚
- æ‰€æœ‰ç›¸å…³çš„å“åº”å¼ä½œç”¨ (æ¸²æŸ“ä½œç”¨ä»¥åŠ `setup()` æ—¶åˆ›å»ºçš„è®¡ç®—å±æ€§å’Œä¾¦å¬å™¨) éƒ½å·²ç»åœæ­¢ã€‚

å¯ä»¥åœ¨è¿™ä¸ªé’©å­ä¸­æ‰‹åŠ¨æ¸…ç†ä¸€äº›å‰¯ä½œç”¨ï¼Œä¾‹å¦‚è®¡æ—¶å™¨ã€DOM äº‹ä»¶ç›‘å¬å™¨æˆ–è€…ä¸æœåŠ¡å™¨çš„è¿æ¥ã€‚



`composition_lifeCycle.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_lifeCycle</title>
</head>
<body>
  <div id="app">
    {{ count }}
    <button @click="add">åŠ 1</button>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { 
    createApp, 
    ref,
    onBeforeMount,
    onMounted,
    onBeforeUpdate,
    onUpdated,
    onBeforeUnmount,
    onUnmounted
  } = Vue
  
  const app = createApp({
    setup () {
      const count = ref(0)
      const add = () => {
        count.value += 1
        if (count.value === 5) {
          app.unmount()
        }
      }
      onBeforeMount(() => {
        console.log('onBeforeMount')
      })
      onMounted(() => {
        // DOMæ“ä½œã€æ•°æ®è¯·æ±‚ã€å®ä¾‹åŒ–ã€è®¡æ—¶å™¨ã€å»¶æ—¶å™¨ã€è®¢é˜…æ•°æ®
        console.log('onMounted')
      })
      onBeforeUpdate(() => {
        console.log('onBeforeUpdate')
      })
      onUpdated(() => {
        console.log('onUpdated')
      })
      onBeforeUnmount(() => {
        // å–æ¶ˆè®¢é˜…ï¼Œæ¸…é™¤è®¡æ—¶å™¨ã€å»¶æ—¶å™¨ç­‰
        console.log('onBeforeUnmount')
      })
      onUnmounted(() => {
        console.log('onUnmounted')
      })

      return {
        count,
        add
      }
    }
  })
  
  app.mount('#app')
</script>
</html>
```



### 18.6ã€ä¾èµ–æ³¨å…¥

#### provide()

æä¾›ä¸€ä¸ªå€¼ï¼Œå¯ä»¥è¢«åä»£ç»„ä»¶æ³¨å…¥ã€‚

`provide()` æ¥å—ä¸¤ä¸ªå‚æ•°ï¼šç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¦æ³¨å…¥çš„ keyï¼Œå¯ä»¥æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–è€…ä¸€ä¸ª symbolï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯è¦æ³¨å…¥çš„å€¼ã€‚

#### inject()

é»˜è®¤æƒ…å†µä¸‹ï¼Œ`inject` å‡è®¾ä¼ å…¥çš„æ³¨å…¥åä¼šè¢«æŸä¸ªç¥–å…ˆé“¾ä¸Šçš„ç»„ä»¶æä¾›ã€‚å¦‚æœè¯¥æ³¨å…¥åçš„ç¡®æ²¡æœ‰ä»»ä½•ç»„ä»¶æä¾›ï¼Œåˆ™ä¼šæŠ›å‡ºä¸€ä¸ªè¿è¡Œæ—¶è­¦å‘Šã€‚

å¦‚æœåœ¨æ³¨å…¥ä¸€ä¸ªå€¼æ—¶ä¸è¦æ±‚å¿…é¡»æœ‰æä¾›è€…ï¼Œé‚£ä¹ˆæˆ‘ä»¬åº”è¯¥å£°æ˜ä¸€ä¸ªé»˜è®¤å€¼ï¼Œå’Œ props ç±»ä¼¼

`composition_provide_inject.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_provide_inject</title>
</head>
<body>
  <div id="app">
    <my-parent></my-parent>
  </div>
</body>
<template id="parent">
  <div>
    æˆ‘æ˜¯çˆ¶ç»„ä»¶ - {{ count }}
    <my-child></my-child>
  </div>
</template>
<template id="child">
  <div>
    æˆ‘æ˜¯å­ç»„ä»¶ <button @click="add">åŠ 10</button> {{ test }}
  </div>
</template>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, provide, inject } = Vue
  const Child = {
    template: '#child',
    setup () {
      // æ³¨å…¥å€¼çš„é»˜è®¤æ–¹å¼
      const add = inject('add')
      // è®¾ç½®æ³¨å…¥çš„é»˜è®¤å€¼
      const test = inject('test', 'æµ‹è¯•')
      return {
        add,
        test
      }
    }
  }
  const Parent = {
    template: '#parent',
    components: {
      myChild: Child
    },
    setup () {
      const count = inject('count')
      return {
        count
      }
    }
  }
  const app = createApp({
    components: {
      myParent: Parent
    },
    setup () {
      const count = ref(10)
      const add = () => {
        count.value += 10
      }
      // æä¾›å€¼ï¼Œå¯ä»¥æ˜¯æ•°æ®ï¼Œä¹Ÿå¯ä»¥æ˜¯å‡½æ•°
      provide('count', count)
      provide('add', add)
    }
  })

  app.mount('#app')
</script>
</html>
```



### 18.7ã€ç»„åˆå¼å‡½æ•°

#### ä»€ä¹ˆæ˜¯â€œç»„åˆå¼å‡½æ•°â€ï¼Ÿ

åœ¨ Vue åº”ç”¨çš„æ¦‚å¿µä¸­ï¼Œâ€œç»„åˆå¼å‡½æ•°â€(Composables) æ˜¯ä¸€ä¸ªåˆ©ç”¨ Vue çš„ç»„åˆå¼ API æ¥å°è£…å’Œå¤ç”¨**æœ‰çŠ¶æ€é€»è¾‘**çš„å‡½æ•°ã€‚

> ä¹Ÿå¯ä»¥å«åšè‡ªå®šä¹‰hooks

å½“æ„å»ºå‰ç«¯åº”ç”¨æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å¤ç”¨å…¬å…±ä¸šåŠ¡çš„é€»è¾‘ã€‚ä¸€ä¸ªç®€å•çš„ä¾‹å­æ˜¯è·Ÿè¸ªå½“å‰é¼ æ ‡åœ¨é¡µé¢ä¸­çš„ä½ç½®ã€‚åœ¨å®é™…åº”ç”¨ä¸­ï¼Œä¹Ÿå¯èƒ½æ˜¯åƒè§¦æ‘¸æ‰‹åŠ¿æˆ–ä¸æ•°æ®åº“çš„è¿æ¥çŠ¶æ€è¿™æ ·çš„æ›´å¤æ‚çš„é€»è¾‘ã€‚

å¦‚æœæˆ‘ä»¬è¦ç›´æ¥åœ¨ç»„ä»¶ä¸­ä½¿ç”¨ç»„åˆå¼ API å®ç°é¼ æ ‡è·Ÿè¸ªåŠŸèƒ½ï¼Œå®ƒä¼šæ˜¯è¿™æ ·çš„

`composition_mouse.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_mouse</title>
</head>
<body>
  <div id="app">
    é¼ æ ‡çš„ä½ç½®ä¸ºï¼š({{ x }}, {{ y }})
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, onMounted, onUnmounted } = Vue
  const app = createApp({
    setup () {
      const x = ref(0)
      const y = ref(0)
      function updatePosition (event) {
        x.value = event.pageX
        y.value = event.pageY
      }
      onMounted(() => {
        window.addEventListener('mousemove', updatePosition)
      }) 
      onUnmounted(() => {
        window.removeEventListener('mousemove', updatePosition)
      })
      return {
        x, y
      }
    }
  })

  app.mount('#app')
</script>
</html>
```

> ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³åœ¨å¤šä¸ªç»„ä»¶ä¸­å¤ç”¨è¿™ä¸ªç›¸åŒçš„é€»è¾‘å‘¢ï¼Ÿæˆ‘ä»¬å¯ä»¥æŠŠè¿™ä¸ªé€»è¾‘ä»¥ä¸€ä¸ªç»„åˆå¼å‡½æ•°çš„å½¢å¼æå–åˆ°å¤–éƒ¨æ–‡ä»¶ä¸­

#### å¦‚ä½•å®šä¹‰å’Œä½¿ç”¨ç»„åˆå¼å‡½æ•°

`composition_mouse_hooks.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_mouse_hooks</title>
</head>
<body>
  <div id="app">
    é¼ æ ‡çš„ä½ç½®ä¸ºï¼š({{ x }}, {{ y }})
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, onMounted, onUnmounted } = Vue
  function useMouse () {
    const x = ref(0)
    const y = ref(0)
    function updatePosition (event) {
      x.value = event.pageX
      y.value = event.pageY
    }
    onMounted(() => {
      window.addEventListener('mousemove', updatePosition)
    }) 
    onUnmounted(() => {
      window.removeEventListener('mousemove', updatePosition)
    })
    return { x, y }
  }
    
  const app = createApp({
    setup () {
      const { x, y } = useMouse()
      return {
        x, y
      }
    }
  })

  app.mount('#app')
</script>
</html>
```

å¦‚ä½ æ‰€è§ï¼Œæ ¸å¿ƒé€»è¾‘å®Œå…¨ä¸€è‡´ï¼Œæˆ‘ä»¬åšçš„åªæ˜¯æŠŠå®ƒç§»åˆ°ä¸€ä¸ªå¤–éƒ¨å‡½æ•°ä¸­å»ï¼Œå¹¶è¿”å›éœ€è¦æš´éœ²çš„çŠ¶æ€ã€‚å’Œåœ¨ç»„ä»¶ä¸­ä¸€æ ·ï¼Œä½ ä¹Ÿå¯ä»¥åœ¨ç»„åˆå¼å‡½æ•°ä¸­ä½¿ç”¨æ‰€æœ‰çš„[ç»„åˆå¼ API](https://cn.vuejs.org/api/#composition-api)ã€‚ç°åœ¨ï¼Œ`useMouse()` çš„åŠŸèƒ½å¯ä»¥åœ¨ä»»ä½•ç»„ä»¶ä¸­è½»æ˜“å¤ç”¨äº†ã€‚

æ›´é…·çš„æ˜¯ï¼Œä½ è¿˜å¯ä»¥åµŒå¥—å¤šä¸ªç»„åˆå¼å‡½æ•°ï¼š**ä¸€ä¸ªç»„åˆå¼å‡½æ•°å¯ä»¥è°ƒç”¨ä¸€ä¸ªæˆ–å¤šä¸ªå…¶ä»–çš„ç»„åˆå¼å‡½æ•°**ã€‚

`composition_mouse_more_hooks.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_mouse_more_hooks</title>
</head>
<body>
  <div id="app">
    é¼ æ ‡çš„ä½ç½®ä¸ºï¼š({{ x }}, {{ y }})
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, onMounted, onUnmounted } = Vue
  function useEventListener (target, event, callback) {
    onMounted(() => {
      target.addEventListener(event, callback)
    }) 
    onUnmounted(() => {
      target.removeEventListener(event, callback)
    })
  }

  function useMouse () {
    const x = ref(0)
    const y = ref(0)
    // function updatePosition (event) {
    //   x.value = event.pageX
    //   y.value = event.pageY
    // }
    // è°ƒç”¨å¦å¤–ä¸€ä¸ªå¸¦ä¸‰ä¸ªå‚æ•°çš„ç»„åˆå¼å‡½æ•°useEventListener
    useEventListener(window, 'mousemove', (event) => {
      x.value = event.pageX
      y.value = event.pageY
    })
    return { x, y }
  }
  const app = createApp({
    setup () {
      const { x, y } = useMouse()
      return {
        x, y
      }
    }
  })

  app.mount('#app')
</script>
</html>
```

#### å¼‚æ­¥çŠ¶æ€

åœ¨åšå¼‚æ­¥æ•°æ®è¯·æ±‚æ—¶ï¼Œæˆ‘ä»¬å¸¸å¸¸éœ€è¦å¤„ç†ä¸åŒçš„çŠ¶æ€ï¼šåŠ è½½ä¸­ã€åŠ è½½æˆåŠŸå’ŒåŠ è½½å¤±è´¥ã€‚

`composition_async.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_async</title>
</head>
<body>
  <div id="app">
    <div v-if="error">{{ error }}</div>
    <div v-else-if="data">
      <ul>
        <li v-for="item of data" :key="item.proid">{{ item.proname }}</li>
      </ul>
    </div>
    <div v-else>åŠ è½½ä¸­....</div>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, onMounted } = Vue

  const app = createApp({
    setup () { 
      const data = ref(null)
      const error = ref(null)
      // æ¥å£æ–‡æ¡£ http://121.89.205.189:3001/apidoc/#api-Pro-GetProList
      fetch('http://121.89.205.189:3001/api/pro/list')
        .then(res => res.json())
        .then(res => {
          console.log(res)
          data.value = res.data
        }).catch(err => {
          error.value = err
        })
      return {
        data,
        error
      }
    }
  })

  app.mount('#app')
</script>
</html>
```

å¦‚æœåœ¨æ¯ä¸ªéœ€è¦è·å–æ•°æ®çš„ç»„ä»¶ä¸­éƒ½è¦é‡å¤è¿™ç§æ¨¡å¼ï¼Œé‚£å°±å¤ªç¹çäº†ã€‚è®©æˆ‘ä»¬æŠŠå®ƒæŠ½å–æˆä¸€ä¸ªç»„åˆå¼å‡½æ•°ï¼š

`composition_async_hooks.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_async</title>
</head>
<body>
  <div id="app">
    <div v-if="error">{{ error }}</div>
    <div v-else-if="data">
      <ul>
        <li v-for="item of data" :key="item.proid">{{ item.proname }}</li>
      </ul>
    </div>
    <div v-else>åŠ è½½ä¸­....</div>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, onMounted } = Vue
  function useFetch(url) {
    const data = ref(null)
    const error = ref(null)
    fetch(url)
      .then((res) => res.json())
      .then((res) => (data.value = res.data))
      .catch((err) => (error.value = err))
    return { data, error }
  }
  const app = createApp({
    setup () { 
      const {data,error} = useFetch('http://121.89.205.189:3001/api/pro/list')
      return {
        data,
        error
      }
    }
  })

  app.mount('#app')
</script>
</html>
```

`useFetch()` æ¥æ”¶ä¸€ä¸ªé™æ€çš„ URL å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥ï¼Œæ‰€ä»¥å®ƒåªæ‰§è¡Œä¸€æ¬¡è¯·æ±‚ï¼Œç„¶åå°±å®Œæˆäº†ã€‚ä½†å¦‚æœæˆ‘ä»¬æƒ³è®©å®ƒåœ¨æ¯æ¬¡ URL å˜åŒ–æ—¶éƒ½é‡æ–°è¯·æ±‚å‘¢ï¼Ÿé‚£æˆ‘ä»¬å¯ä»¥è®©å®ƒåŒæ—¶å…è®¸æ¥æ”¶ ref ä½œä¸ºå‚æ•°ï¼š

`composition_async_hooks_urls.html`

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>composition_async_hooks</title>
</head>
<body>
  <div id="app">
    <button @click="type='list'">è·å–äº§å“åˆ—è¡¨æ•°æ®</button>
    <button @click="type='recommendlist'">è·å–æ¨èåˆ—è¡¨æ•°æ®</button>
    <div v-if="error">{{ error }}</div>
    <div v-else-if="data">
      <ul>
        <li v-for="item of data" :key="item.proid">{{ item.proname }}</li>
      </ul>
    </div>
    <div v-else>åŠ è½½ä¸­....</div>
  </div>
</body>
<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script>
  const { createApp, ref, computed, unref, isRef, watchEffect } = Vue
  function useFetch (url) {
    const data = ref(null)
    const error = ref(null)
    // æ¥å£æ–‡æ¡£ http://121.89.205.189:3001/apidoc/#api-Pro-GetProList
    function doFetch () {
      // åˆå§‹åŒ–æ•°æ®
      data.value = null
      error.value = null
      // unref() è§£åŒ…å¯èƒ½ä¸º ref çš„å€¼  unref(ref('xx')) ==> 'xx'
      fetch(unref(url))
        .then(res => res.json())
        .then(res => {
          data.value = res.data
        }).catch(err => {
          error.value = err
        })
    }
    if (isRef(url)) {
      // è‹¥è¾“å…¥çš„ URL æ˜¯ä¸€ä¸ª refï¼Œé‚£ä¹ˆå¯åŠ¨ä¸€ä¸ªå“åº”å¼çš„è¯·æ±‚
      watchEffect(doFetch)
    } else {
      // å¦åˆ™åªè¯·æ±‚ä¸€æ¬¡
      // é¿å…ç›‘å¬å™¨çš„é¢å¤–å¼€é”€
      doFetch()
    }
    return { data, error }
  }
  const app = createApp({
    setup () { 
      const type = ref('list')
      const url = computed(()=>'http://121.89.205.189:3001/api/pro/'+ type.value)
      const { data, error } = useFetch(url)
      return {
        data,
        error,
        type
      }
    }
  })

  app.mount('#app')
</script>
</html>
```